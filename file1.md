File Sharing

Protocol Family

Server Test Design Specification

*Windows is built to be the most interoperable platform*

![](data:image/png;base64,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)\
\

**MICROSOFT CORPORATION**

November 11, 2015

\

*Send suggestions and comments about this document to
dochelp@microsoft.com.*

*Please include the name of the test suite with your feedback.*

\
\

\
\

Contents {.western style="margin-left: 0.3in; text-indent: -0.3in; page-break-before: always"}
========

[Contents 2](#__RefHeading__18944_137733555)

[1.Test Environment 6](#__RefHeading__18946_137733555)

[1.1Windows Test Environment 6](#__RefHeading__18948_137733555)

[1.2Partner Test Environment 7](#__RefHeading__18950_137733555)

[2.Test Scope 8](#__RefHeading__18952_137733555)

[2.1Test Target 8](#__RefHeading__18954_137733555)

[2.2Test Protocols 8](#__RefHeading__18956_137733555)

[2.3Restrictions 8](#__RefHeading__18958_137733555)

[2.4Dependencies 8](#__RefHeading__18960_137733555)

[2.4.1Transport 8](#__RefHeading__18962_137733555)

[3.Test Suite Design 8](#__RefHeading__18964_137733555)

[3.1SMB2 BVT 9](#__RefHeading__18966_137733555)

[3.1.1SMB2Basic\_QueryDir\_WriteFlush\_ChangeNotify\_Read
9](#__RefHeading__18968_137733555)

[3.1.2SMB2Basic\_CanncelRegisteredChangeNotify
11](#__RefHeading__18970_137733555)

[3.1.3SMB2Basic\_QueryAndSet\_FileInfo
12](#__RefHeading__18972_137733555)

[3.1.4SMB2Basic\_LockAndUnLock 13](#__RefHeading__18974_137733555)

[3.1.5MultiCredit 14](#__RefHeading__18976_137733555)

[3.1.6Negotiation 15](#__RefHeading__18978_137733555)

[3.1.7MultipleChannel 18](#__RefHeading__18980_137733555)

[3.1.8CopyOffLoad 19](#__RefHeading__18982_137733555)

[3.1.9FileLevelTrim 20](#__RefHeading__18984_137733555)

[3.1.10IntegrityInfo 21](#__RefHeading__18986_137733555)

[3.1.11DirectoryLeasing 22](#__RefHeading__18988_137733555)

[3.1.12Encryption 25](#__RefHeading__18990_137733555)

[3.1.13AppInstanceId 27](#__RefHeading__18992_137733555)

[3.1.14AppInstanceVersion 28](#__RefHeading__18994_137733555)

[3.1.15DurableHandle 31](#__RefHeading__18996_137733555)

[3.1.16Oplock 34](#__RefHeading__18998_137733555)

[3.1.17FileLeasing 35](#__RefHeading__19000_137733555)

[3.1.18Replay 38](#__RefHeading__19002_137733555)

[3.1.19ResilientHandle 39](#__RefHeading__19004_137733555)

[3.1.20Signing 40](#__RefHeading__19006_137733555)

[3.1.21TreeMgmt 41](#__RefHeading__19008_137733555)

[3.1.22SessionMgmt 42](#__RefHeading__19010_137733555)

[3.1.23CreateClose 43](#__RefHeading__19012_137733555)

[3.1.24Compound 43](#__RefHeading__19014_137733555)

[3.1.25ValidateNegotiateInfo 44](#__RefHeading__19016_137733555)

[3.2SMB2 Feature Test 45](#__RefHeading__19018_137733555)

[3.2.1AppInstanceId 45](#__RefHeading__19020_137733555)

[3.2.2AppInstanceVersion 47](#__RefHeading__19022_137733555)

[3.2.3CreateClose 48](#__RefHeading__19024_137733555)

[3.2.4CreditMgmt 51](#__RefHeading__19026_137733555)

[3.2.5DirectoryLeasing 52](#__RefHeading__19028_137733555)

[3.2.6Encryption 64](#__RefHeading__19030_137733555)

[3.2.7Handle 65](#__RefHeading__19032_137733555)

[3.2.8Leasing 78](#__RefHeading__19034_137733555)

[3.2.9Negotiate 98](#__RefHeading__19036_137733555)

[3.2.10Oplock 100](#__RefHeading__19038_137733555)

[3.2.11Replay 102](#__RefHeading__19040_137733555)

[3.2.12ResilientHandle 106](#__RefHeading__19042_137733555)

[3.2.13SessionMgmt 110](#__RefHeading__19044_137733555)

[3.2.14MultipleChannel 114](#__RefHeading__19046_137733555)

[3.2.15Signing 117](#__RefHeading__19048_137733555)

[3.2.16TreeMgmt 118](#__RefHeading__19050_137733555)

[3.2.17ValidateNegotiateInfo 119](#__RefHeading__19052_137733555)

[3.2.18FileLevelTrim 122](#__RefHeading__19054_137733555)

[3.2.19CopyOfflaod 123](#__RefHeading__19056_137733555)

[3.2.20OperateOneFileFromTwoNodes 124](#__RefHeading__19058_137733555)

[3.2.21MixedOplockLease 125](#__RefHeading__19060_137733555)

[3.3SMB2 Feature Combination 126](#__RefHeading__19062_137733555)

[3.3.1MultipleChannelWithReplay 126](#__RefHeading__19064_137733555)

[3.3.2MultipleChannelWithEncryption 127](#__RefHeading__19066_137733555)

[3.3.3MultipleChannelWithLease 129](#__RefHeading__19068_137733555)

[3.3.4MultipleChannelWithLock 131](#__RefHeading__19070_137733555)

[3.3.5AppInstanceWithEncryption 134](#__RefHeading__19072_137733555)

[3.3.6AppInstanceWithLease 136](#__RefHeading__19074_137733555)

[3.3.7AppInstanceWithLock 139](#__RefHeading__19076_137733555)

[3.3.8CompoundWithEncryption 140](#__RefHeading__19078_137733555)

[3.4Server Failover Test 141](#__RefHeading__19080_137733555)

[3.4.1SWNGetInterfaceList 142](#__RefHeading__19082_137733555)

[3.4.2SWNRegistration 143](#__RefHeading__19084_137733555)

[3.4.3SWNAsyncNotification 151](#__RefHeading__19086_137733555)

[1AsmmetricShare 158](#__RefHeading__19088_137733555)

[3.4.4FileServerFailover 160](#__RefHeading__19090_137733555)

[3.4.5FileServerFailover\_Encryption
164](#__RefHeading__19092_137733555)

[3.4.6FileServerFailover\_Lease 167](#__RefHeading__19094_137733555)

[3.4.7FileServerFailover\_Lock 170](#__RefHeading__19096_137733555)

[3.4.8FileServerFailover\_DurableHandleV2
172](#__RefHeading__19098_137733555)

[3.5FSRVP Test 173](#__RefHeading__19100_137733555)

[3.5.1VSSOperateShadowCopySet 173](#__RefHeading__19102_137733555)

[3.5.2VSSSetContext 176](#__RefHeading__19104_137733555)

[3.5.3VSSAbortShadowCopySet 179](#__RefHeading__19106_137733555)

[3.6 RSVD Test 180](#__RefHeading__19108_137733555)

[3.6.1OpenCloseSharedVHD 180](#__RefHeading__19110_137733555)

[3.6.2TunnelOperationToSharedVHD 181](#__RefHeading__19112_137733555)

[3.6.3ReadWriteSharedVHD 183](#__RefHeading__19114_137733555)

[3.6.4QuerySharedVirtualDiskSupport 184](#__RefHeading__19116_137733555)

[3.6.5TwoClientsAccessSameSharedVHD 184](#__RefHeading__19118_137733555)

[1.1.1ReconnectVHDWithoutDeviceContext
185](#__RefHeading__19120_137733555)

[3.6.6QueryVHDSetFileInfo 186](#__RefHeading__19122_137733555)

[3.6.7ConvertVHDtoVHDSet 186](#__RefHeading__19124_137733555)

[3.6.8CreateDeleteCheckpoint 187](#__RefHeading__19126_137733555)

[3.6.9ExtractVHDSet 188](#__RefHeading__19128_137733555)

[3.7 DFSC Test 188](#__RefHeading__19130_137733555)

[3.7.1Domain\_referral\_to\_DC 189](#__RefHeading__19132_137733555)

[3.7.2DC\_referral\_to\_DC 192](#__RefHeading__19134_137733555)

[3.7.3Sysvol\_referral\_to\_DC 195](#__RefHeading__19136_137733555)

[3.7.4Root\_referral\_to\_DC 199](#__RefHeading__19138_137733555)

[3.7.5Link\_referral\_to\_DC 201](#__RefHeading__19140_137733555)

[3.7.6Root\_and\_Link\_referral\_to\_DFSServer
205](#__RefHeading__19142_137733555)

[3.7.7Path\_Normalization\_to\_DFSServer
211](#__RefHeading__19144_137733555)

\
\

1.  Test Environment {.western style="page-break-before: always"}
    ================

    1.  Windows Test Environment {.western}
        ------------------------

\

Below environment topology is used to demonstrate how Windows uses
MS-SMB2 protocol to access files which are hosted in remote shares. To
simplify the environment, all objects are created under Hyper-V manager
and use VMs instead of physical machines.

\

**Operating System Used**

  ------------------------ ---------------------------------
  **Operating System**     **Virtual Machines**
  Windows Server 2012 R2   DC01, Node01, Node02, Storage01
  Windows 8.1              Client01
  ------------------------ ---------------------------------

\

**Network Overview**

![](data:image/png;base64,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)

2.  Partner Test Environment {.western}
    ------------------------

There are 2 options for partner to reuse above test environment:

-   Replace the whole cluster and the storage.

-   Replace only the storage in the cluster.

\

There are 2 parts to modify if only replace storage:

-   Replace the Storage01 using partner’s storage.

-   Replace the storage in ScaleoutFS and GeneralFS.

\

**Network Overview**

![](data:image/png;base64,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)

\

\

\

2.  Test Scope {.western}
    ==========

    1.  Test Target {.western}
        -----------

This test suite will test the server endpoint of MS-FSRVP, MS-SMB2,
MS-SWN, MS-RSVD, MS-DFSC, and test suite acts as client role.

2.  Test Protocols {.western}
    --------------

This test suite includes test cases of following File Sharing protocols:

1.  MS-FSRVP

2.  MS-SMB2

3.  MS-SWN

4.  MS-RSVD

5.  MS-DFSC

1.  Restrictions {.western}
    ------------

1.  Named pipes and printer files are not tested.

2.  ServerStatistics is not tested.

4.  Dependencies {.western}
    ------------

    1.  ### Transport {.western}

MS-FSRVP scenario VSSOperateShadowCopySet in test suite utilizes MS-RPCE
SDK which uses SMB and SMB2 as transport. When test FSRVP server (i.e.
test suite act as synthetic client), the underlying MS-RPCE SDK code on
synthetic client side will first select SMB2 as transport to communicate
with server, if the server side doesn’t implement/support SMB2 as
transport, the client side will use SMB as transport to communicate with
server.

3.  Test Suite Design {.western}
    =================

Test scenarios are categorized as below table and will be described in
following sections.

  -------------------------- ------------ -------------------------------------------------------------------------------------------------------------------
  Category                   Test Cases   Comments

  SMB2 BVT                   53           SMB2 common scenarios.

  SMB2 Feature Test          2548         This test is divided by features.
                                          
                                          It contains both Model-Based test cases and traditional cases.
                                          
                                          The traditional cases are used to cover the statements which are not suitable to cover by Model-Based test cases.
                                          
                                          About Model-Based Testing, please see [Spec Explorer](http://msdn.microsoft.com/en-us/library/ee620411.aspx)

  SMB2 Feature Combination   12           Extended test with more complex message sequence for new features in SMB 3.0 dialect and later.
                                          
  \                                       \
                                          

  FSRVP Test                 9            Test for MS-FSRVP

  Server Failover Test       38           Test server failover for MS-SMB2, MS-SWN and MS-FSRVP

  RSVD Test                  19           Test for MS-RSVD

  DFSC Test                  43           Test for MS-DFSC
  -------------------------- ------------ -------------------------------------------------------------------------------------------------------------------

1.  SMB2 BVT {.western}
    --------

This is used to test SMB2 common user scenarios.

1.  ### SMB2Basic\_QueryDir\_WriteFlush\_ChangeNotify\_Read {.western}

    1.  #### Scenario {.western}

  ------------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Description**                 This tests common query, write, flush, change-notify operations.

  **Message Sequence**            **From client1 query information on an open of a directory then open the sub directory according to the queried info and register change notify on the sub directory**
                                  
                                  NEGOTIATE
                                  
                                  ECHO
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE
                                  
                                  QUERY\_DIRECTORY
                                  
                                  CLOSE
                                  
                                  CREATE (Directory, e.g. *dir1* get from QUERY\_DIRECTORY response)
                                  
                                  CHANGE\_NOTIFY (with SMB2\_WATCH\_TREE for Flags AND FILE\_NOTIFY\_CHANGE\_LAST\_WRITE for CompletionFilter)
                                  
                                  \
                                  
                                  **From client2 create a new file in the sub directory where client1 registered change notify**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (File: new file in *dir1*)
                                  
                                  WRITE
                                  
                                  \
                                  
                                  **From client1 to expect a CHANGE\_NOTIFY response then read what client2 wrote**
                                  
                                  Expect to receive CHANGE\_NOTIFY response
                                  
                                  CLOSE
                                  
                                  CREATE(File: the new file created by client2 in dir1)
                                  
                                  READ
                                  
                                  CLOSE
                                  
                                  \
                                  
                                  **From client2 requests to flush data**
                                  
                                  FLUSH
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF
                                  
                                  \
                                  
                                  **From client1 open the new file created by client2**
                                  
                                  CREATE(File: the new file created by client2 in dir1)
                                  
                                  READ
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **NO**
  ------------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_SMB2Basic\_QueryDir\_WriteFlush\_ChangeNotify\_Read

  **Description**            This test case is designed to test whether server can handle common QUERY, WRITE, FLUSH, CHANGE\_NOTIFY operations.

  **Prerequisites**          \
                             

  **Test Execution Steps**   From client1 query information on an open of a directory then open the sub directory according to the queried info and register change notify on the sub directory
                             
                             NEGOTIATE
                             
                             ECHO
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE
                             
                             QUERY\_DIRECTORY
                             
                             CLOSE
                             
                             CREATE (Directory, e.g. dir1 get from QUERY\_DIRECTORY response)
                             
                             CHANGE\_NOTIFY (with SMB2\_WATCH\_TREE for Flags AND FILE\_NOTIFY\_CHANGE\_LAST\_WRITE for CompletionFilter)
                             
                             \
                             
                             From client2 create a new file in the sub directory where client1 registered change notify
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (File: new file in dir1)
                             
                             WRITE
                             
                             FLUSH
                             
                             \
                             
                             \
                             
                             From client1 to expect a CHANGE\_NOTIFY response
                             
                             Expect to receive CHANGE\_NOTIFY response
                             
                             CLOSE
                             
                             \
                             
                             \
                             
                             From client2 close the new created file
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF
                             
                             \
                             
                             From client1 open the new file created by client2
                             
                             CREATE(File: the new file created by client2 in dir1)
                             
                             READ
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

2.  ### SMB2Basic\_CanncelRegisteredChangeNotify {.western}

    1.  #### Scenario {.western}

  ------------------------------- -------------------------------------------------------------------------------------------------------------------------------------
  **Description**                 Verify that CANCEL request cancels CHANGE\_NOTIFY request when there’s no CHANGE\_NOTIFY response from server

  **Message Sequence**            1.  Start a client to create a file by sending the following requests: 1. NEGOTIATE; 2. SESSION\_SETUP; 3. TREE\_CONNECT; 4. CREATE
                                  
                                  2.  Client starts to register CHANGE\_NOTIFY on directory.
                                  
                                  3.  Client starts to cancel the registered CHANGE\_NOTIFY on directory.
                                  
                                  4.  Tear down the client by sending the following requests: 1. CLOSE; 2. TREE\_DISCONNECT; 3. LOG\_OFF
                                  
                                  

  **Cluster Involved Scenario**   **NO**
  ------------------------------- -------------------------------------------------------------------------------------------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_SMB2Basic\_CancelRegisteredChangeNotify

  **Description**            This test case is designed to verify that CANCEL request cancels CHANGE\_NOTIFY request when there's no CHANGE\_NOTIFY response from server.

  **Prerequisites**          \
                             

  **Test Execution Steps**   NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (Directory)
                             
                             CHANGE\_NOTIFY (FILE\_NOTIFY\_CHANGE\_LAST\_WRITE for CompletionFilter)
                             
                             CANCEL
                             
                             Expect STATUS\_CANCELLED in CHANGE\_NOTIFY response
                             
                             \
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------

\
\

3.  ### SMB2Basic\_QueryAndSet\_FileInfo {.western}

    1.  #### Scenario {.western}

  ------------------------------- ---------------------------------------------------------------------------------------------------------------
  **Description**                 Query and set the info for a file

  **Message Sequence**            1.  Starts a client by sending the following requests: 1. NEGOTIATE; 2. SESSION\_SETUP; 3. TREE\_CONNECT.
                                  
                                  2.  Client sends CREATE request with desired access set to CENERIC\_READ and CENERIC\_WRITE to create a file.
                                  
                                  3.  Client sends QUERY\_INFO request to query file attributes.
                                  
                                  4.  Convert file basic information
                                  
                                  5.  Client sends SetFileAttributes request to set LastAccessTime for the file
                                  
                                  6.  Client sends QUERY request to query file attributes.
                                  
                                  7.  Convert lastAccessTime in QUERY\_INFO response after SET\_INFO.
                                  
                                  8.  Tear down the client by sending the following requests: 1. CLOSE; 2. TREE\_DISCONNECT; 3. LOG\_OFF"
                                  
                                  

  **Cluster Involved Scenario**   NO
  ------------------------------- ---------------------------------------------------------------------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_SMB2Basic\_QueryAndSet\_FileInfo

  **Description**            Query and set the info for a file

  **Prerequisites**          \
                             

  **Test Execution Steps**   NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (File, with desired access GENERIC\_WRITE and GENERIC\_READ)
                             
                             Parse FileBasicInformation from CREATE response
                             
                             QUERY\_INFO (with SMB2\_0\_INFO\_FILE for InfoType and FileBasicInformation for FileInfoClass)
                             
                             SET\_INFO (with SMB2\_0\_INFO\_FILE for InfoType and FileBasicInformation.LastAccessTime)
                             
                             QUERY\_INFO (with SMB2\_0\_INFO\_FILE for InfoType and FileBasicInformation for FileInfoClass) to verify if set info works
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------

\
\

4.  ### SMB2Basic\_LockAndUnLock {.western}

    1.  #### Scenario {.western}

  ------------------------------- --------------------------------------------------------------------------------------------------
  **Description**                 This test case is designed to test whether server can handle WRITE of locking content correctly.

  **Message Sequence**            **From client1 open a file and lock a specific range**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (File)
                                  
                                  LOCK (with SMB2\_LOCKFLAG\_SHARED\_LOCK in SMB2\_LOCK\_ELEMENT)
                                  
                                  WRITE
                                  
                                  \
                                  
                                  **From client2 open the same file and try to read and write the locking range**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (File)
                                  
                                  READ (the locking range, expect success)
                                  
                                  WRITE (the locking range, expect fail)
                                  
                                  \
                                  
                                  **From client1 unlock the range**
                                  
                                  LOCK (with SMB2\_LOCKFLAG\_UNLOCK in SMB2\_LOCK\_ELEMENT)\
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF
                                  
                                  \
                                  
                                  **From client2 try to write the range**
                                  
                                  WRITE (the locking range, expect success)
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **NO**
  ------------------------------- --------------------------------------------------------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- ---------------------------------------------------------------------------------------
  **Test ID**                BVT\_SMB2Basic\_LockAndUnLock

  **Description**            Verify locking range could not be written and after unlock the range could be written

  **Prerequisites**          \
                             

  **Test Execution Steps**   **From client1 open a file and lock a specific range**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (File)
                             
                             LOCK (with SMB2\_LOCKFLAG\_SHARED\_LOCK in SMB2\_LOCK\_ELEMENT)
                             
                             WRITE
                             
                             \
                             
                             **From client2 open the same file and try to read and write the locking range**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (File)
                             
                             READ (the locking range, expect success)
                             
                             WRITE (the locking range, expect fail)
                             
                             \
                             
                             **From client1 unlock the range**
                             
                             LOCK (with SMB2\_LOCKFLAG\_UNLOCK in SMB2\_LOCK\_ELEMENT)\
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF
                             
                             \
                             
                             **From client2 try to write the range**
                             
                             WRITE (the locking range, expect success)
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ---------------------------------------------------------------------------------------

\
\

5.  ### MultiCredit {.western}

    1.  #### Scenario {.western}

  ------------------------------- ------------------------------------------------------------
  **Description**                 Send request which consume more than 1 credit

  **Message Sequence**            NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (File and request multiple credit at the same time)
                                  
                                  Send request which consumes more than 1 credit
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   NO
  ------------------------------- ------------------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- ---------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_MultiCredit\_OneRequestWithMultiCredit

  **Description**            This test case is designed to test whether server can handle one request which consumes more than one credit.

  **Prerequisites**          \
                             

  **Test Execution Steps**   NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (File and request multiple credit at the same time)
                             
                             WRITE request which consumes more than 1 credits
                             
                             READ request which consumes more than 1 credits
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ---------------------------------------------------------------------------------------------------------------

\
\

6.  ### Negotiation {.western}

    1.  #### Scenario {.western}

  ------------------------------- -------------------------------------------------------------------
  **Description**                 SMB 3 protocol negotiation, this is non-cluster involved scenario

  **Message Sequence**            SMB\_COM\_NEGOTIATE (Optional)
                                  
                                  NEGOTIATE

  **Cluster Involved Scenario**   NO
  ------------------------------- -------------------------------------------------------------------

2.  #### Test Case {.western}

  -------------------------- ----------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Negotiate\_Compatible\_Wildcard

  **Description**            This test case is designed to test whether server can handle NEGOTIATE with Smb2 dialect wildcard.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends SMB\_COM\_NEGOTIATE containing SMB2.??? Dialect and SMB2.002
                             
                             2.  Server returns SMB2 NEGOTIATE response with SMB2.FF dialect
                             
                             3.  Client sends SMB2 NEGOTIATE request containing SMB2.002, SMB2.1, SMB3 dialects
                             
                             4.  Server returns SMB2 NEGOTIATE response with SMB3 dialect
                             
                             

  **Cleanup**                \
                             
  -------------------------- ----------------------------------------------------------------------------------------------------

\

  -------------------------- ------------------------------------------------------------------
  **Test ID**                BVT\_Negotiate\_Compatible\_2002

  **Description**            Ensure server could handle compatible negotiate

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends SMB\_COM\_NEGOTIATE containing SMB2.002
                             
                             2.  Server returns SMB2 NEGOTIATE response with SMB2.002 dialect
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------

\

\

  -------------------------- ------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Negotiate\_SMB2002

  **Description**            This test case is designed to test whether server can handle NEGOTIATE with Smb 2.002 dialect.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends SMB2 NEGOTIATE containing SMB2.002
                             
                             2.  Server returns SMB2 NEGOTIATE response with SMB2.002 dialect
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------

\

  -------------------------- --------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Negotiate\_SMB21

  **Description**            This test case is designed to test whether server can handle NEGOTIATE with Smb 2.1 dialect.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends SMB2 NEGOTIATE containing SMB2.002 and SMB2.1
                             
                             2.  Server returns SMB2 NEGOTIATE response with the max common dialect client and server support
                             
                             

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------

\

  -------------------------- --------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Negotiate\_SMB30

  **Description**            This test case is designed to test whether server can handle NEGOTIATE with Smb 3.0 dialect.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends SMB2 NEGOTIATE containing SMB2.002, SMB2.1 and SMB3.0
                             
                             2.  Server returns SMB2 NEGOTIATE response with the max common dialect client and server support
                             
                             

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------

\

  -------------------------- --------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Negotiate\_SMB302

  **Description**            This test case is designed to test whether server can handle NEGOTIATE with Smb 3.02 dialect.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends SMB2 NEGOTIATE containing SMB2.002, SMB2.1, SMB3.0 and SMB3.02
                             
                             2.  Server returns SMB2 NEGOTIATE response with the max common dialect client and server support
                             
                             

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------

\

\

  -------------------------- ----------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Negotiate\_SigningEnabled

  **Description**            This test case is designed to test whether server can handle NEGOTIATE with Signing Enabled.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request containing SMB2.002, SMB2.1, SMB3 dialects with signing enabled
                             
                             2.  Server returns NEGOTIATE response with SMB3 dialect
                             
                             

  **Cleanup**                \
                             
  -------------------------- ----------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Negotiate\_SMB311

  **Description**            This test case is designed to test whether server (including the server doesn't implement dialect 3.11) can handle NEGOTIATE with Smb 3.11 dialect and Negotiate Contexts.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client send Negotiate request with dialect SMB 3.11, SMB2\_PREAUTH\_INTEGRITY\_CAPABILITIES context and SMB2\_ENCRYPTION\_CAPABILITIES context.
                             
                             2.  Server returns correct SMB2 NEGOTIATE response according to their supported dialect.
                             
                             

  **Cleanup**                \
                             
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Negotiate\_SMB311\_Preauthentication

  **Description**            This test case is designed to test whether server can handle NEGOTIATE with Smb 3.11 dialect and SMB2\_PREAUTH\_INTEGRITY\_CAPABILITIES context only.

  **Prerequisites**          The server implements dialect 3.11.

  **Test Execution Steps**   1.  Client send Negotiate request with dialect SMB 3.11, SMB2\_PREAUTH\_INTEGRITY\_CAPABILITIES context.
                             
                             2.  Server returns SMB2 NEGOTIATE response with dialect 3.11 and the correct SMB2\_PREAUTH\_INTEGRITY\_CAPABILITIES context.
                             
                             

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Negotiate\_SMB311\_Preauthentication\_Encryption\_CCM

  **Description**            This test case is designed to test whether server can handle NEGOTIATE with Smb 3.11 dialect and SMB2\_PREAUTH\_INTEGRITY\_CAPABILITIES context and SMB2\_ENCRYPTION\_CAPABILITIES context with AES-128-CCM preferred.

  **Prerequisites**          The server implements dialect 3.11.

  **Test Execution Steps**   1.  Client send Negotiate request with dialect SMB 3.11, SMB2\_PREAUTH\_INTEGRITY\_CAPABILITIES context and SMB2\_ENCRYPTION\_CAPABILITIES context with AES-128-CCM preferred.
                             
                             2.  Server returns SMB2 NEGOTIATE response with dialect 3.11 and the correct Ciphers in SMB2\_ENCRYPTION\_CAPABILITIES context.
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Negotiate\_SMB311\_Preauthentication\_Encryption\_GCM

  **Description**            This test case is designed to test whether server can handle NEGOTIATE with Smb 3.11 dialect and SMB2\_PREAUTH\_INTEGRITY\_CAPABILITIES context and SMB2\_ENCRYPTION\_CAPABILITIES context with AES-128-GCM preferred.

  **Prerequisites**          The server implements dialect 3.11.

  **Test Execution Steps**   1.  Client send Negotiate request with dialect SMB 3.11, SMB2\_PREAUTH\_INTEGRITY\_CAPABILITIES context and SMB2\_ENCRYPTION\_CAPABILITIES context with AES-128-GCM preferred.
                             
                             2.  Server returns SMB2 NEGOTIATE response with dialect 3.11 and the correct Ciphers in SMB2\_ENCRYPTION\_CAPABILITIES context.
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

7.  ### MultipleChannel {.western}

    1.  #### Scenario {.western}

  ------------------------------- ------------------------------------------------
  **Description**                 Bind session to multiple connections

  **Message Sequence**            **Create main channel**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT (IPC\$)
                                  
                                  IOCTL (FSCTL\_QUERY\_NETWORK\_INTERFACE\_INFO)
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE
                                  
                                  WRITE
                                  
                                  \
                                  
                                  **Create alterative channel**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP (SMB2\_SESSION\_FLAG\_BINDING)
                                  
                                  READ
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **NO**
  ------------------------------- ------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_MultipleChannel\_NicRedundantOnBoth

  **Description**            This test case is designed to test the basic functionality of Multiple Channel, assuming that both client and server have two NICs.

  **Prerequisites**          \
                             

  **Test Execution Steps**   SETUP\_CONNECTION from client NIC\_1 to SUT NIC\_1
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE
                             
                             WRITE
                             
                             \
                             
                             SETUP\_CONNECTION from client NIC\_2 to SUT NIC\_2
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP binding to the previous one
                             
                             TREE\_CONNECT
                             
                             CREATE
                             
                             READ
                             
                             \
                             
                             Verify WRITE and READ data should be identical

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------

\
\

8.  ### CopyOffLoad {.western}

    1.  #### ­­Scenario {.western}

  ------------------------------- -----------------------------------------------------------
  **Description**                 Offload the copy operation to intelligent storage devices

  **Message Sequence**            NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE
                                  
                                  IOCtl with FSCTL\_OFFLOAD\_READ
                                  
                                  IOCtl with FSCTL\_OFFLOAD\_WRITE
                                  
                                  READ
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   NO
  ------------------------------- -----------------------------------------------------------

\

2.  #### Test Case {.western}

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_CopyOffload

  **Description**            This test case is designed to test whether server can handle offload copy correctly when copy content between two files.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request
                             
                             2.  Server sends NEGOTIATE response
                             
                             3.  Client sends SESSION\_SETUP request
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends TREE\_CONNECT request
                             
                             7.  Server sends TREE\_CONNECT response
                             
                             8.  Client sends CREATE request to create a test file as source of offload copy.
                             
                             9.  Server sends CREATE response
                             
                             10. Client sends WRITE request to prepare content test file.
                             
                             11. Server sends WRITE response.
                             
                             12. Client sends FLUSH request to make sure the content is written to backend storage.
                             
                             13. Server sends FLUSH response.
                             
                             14. Client sends IOCTL request with FSCTL\_OFFLOAD\_READ to ask server to generate the token of the content for offload copy.
                             
                             15. Server sends IOCTL response
                             
                             16. Client sends CREATE request to create another file as destination of offload copy.
                             
                             17. Server sends CREATE response.
                             
                             18. Client sends IOCTL request with FSCTL\_OFFLOAD\_WRITE to ask server to copy the content from source to destination.
                             
                             19. Server sends IOCTL response
                             
                             20. Client sends READ request
                             
                             21. Server sends READ response
                             
                             22. Compare the read content is identical to written content.
                             
                             23. Client sends CLOSE request
                             
                             24. Server sends CLOSE response
                             
                             25. Client sends TREE\_DISCONNECT request
                             
                             26. Server sends TREE\_DISCONNECT response
                             
                             27. Client sends LOGOFF request
                             
                             28. Server sends LOGOFF response
                             
                             

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------

\
\

9.  ### FileLevelTrim {.western}

    1.  #### Scenario {.western}

  ------------------------------- ----------------------------------------------------
  **Description**                 Trim a range of a file, then read that range again

  **Message Sequence**            NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE
                                  
                                  WRITE
                                  
                                  CREATE
                                  
                                  IOCTL (with FSCTL\_FILE\_LEVEL\_TRIM)
                                  
                                  CREATE
                                  
                                  READ
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   NO
  ------------------------------- ----------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- -------------------------------------------------------------------------------------
  **Test ID**                BVT\_FileLevelTrim

  **Description**            This test case is designed to test basic functionality of FSCTL\_FILE\_LEVEL\_TRIM.

  **Prerequisites**          \
                             

  **Test Execution Steps**   NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE
                             
                             WRITE
                             
                             CREATE
                             
                             IOCTL (with FSCTL\_FILE\_LEVEL\_TRIM)
                             
                             CREATE
                             
                             READ
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------

\
\

10. ### IntegrityInfo {.western}

    1.  #### Scenario {.western}

  ------------------------------- -------------------------------------------------
  **Description**                 Underlying ReFS format is required

  **Message Sequence**            NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (File)
                                  
                                  IOCTL (with FSCTL\_GET\_INTEGRITY\_INFORMATION)
                                  
                                  IOCTL (with FSCTL\_SET\_INTEGRITY\_INFORMATION)
                                  
                                  IOCTL (with FSCTL\_GET\_INTEGRITY\_INFORMATION)
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   NO
  ------------------------------- -------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_SetGetIntegrityInfo

  **Description**            This test case is designed to test whether server can handle IOCTL FSCTL\_GET\_INTEGRITY\_INFORMATION and FSCTL\_SET\_INTEGRITY\_INFORMATION.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client creates a file by sending the following requests: 1. NEGOTIATE; 2. SESSION\_SETUP; 3. TREE\_CONNECT; 4. CREATE
                             
                             2.  Client sends IOCTL request with FSCTL\_GET\_INTEGRITY\_INFORMATION.
                             
                             3.  Client sends IOCTL request with FSCTL\_SET\_INTEGRITY\_INFORMATION after changed the value of the following fields in FSCTL\_SET\_INTEGRIY\_INFO\_INPUT: ChecksumAlgorithm, Flags, and Reserved.
                             
                             4.  Client sends IOCTL request with FSCTL\_GET\_INTEGRITY\_INFORMATION.
                             
                             5.  Tear down the client by sending the following requests: 1. CLOSE; 2. TREE\_DISCONNECT; 3. LOG\_OFF
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\

\
\

11. ### DirectoryLeasing {.western}

    1.  #### Basic {.western}

        1.  ##### Scenario {.western}

              ------------------------------- -----------------------------------------------------------
              **Description**                 Obtain lease for directory (with lease request v2)

              **Message Sequence**            NEGOTIATE
                                              
                                              SESSION\_SETUP
                                              
                                              TREE\_CONNECT
                                              
                                              CREATE (Directory, with SMB2\_CREATE\_REQUEST\_LEASE\_V2)
                                              
                                              LEASE\_BREAK
                                              
                                              CLOSE
                                              
                                              TREE\_DISCONNECT
                                              
                                              LOGOFF

              **Cluster Involved Scenario**   NO
              ------------------------------- -----------------------------------------------------------

        2.  ##### Test Case {.western}

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_DirectoryLeasing\_ReadWriteHandleCaching

  **Description**            This test case is designed to test whether server can handle READ|WRITE|HANDLE leasing on a directory correctly.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request
                             
                             2.  Server sends NEGOTIATE response
                             
                             3.  Client sends SESSION\_SETUP request
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends TREE\_CONNECT request
                             
                             7.  Server sends TREE\_CONNECT response
                             
                             8.  Client sends CREATE request for a directory with SMB2\_CREATE\_REQUEST\_LEASE\_V2, LeaseState setting to SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_WRITE\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING
                             
                             9.  Server sends CREATE response
                             
                             10. Server sends LEASE\_BREAK notification
                             
                             11. Client sends LEASE\_BREAK acknowledgement
                             
                             12. Server sends LEASE\_BREAK response
                             
                             13. Client sends CLOSE request
                             
                             14. Server sends CLOSE response
                             
                             15. Client sends TREE\_DISCONNECT request
                             
                             16. Server sends TREE\_DISCONNECT response
                             
                             17. Client sends LOGOFF request
                             
                             18. Server sends LOGOFF response
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\

2.  #### DirectoryLeasing\_LeaseBreakOnMultiClients {.western}

    1.  ##### Scenario {.western}

  ------------------------------- -------------------------------------------------------------------------------------------------------------------------------------
  **Description**                 This tests lease break notification when multiple clients request caching lease

  **Message Sequence**            **From client1**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (Directory, with SMB2\_CREATE\_REQUEST\_LEASE\_V2 and lease state SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING)
                                  
                                  \
                                  
                                  **From client2 to access same directory to trigger leasing break**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (Directory, with SMB2\_CREATE\_REQUEST\_LEASE\_V2 and lease state SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING)
                                  
                                  \
                                  
                                  **From client3 to access same directory to trigger leasing break**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (with DELETE)
                                  
                                  \
                                  
                                  **From client1 and client2**
                                  
                                  Receive LEASE\_BREAK
                                  
                                  Send LEASE\_BREAK\_ACK
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **NO**
  ------------------------------- -------------------------------------------------------------------------------------------------------------------------------------

\
\

2.  ##### Test Case {.western}

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_DirectoryLeasing\_LeaseBreakOnMultiClients

  **Description**            Test whether server can handle lease break notification when multiple clients request caching lease.

  **Prerequisites**          \
                             

  **Test Execution Steps**   **From client1**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (Directory, with SMB2\_CREATE\_REQUEST\_LEASE\_V2 and lease state SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING)
                             
                             \
                             
                             **From client2 to access same directory to trigger leasing break**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (Directory, with SMB2\_CREATE\_REQUEST\_LEASE\_V2 and lease state SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING)
                             
                             \
                             
                             **From client3 to access same directory to trigger leasing break**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (with DELETE)
                             
                             \
                             
                             **From client1 and client2**
                             
                             Receive LEASE\_BREAK
                             
                             Send LEASE\_BREAK\_ACK
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------

\
\

12. ### Encryption {.western}

    1.  #### Scenario {.western}

  ------------------------------- -------------------------------------------------------
  **Description**                 Send and receive commands with encryption enabled

  **Message Sequence**            NEGOTIATE (with SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT (expect SMB2\_SHAREFLAG\_ENCRYPT\_DATA)
                                  
                                  CREATE
                                  
                                  WRITE
                                  
                                  READ
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   NO
  ------------------------------- -------------------------------------------------------

\

2.  #### Test Case {.western}

  -------------------------- ------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Encryption\_GlobalEncryptionEnabled

  **Description**            Ensure server could handle encrypted requests correctly while global encryption is enabled

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request with SMB2\_GLOBAL\_CAP\_ENCRYPTION
                             
                             2.  Server sends NEGOTIATE response with SMB2\_GLOBAL\_CAP\_ENCRYPTION
                             
                             3.  Client sends SESSION\_SETUP request
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends encrypted TREE\_CONNECT request
                             
                             7.  Server sends TREE\_CONNECT response with SMB2\_SHAREFLAG\_ENCRYPT\_DATA
                             
                             8.  Client sends encrypted CREATE request
                             
                             9.  Server sends encrypted CREATE response
                             
                             10. Client sends encrypted WRITE request
                             
                             11. Server sends encrypted WRITE response
                             
                             12. Client sends encrypted READ request to read the content written in previous message.
                             
                             13. Server sends encrypted READ response
                             
                             14. Client check whether the decrypted content is consistent with the original one.
                             
                             15. Client sends encrypted CLOSE request
                             
                             16. Server sends encrypted CLOSE response
                             
                             17. Client sends encrypted TREE\_DISCONNECT request
                             
                             18. Server sends encrypted TREE\_DISCONNECT response
                             
                             19. Client sends LOGOFF request
                             
                             20. Server sends LOGOFF response
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Encryption\_PerShareEncryptionEnabled

  **Description**            Ensure server could handle encrypted requests correctly while client requests to connect to encrypted share.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request with SMB2\_GLOBAL\_CAP\_ENCRYPTION
                             
                             2.  Server sends NEGOTIATE response with SMB2\_GLOBAL\_CAP\_ENCRYPTION
                             
                             3.  Client sends SESSION\_SETUP request
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends TREE\_CONNECT request to connect an encrypted share
                             
                             7.  Server sends TREE\_CONNECT response with SMB2\_SHAREFLAG\_ENCRYPT\_DATA
                             
                             8.  Client sends encrypted CREATE request
                             
                             9.  Server sends encrypted CREATE response
                             
                             10. Client sends encrypted WRITE request
                             
                             11. Server sends encrypted WRITE response
                             
                             12. Client sends encrypted READ request to read the content written in previous message
                             
                             13. Server sends encrypted READ response
                             
                             14. Client check whether the decrypted content is consistent with the original one
                             
                             15. Client sends encrypted CLOSE request
                             
                             16. Server sends encrypted CLOSE response
                             
                             17. Client sends encrypted TREE\_DISCONNECT request
                             
                             18. Server sends encrypted TREE\_DISCONNECT response
                             
                             19. Client sends LOGOFF request
                             
                             20. Server sends LOGOFF response
                             
                             

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Encryption\_SMB311\_CCM

  **Description**            This case is to ensure server could handle encrypted requests correctly with dialect 3.11, SMB2\_ENCRYPTION\_CAPABILITIES context and AES-128-CCM as encryption algorithm.

  **Prerequisites**          The server implement dialect 3.11.

  **Test Execution Steps**   1.  Client sends NEGOTIATE request with dialect 3.11, SMB2\_ENCRYPTION\_CAPABILITIES context. AES-128-CCM is as the preferred cipher algorithm. Server should reply NEGOTIATE response with dialect 3.11, SMB2\_ENCRYPTION\_CAPABILITIES context and AES-128-CCM as cipher algorithm.
                             
                             2.  Client sends SESSION\_SETUP request and gets response.
                             
                             3.  Client sends encrypted TREE\_CONNECT, Create, Write, Read, Close, TREE\_DISCONNECT and Logoff request and gets successful responses.
                             
                             

  **Cleanup**                \
                             
  -------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Encryption\_SMB311\_GCM

  **Description**            This case is to ensure server could handle encrypted requests correctly with dialect 3.11, SMB2\_ENCRYPTION\_CAPABILITIES context and AES-128-GCM as encryption algorithm.

  **Prerequisites**          The server implement dialect 3.11.

  **Test Execution Steps**   1.  Client sends NEGOTIATE request with dialect 3.11, SMB2\_ENCRYPTION\_CAPABILITIES context. AES-128-GCM is as the preferred cipher algorithm. Server should reply NEGOTIATE response with dialect 3.11, SMB2\_ENCRYPTION\_CAPABILITIES context and AES-128-GCM as cipher algorithm.
                             
                             2.  Client sends SESSION\_SETUP request and gets response.
                             
                             3.  Client sends encrypted TREE\_CONNECT, Create, Write, Read, Close, TREE\_DISCONNECT and Logoff request, and gets successful responses.
                             
                             

  **Cleanup**                \
                             
  -------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

13. ### AppInstanceId {.western}

    1.  #### Scenario {.western}

  ------------------------------- ------------------------------------------
  **Description**                 Client cluster failover

  **Message Sequence**            ***Based on NIC1, create Client1:***
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (With AppID)
                                  
                                  WRITE
                                  
                                  \
                                  
                                  ***Switch to NIC2 and create Client2:***
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (With the same AppID)
                                  
                                  READ
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **NO**
  ------------------------------- ------------------------------------------

\

2.  #### Test Case {.western}

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_AppInstanceId

  **Description**            Check when client fails over to a new client, the previous opened file can be reopened with the same AppInstanceId.

  **Prerequisites**          \
                             

  **Test Execution Steps**   Via NIC1
                             
                             1.  Start the first client by sending the following requests: NEGOTIATE; SESSION\_SETUP; TREE\_CONNECT
                             
                             2.  The first client sends CREATE request for exclusive open with SMB2\_CREATE\_APP\_INSTANCE\_ID create context.
                             
                             3.  The first client sends WRITE request.
                             
                             Via NIC2
                             
                             4.  Start the second client by sending the following requests: NEGOTIATE; SESSIONSETUP; TREE\_CONNECT
                             
                             5.  The second client sends CREATE request for exclusive open with the same SMB2\_CREATE\_APP\_INSTANCE\_ID of the first client.
                             
                             6.  The second client sends READ request.
                             
                             Via NIC1
                             
                             7.  The first client sends another WRITE request.
                             
                             Via NIC2
                             
                             8.  Tear down the second client by sending the following requests: CLOSE; TREE\_DISCONNECT; LOG\_OFF; DISCONNECT
                             
                             

  **Cleanup**                \
                             
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------

\
\

14. ### AppInstanceVersion {.western}

    1.  #### Scenario {.western}

          ------------------------------- -------------------------------------------------------------------------------
          **Description**                 Client cluster failover v2

          **Message Sequence**            ***Client1:***
                                          
                                          NEGOTIATE
                                          
                                          SESSION\_SETUP
                                          
                                          TREE\_CONNECT
                                          
                                          CREATE (With AppInstanceID and AppInstanceVersion)
                                          
                                          \
                                          
                                          ***Client2:***
                                          
                                          NEGOTIATE
                                          
                                          SESSION\_SETUP
                                          
                                          TREE\_CONNECT
                                          
                                          CREATE (With the same AppInstanceID and same or different AppInstanceVersion)
                                          
                                          \
                                          
                                          ***Client1:***
                                          
                                          Write and check the result

          **Cluster Involved Scenario**   **NO**
          ------------------------------- -------------------------------------------------------------------------------

    2.  #### Test Case {.western}

  -------------------------- ---------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_AppInstanceVersion\_SMB311\_GreaterVersion

  **Description**            Check when client fails over to a new client, the previous opened file can be reopened with a greater AppInstanceVersion.

  **Prerequisites**          The server implements dialect 3.11.

  **Test Execution Steps**   1.  Start the first client by sending the following requests: NEGOTIATE; SESSION\_SETUP; TREE\_CONNECT.
                             
                             2.  The first client sends CREATE request with AppInstanceVersionHigh = 1, AppInstanceVersionLow = 0.
                             
                             3.  Start the second client by sending the following requests: NEGOTIATE; SESSIONSETUP; TREE\_CONNECT.
                             
                             4.  The second client sends CREATE request with AppInstanceVersionHigh = 2, AppInstanceVersionLow = 1 and succeeds.
                             
                             5.  Client1 sends another WRITE request.
                             
                             6.  The first client sends another WRITE request and failed since the open is closed.
                             
                             7.  Tear down the two clients by sending the following requests: CLOSE; TREE\_DISCONNECT; LOG\_OFF; DISCONNECT
                             
                             

  **Cleanup**                \
                             
  -------------------------- ---------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_AppInstanceVersion\_SMB311\_SameVersion

  **Description**            Check when client fails over to a new client, the previous opened file can NOT be reopened with the same AppInstanceVersion.

  **Prerequisites**          The server implements dialect 3.11.

  **Test Execution Steps**   1.  Start the first client by sending the following requests: NEGOTIATE; SESSION\_SETUP; TREE\_CONNECT.
                             
                             2.  The first client sends CREATE request with AppInstanceVersionHigh = 1, AppInstanceVersionLow = 0.
                             
                             3.  Start the second client by sending the following requests: NEGOTIATE; SESSIONSETUP; TREE\_CONNECT.
                             
                             4.  The second client sends CREATE request with AppInstanceVersionHigh = 2, AppInstanceVersionLow = 0 and succeeds.
                             
                             5.  Client1 sends another WRITE request and failed since the open is closed.
                             
                             6.  Client1 sends another CREATE request with same AppInstanceVersion as Client2 and gets STATUS\_FILE\_FORCED\_CLOSED.
                             
                             7.  Tear down the two clients by sending the following requests: CLOSE; TREE\_DISCONNECT; LOG\_OFF; DISCONNECT
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_AppInstanceVersion\_SMB311\_LowerAppInstanceVersionHigh

  **Description**            Check when client fails over to a new client, the previous opened file can NOT be reopened with lower AppInstanceVersion.AppInstanceVersionHigh.

  **Prerequisites**          The server implements dialect 3.11.

  **Test Execution Steps**   1.  Start the first client by sending the following requests: NEGOTIATE; SESSION\_SETUP; TREE\_CONNECT.
                             
                             2.  The first client sends CREATE request with AppInstanceVersionHigh = 2, AppInstanceVersionLow = 0.
                             
                             3.  Start the second client by sending the following requests: NEGOTIATE; SESSIONSETUP; TREE\_CONNECT.
                             
                             4.  The second client sends CREATE request with AppInstanceVersionHigh = 1, AppInstanceVersionLow = 0 and gets failure.
                             
                             5.  Client1 sends another WRITE request and succeeds since the open is not closed.
                             
                             6.  Tear down the two clients by sending the following requests: CLOSE; TREE\_DISCONNECT; LOG\_OFF; DISCONNECT
                             
                             

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_AppInstanceVersion\_SMB311\_LowerAppInstanceVersionLow

  **Description**            Check when client fails over to a new client, the previous opened file can NOT be reopened with lower AppInstanceVersion.AppInstanceVersionLow.

  **Prerequisites**          The server implements dialect 3.11.

  **Test Execution Steps**   1.  Start the first client by sending the following requests: NEGOTIATE; SESSION\_SETUP; TREE\_CONNECT.
                             
                             2.  The first client sends CREATE request with AppInstanceVersionHigh = 1, AppInstanceVersionLow = 2.
                             
                             3.  Start the second client by sending the following requests: NEGOTIATE; SESSIONSETUP; TREE\_CONNECT.
                             
                             4.  The second client sends CREATE request with AppInstanceVersionHigh = 1, AppInstanceVersionLow = 1 and gets failure.
                             
                             5.  Client1 sends another WRITE request and succeeds since the open is not closed.
                             
                             6.  Tear down the two clients by sending the following requests: CLOSE; TREE\_DISCONNECT; LOG\_OFF; DISCONNECT
                             
                             

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------

\
\

15. ### DurableHandle {.western}

    1.  #### Scenario {.western}

  ------------------------------- --------------------------------------
  **Description**                 DurableHandle

  **Message Sequence**            NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (With DurableHandleRequest)
                                  
                                  WRITE
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (With DurableHandleReconnect)
                                  
                                  READ
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **NO**
  ------------------------------- --------------------------------------

\

2.  #### Test Case {.western}

  -------------------------- -------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_DurableHandleV1\_Reconnect\_WithBatchOplock

  **Description**            This test case is designed to test whether server can create a durable open v1 with batch oplock correctly.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request
                             
                             2.  Server sends NEGOTIATE response
                             
                             3.  Client sends SESSION\_SETUP request
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends TREE\_CONNECT request
                             
                             7.  Server sends TREE\_CONNECT response
                             
                             8.  Client sends CREATE request for exclusive open with DurableHandleV1 create context and BatchOpLock
                             
                             9.  Server sends CREATE response
                             
                             10. Client sends WRITE request
                             
                             11. Server sends WRITE response
                             
                             12. Client disconnect
                             
                             13. Create another client and the following requests are sent via this client
                             
                             14. Client sends NEGOTIATE request
                             
                             15. Server sends NEGOTIATE response
                             
                             16. Client sends SESSION\_SETUP request
                             
                             17. Server sends SESSION\_SETUP response
                             
                             18. According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             19. Client sends CREATE request for exclusive open with DurableHandleReconnectV1 and BatchOpLock
                             
                             20. Server sends CREATE response
                             
                             21. Client sends READ request
                             
                             22. Server sends READ response
                             
                             23. Client sends CLOSE request
                             
                             24. Server sends CLOSE response
                             
                             25. Client sends TREE\_DISCONNECT request
                             
                             26. Server sends TREE\_DISCONNECT response
                             
                             27. Client sends LOGOFF request
                             
                             28. Server sends LOGOFF response
                             
                             

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_DurableHandleV1\_Reconnect\_WithLeaseV1

  **Description**            Test reconnect with DurableHandleV1 and LeaseV1 context.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request
                             
                             2.  Server sends NEGOTIATE response
                             
                             3.  Client sends SESSION\_SETUP request
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends TREE\_CONNECT request
                             
                             7.  Server sends TREE\_CONNECT response
                             
                             8.  Client sends CREATE request for exclusive open with DurableHandleV1 and LeaseV1 create context
                             
                             9.  Server sends CREATE response
                             
                             10. Client sends WRITE request
                             
                             11. Server sends WRITE response
                             
                             12. Client disconnect
                             
                             13. Create another client and the following requests are sent via this client
                             
                             14. Client sends NEGOTIATE request
                             
                             15. Server sends NEGOTIATE response
                             
                             16. Client sends SESSION\_SETUP request
                             
                             17. Server sends SESSION\_SETUP response
                             
                             18. According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             19. Client sends CREATE request for exclusive open with DurableHandleReconnectV1 and LeaseV1 create context
                             
                             20. Server sends CREATE response
                             
                             21. Client sends READ request
                             
                             22. Server sends READ response
                             
                             23. Client sends CLOSE request
                             
                             24. Server sends CLOSE response
                             
                             25. Client sends TREE\_DISCONNECT request
                             
                             26. Server sends TREE\_DISCONNECT response
                             
                             27. Client sends LOGOFF request
                             
                             28. Server sends LOGOFF response
                             
                             

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_DurableHandleV2\_Reconnect\_WithBatchOplock

  **Description**            Test reconnect with DurableHandleV2 and BatchOplock.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request
                             
                             2.  Server sends NEGOTIATE response
                             
                             3.  Client sends SESSION\_SETUP request
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends TREE\_CONNECT request
                             
                             7.  Server sends TREE\_CONNECT response
                             
                             8.  Client sends CREATE request for exclusive open with DurableHandleV2 create context and BatchOpLock
                             
                             9.  Server sends CREATE response
                             
                             10. Client sends WRITE request
                             
                             11. Server sends WRITE response
                             
                             12. Client disconnect
                             
                             13. Create another client and the following requests are sent via this client
                             
                             14. Client sends NEGOTIATE request
                             
                             15. Server sends NEGOTIATE response
                             
                             16. Client sends SESSION\_SETUP request
                             
                             17. Server sends SESSION\_SETUP response
                             
                             18. According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             19. Client sends CREATE request for exclusive open with DurableHandleReconnectV1 and BatchOpLock
                             
                             20. Server sends CREATE response
                             
                             21. Client sends READ request
                             
                             22. Server sends READ response
                             
                             23. Client sends CLOSE request
                             
                             24. Server sends CLOSE response
                             
                             25. Client sends TREE\_DISCONNECT request
                             
                             26. Server sends TREE\_DISCONNECT response
                             
                             27. Client sends LOGOFF request
                             
                             28. Server sends LOGOFF response
                             
                             

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_DurableHandleV2\_Reconnect\_WithLeaseV1

  **Description**            Test reconnect with DurableHandleV2 and LeaseV1 context.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request
                             
                             2.  Server sends NEGOTIATE response
                             
                             3.  Client sends SESSION\_SETUP request
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends TREE\_CONNECT request
                             
                             7.  Server sends TREE\_CONNECT response
                             
                             8.  Client sends CREATE request for exclusive open with DurableHandleV2 and LeaseV1 create context
                             
                             9.  Server sends CREATE response
                             
                             10. Client sends WRITE request
                             
                             11. Server sends WRITE response
                             
                             12. Client disconnect
                             
                             13. Create another client and the following requests are sent via this client
                             
                             14. Client sends NEGOTIATE request
                             
                             15. Server sends NEGOTIATE response
                             
                             16. Client sends SESSION\_SETUP request
                             
                             17. Server sends SESSION\_SETUP response
                             
                             18. According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             19. Client sends CREATE request for exclusive open with DurableHandleReconnectV2 and LeaseV1 create context
                             
                             20. Server sends CREATE response
                             
                             21. Client sends READ request
                             
                             22. Server sends READ response
                             
                             23. Client sends CLOSE request
                             
                             24. Server sends CLOSE response
                             
                             25. Client sends TREE\_DISCONNECT request
                             
                             26. Server sends TREE\_DISCONNECT response
                             
                             27. Client sends LOGOFF request
                             
                             28. Server sends LOGOFF response
                             
                             

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_PersistentHandle\_Reconnect

  **Description**            Test reconnect with persistent handle

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request
                             
                             2.  Server sends NEGOTIATE response
                             
                             3.  Client sends SESSION\_SETUP request
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends TREE\_CONNECT request
                             
                             7.  Server sends TREE\_CONNECT response
                             
                             8.  Client sends CREATE request for exclusive open with PersistentHandle create context
                             
                             9.  Server sends CREATE response
                             
                             10. Client sends WRITE request
                             
                             11. Server sends WRITE response
                             
                             12. Client disconnect
                             
                             13. Create another client and the following requests are sent via this client
                             
                             14. Client sends NEGOTIATE request
                             
                             15. Server sends NEGOTIATE response
                             
                             16. Client sends SESSION\_SETUP request
                             
                             17. Server sends SESSION\_SETUP response
                             
                             18. According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             19. Client sends CREATE request for exclusive open with PersistentHandle
                             
                             20. Server sends CREATE response
                             
                             21. Client sends READ request
                             
                             22. Server sends READ response
                             
                             23. Client sends CLOSE request
                             
                             24. Server sends CLOSE response
                             
                             25. Client sends TREE\_DISCONNECT request
                             
                             26. Server sends TREE\_DISCONNECT response
                             
                             27. Client sends LOGOFF request
                             
                             28. Server sends LOGOFF response
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------

\
\

16. ### Oplock {.western}

    1.  #### Scenario {.western}

  ------------------------------- ----------------------------------------------------------------------------
  **Description**                 This scenario is to test whether server can handle Oplock break correctly.

  **Message Sequence**            ***Based on NIC1, create Client1:***
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (With BatchOplock)
                                  
                                  WRITE
                                  
                                  \
                                  
                                  ***Switch to NIC2 and create Client2:***
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE
                                  
                                  \
                                  
                                  ***Switch to NIC1 and Client1:***
                                  
                                  OplockBreakNotification
                                  
                                  OpLockBreakAcknowlegement
                                  
                                  \
                                  

  **Cluster Involved Scenario**   **NO**
  ------------------------------- ----------------------------------------------------------------------------

\

2.  #### Test Case {.western}

  -------------------------- ------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_OpLockBreak

  **Description**            This test case is designed to test whether sever can handle OplockBreak correctly.

  **Prerequisites**          \
                             

  **Test Execution Steps**   Via NIC1
                             
                             1.  Client sends NEGOTIATE request
                             
                             2.  Server sends NEGOTIATE response
                             
                             3.  Client sends SESSION\_SETUP request
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends TREE\_CONNECT request
                             
                             7.  Server sends TREE\_CONNECT response
                             
                             8.  Client sends CREATE request with BatchOpLock
                             
                             9.  Server sends CREATE response
                             
                             Via NIC2
                             
                             10. Create another client and the following requests are sent via this client
                             
                             11. Client sends NEGOTIATE request
                             
                             12. Server sends NEGOTIATE response
                             
                             13. Client sends SESSION\_SETUP request
                             
                             14. Server sends SESSION\_SETUP response
                             
                             15. According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             16. Client sends CREATE request on the same file
                             
                             Via NIC1
                             
                             17. Server sends OPLOCK\_BREAK\_NOTIFICATION response
                             
                             18. Client sends OPLOCK\_BREAK\_ACKNOWLEDGEMENT request
                             
                             19. Server sends OPLOCK\_BREAK\_RESPONSE response
                             
                             Via NIC2
                             
                             20. Server sends CREATE response
                             
                             Via NIC1
                             
                             21. Tear down the client by sending CLOSE, TREE\_DISCONNECT and LOG\_OFF.
                             
                             Via NIC2
                             
                             22. Tear down the client by sending CLOSE, TREE-CONNECT and LOG\_OFF.
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------

\
\

17. ### FileLeasing {.western}

    1.  #### Scenario {.western}

  ------------------------------- ---------------------------------------------------------------------
  **Description**                 This scenario is to test whether server can handle lease correctly.

  **Message Sequence**            ***Based on NIC1, create Client1:***
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (With Lease context)
                                  
                                  WRITE
                                  
                                  \
                                  
                                  ***Switch to NIC2 and create Client2:***
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE
                                  
                                  \
                                  
                                  ***Switch to NIC1 and Client1:***
                                  
                                  LeaseBreakNotification
                                  
                                  LeaseBreakAcknowlegement
                                  
                                  \
                                  

  **Cluster Involved Scenario**   **NO**
  ------------------------------- ---------------------------------------------------------------------

\

2.  #### Test Case {.western}

  -------------------------- ------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Leasing\_FileLeasingV1

  **Description**            This test case is designed to test whether server can handle LeaseV1 context correctly on a file.

  **Prerequisites**          \
                             

  **Test Execution Steps**   Via NIC1
                             
                             1.  Client sends NEGOTIATE request
                             
                             2.  Server sends NEGOTIATE response
                             
                             3.  Client sends SESSION\_SETUP request
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends TREE\_CONNECT request
                             
                             7.  Server sends TREE\_CONNECT response
                             
                             8.  Client sends CREATE request with LeaseV1
                             
                             9.  Server sends CREATE response
                             
                             Via NIC2
                             
                             10. Create another client and the following requests are sent via this client
                             
                             11. Client sends NEGOTIATE request
                             
                             12. Server sends NEGOTIATE response
                             
                             13. Client sends SESSION\_SETUP request
                             
                             14. Server sends SESSION\_SETUP response
                             
                             15. According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             16. Client sends CREATE request on the same file
                             
                             Via NIC1
                             
                             17. Server sends LEASE\_BREAK\_NOTIFICATION response
                             
                             18. Client sends Lease\_BREAK\_ACKNOWLEDGEMENT request, breaking Lease to RH
                             
                             19. Server sends Lease\_BREAK\_RESPONSE response
                             
                             Via NIC2
                             
                             20. Server sends CREATE response
                             
                             21. Client sends Write request
                             
                             Via NIC1
                             
                             22. Server sends LEASE\_BREAK\_NOTIFICATION response
                             
                             23. Client sends Lease\_BREAK\_ACKNOWLEDGEMENT request, breaking Lease to None
                             
                             24. Server sends Lease\_BREAK\_RESPONSE response
                             
                             Via NIC2
                             
                             25. Server sends WRITE response
                             
                             Via NIC1
                             
                             26. Client sends CLOSE request
                             
                             27. Server sends CLOSE response
                             
                             28. Client sends TREE\_DISCONNECT request
                             
                             29. Server sends TREE\_DISCONNECT response
                             
                             30. Client sends LOGOFF request
                             
                             31. Server sends LOGOFF response
                             
                             Via NIC2
                             
                             32. Client sends CLOSE request
                             
                             33. Server sends CLOSE response
                             
                             34. Client sends TREE\_DISCONNECT request
                             
                             35. Server sends TREE\_DISCONNECT response
                             
                             36. Client sends LOGOFF request
                             
                             37. Server sends LOGOFF response
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Leasing\_FileLeasingV2

  **Description**            This test case is designed to test whether server can handle LeaseV2 context correctly on a file.

  **Prerequisites**          \
                             

  **Test Execution Steps**   Via NIC1
                             
                             1.  Client sends NEGOTIATE request
                             
                             2.  Server sends NEGOTIATE response
                             
                             3.  Client sends SESSION\_SETUP request
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends TREE\_CONNECT request
                             
                             7.  Server sends TREE\_CONNECT response
                             
                             8.  Client sends CREATE request with LeaseV2
                             
                             9.  Server sends CREATE response
                             
                             Via NIC2
                             
                             10. Create another client and the following requests are sent via this client
                             
                             11. Client sends NEGOTIATE request
                             
                             12. Server sends NEGOTIATE response
                             
                             13. Client sends SESSION\_SETUP request
                             
                             14. Server sends SESSION\_SETUP response
                             
                             15. According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             16. Client sends CREATE request on the same file
                             
                             Via NIC1
                             
                             17. Server sends LEASE\_BREAK\_NOTIFICATION response
                             
                             18. Client sends Lease\_BREAK\_ACKNOWLEDGEMENT request, breaking Lease to RH
                             
                             19. Server sends Lease\_BREAK\_RESPONSE response
                             
                             Via NIC2
                             
                             20. Server sends CREATE response
                             
                             21. Client sends Write request
                             
                             Via NIC1
                             
                             22. Server sends LEASE\_BREAK\_NOTIFICATION response
                             
                             23. Client sends Lease\_BREAK\_ACKNOWLEDGEMENT request, breaking Lease to None
                             
                             24. Server sends Lease\_BREAK\_RESPONSE response
                             
                             Via NIC2
                             
                             25. Server sends WRITE response
                             
                             Via NIC1
                             
                             26. Client sends CLOSE request
                             
                             27. Server sends CLOSE response
                             
                             28. Client sends TREE\_DISCONNECT request
                             
                             29. Server sends TREE\_DISCONNECT response
                             
                             30. Client sends LOGOFF request
                             
                             31. Server sends LOGOFF response
                             
                             Via NIC2
                             
                             32. Client sends CLOSE request
                             
                             33. Server sends CLOSE response
                             
                             34. Client sends TREE\_DISCONNECT request
                             
                             35. Server sends TREE\_DISCONNECT response
                             
                             36. Client sends LOGOFF request
                             
                             37. Server sends LOGOFF response
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------

\
\

18. ### Replay {.western}

    1.  #### Test Case {.western}

  -------------------------- ---------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Replay\_WriteWithInvalidChannelSequence

  **Description**            This test case is designed to test whether server can handle the Replay request with invalid channel sequence correctly.

  **Prerequisites**          \
                             

  **Test Execution Steps**   Via NIC1
                             
                             1.  Start a client from main channel by sending the following requests: 1. NEGOTIATE; 2. SESSION\_SETUP; 3. TREE\_CONNECT; 4. CREATE.
                             
                             Via NIC2
                             
                             2.  Start a client from alternative channel by sending NEGOTIATE request.
                             
                             3.  The alternative client sends SESSION\_SETUP request binding by the previous session created by the main channel client.
                             
                             Via NIC1
                             
                             4.  The main channel client sends WRITE request to write content to file
                             
                             Via NIC1
                             
                             5.  The main channel client sends WRITE request to write content to file.
                             
                             6.  Tear down the main channel client by sending DISCONNECT request.
                             
                             Via NIC2
                             
                             7.  Set the channel sequence of the alternative channel client to an invalid value.
                             
                             8.  The alternative client sends WRITE request to write content to the file created by the main channel client.
                             
                             9.  Tear down the alternative channel client by sending TREE\_DISCONNECT and LOG\_OFF requests.
                             
                             

  **Cleanup**                \
                             
  -------------------------- ---------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Replay\_ReplayCreate

  **Description**            This test case is designed to test whether server can handle Replay operation correctly.

  **Prerequisites**          \
                             

  **Test Execution Steps**   Via NIC1
                             
                             Start a client from main channel, and send NEGOTIATE and SESSION\_SETUP requests via NIC2
                             
                             Start another client from alternative channel, and send NEGOTIATE and SESSION\_SETUP requests.
                             
                             Via NIC1
                             
                             1.  The main channel client sends TREE\_CONNECT request.
                             
                             2.  The main channel client sends CREATE request with SMB2\_CREATE\_DURABLE\_HANDLE\_REQUEST\_V2 create context.
                             
                             3.  Tear down the main channel client by sending DISCONNECT request
                             
                             Via NIC2
                             
                             Tear the alternative channel client by sending TREE\_DISCONNECT and LOG\_OFF requests.

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------------------

\
\

19. ### ResilientHandle {.western}

    1.  #### Test Case {.western}

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_ResilientHandle\_Reconnect

  **Description**            Test whether server can request a durable open when receiving FSCTL\_LMR\_REQUEST\_RESILLIENNCY successfully.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Start the first client to create a file by sending the following requests: 1. NEGOTIATE; 2. SESSION\_SETUP; 3. TREE\_CONNECT
                             
                             2.  The first client sends an IOCTL FSCTL\_LMR\_REQUEST\_RESILLIENCY request.
                             
                             3.  Tear down the first client by sending DISCONNECT request.
                             
                             4.  Start a second client by sending the following requests: 1. NEGOTIATE; 2. SESSION\_SETUP; 3. TREE\_CONNECT
                             
                             5.  The second client sends CREATE request with SMB2\_CREATE\_DURABLE\_HANDLE\_RECONNECT create context to open the same file created by the first client.
                             
                             6.  Tear down the second client by sending the following requests: 1. CLOSE; 2. TREE\_DISCONNECT; 3. LOG\_OFF
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_ResilientHandle\_LockSequence

  **Description**            This test case is designed to test whether server can handle Lock request with specified LockSequence.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Start the first client to create a file by sending the following requests: 1. NEGOTIATE; 2. SESSION\_SETUP; 3. TREE\_CONNECT; 4. CREATE. The first client sends an IOCTL FSCTL\_LMR\_REQUEST\_RESILLIENCY request
                             
                             2.  The first client sends WRITE request.
                             
                             3.  The first client sends Flush request.
                             
                             4.  The first client sends LOCK request with LockSequence set to (BucketNumber\<\< 4) + BucketSequence"
                             
                             5.  Start the second client to reconnect to the file created by the first client by sending the following requests: 1. NEGOTIATE; 2. SESSION\_SETUP; 3. TREE\_CONNECT; 4.CREATE (with SMB2\_CREATE\_DURABLE\_HANDLE\_RECONNECT Create Context).
                             
                             6.  The second client sends LOCK request with the same LockSequence with the first client.
                             
                             7.  Tear down the second client by sending the following requests: 1. CLOSE; 2. TREE\_DISCONNECT; 3. LOG\_OFF
                             
                             

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

20. ### Signing {.western}

    1.  #### Test Case {.western}

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Signing

  **Description**            This test case is designed to test whether server can handle NEGOTIATE and SESSION\_SETUP requests with NEGOTIATE\_SIGNING\_REQUIRED set.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request with NEGOTIATE\_SIGNING\_REQUIRED flag set
                             
                             2.  Server sends NEGOTIATE response
                             
                             3.  Client sends SESSION\_SETUP request NEGOTIATE\_SIGNING\_REQUIRED flag set
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------

\
\

21. ### TreeMgmt {.western}

    1.  #### Test Case {.western}

  -------------------------- ---------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_TreeMgmt\_TreeConnectAndDisconnect

  **Description**            This test case is designed to test whether server can handle TREE\_CONNECT and TREE\_DISCONNECT requests correctly.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request with NEGOTIATE\_SIGNING\_REQUIRED flag set
                             
                             2.  Server sends NEGOTIATE response
                             
                             3.  Client sends SESSION\_SETUP request NEGOTIATE\_SIGNING\_REQUIRED flag set
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends TREE\_CONNECT request
                             
                             7.  Server sends TREE\_CONNECT response
                             
                             8.  Client sends TREE\_DISCONNECT request
                             
                             9.  Server sends TREE\_DISCONNECT response
                             
                             

  **Cleanup**                \
                             
  -------------------------- ---------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_TreeMgmt\_SMB311\_Disconnect\_NoSignedNoEncryptedTreeConnect

  **Description**            This test case is designed to test whether server can disconnect the connection when Connection.Dialect is 3.1.1 and the TreeConnect request is not signed or not encrypted.

  **Prerequisites**          The server implements dialect 3.11.

  **Test Execution Steps**   1.  Client sends NEGOTIATE request without NEGOTIATE\_SIGNING\_REQUIRED and GLOBAL\_CAP\_ENCRYPTION set and gets response.
                             
                             2.  Client sends SESSION\_SETUP request without NEGOTIATE\_SIGNING\_REQUIRED flag set and gets response.
                             
                             3.  Client sends TREE\_CONNECT request which is not signed or not encrypted and expects server disconnects the connection.
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

22. ### SessionMgmt {.western}

    1.  #### Test Case {.western}

  -------------------------- -----------------------------------------------------------------------------
  **Test ID**                BVT\_SessionMgmt\_NewSession

  **Description**            This test case is designed to test whether server can handle a new session.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request
                             
                             2.  Server sends NEGOTIATE response
                             
                             3.  Client sends SESSION\_SETUP request with sessionid set zero
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------------

\
\

  -------------------------- ---------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_SessionMgmt\_ReconnectSessionSetup

  **Description**            This test case is designed to test whether server can handle authentication after disconnection

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client1 sends NEGOTIATE request
                             
                             2.  Server sends NEGOTIATE response
                             
                             3.  Client1 sends SESSION\_SETUP request with sessionid set zero
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  Client1 disconnect.
                             
                             6.  Client2 sends NEGOTIATE request
                             
                             7.  Server sends NEGOTIATE response
                             
                             8.  Client2 sends SESSION\_SETUP request with SESSION\_ID set to the value in the previous SESSION\_SETUP response.
                             
                             9.  Client2 disconnect.
                             
                             

  **Cleanup**                \
                             
  -------------------------- ---------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ---------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_SessionMgmt\_Reauthentication

  **Description**            This test case is designed to test whether server can handle reauthentication successfully.

  **Test Execution Steps**   Client sends NEGOTIATE request.
                             
                             Client sends SESSION\_SETUP request with SESSION\_ID set to ZERO.
                             
                             Client sends SESSION-SETUP request with SESSION\_ID set to the value in the previous SESSION\_SETUP response.
                             
                             Check server response.

  **Cleanup**                \
                             
  -------------------------- ---------------------------------------------------------------------------------------------------------------

\
\

23. ### CreateClose {.western}

    1.  #### Test Case {.western}

  ---------------------- -----------------------------------------------------------------------------------------------------------
  **Test ID**            BVT\_CreateClose\_CreateAndCloseFile

  **Description**        This case is designed to test whether server can handle Create and Delete operations on file correctly.

  **Message Sequence**   NEGOTIATE
                         
                         SESSION\_SETUP
                         
                         TREE\_CONNECT
                         
                         CREATE (CreateOption: FILE\_NON\_DIRECTORY\_FILE; CreateDisposition: FILE\_CREATE)
                         
                         CLOSE
                         
                         TREE\_DISCONNECT
                         
                         LOGOFF
                         
                         NEGOTIATE
                         
                         SESSION\_SETUP
                         
                         TREE\_CONNECT
                         
                         CREATE (CreateOption: FILE\_NON\_DIRECTORY\_FILE| FILE\_DELETE\_ON\_CLOSE; CreateDisposition: FILE\_OPEN)
                         
                         CLOSE
                         
                         TREE\_DISCONNECT
                         
                         LOGOFF
  ---------------------- -----------------------------------------------------------------------------------------------------------

\
\

  ---------------------- --------------------------------------------------------------------------------------------------------------
  **Test ID**            BVT\_CreateClose\_CreateAndCloseDirectory

  **Description**        This case is designed to test whether server can handle Create and Delete operations on directory correctly.

  **Message Sequence**   NEGOTIATE
                         
                         SESSION\_SETUP
                         
                         TREE\_CONNECT
                         
                         CREATE (CreateOption: FILE\_DIRECTORY\_FILE; CreateDisposition: FILE\_CREATE)
                         
                         CLOSE
                         
                         TREE\_DISCONNECT
                         
                         LOGOFF
                         
                         NEGOTIATE
                         
                         SESSION\_SETUP
                         
                         TREE\_CONNECT
                         
                         CREATE (CreateOption: FILE\_DIRECTORY\_FILE| FILE\_DELETE\_ON\_CLOSE; CreateDisposition: FILE\_OPEN)
                         
                         CLOSE
                         
                         TREE\_DISCONNECT
                         
                         LOGOFF
  ---------------------- --------------------------------------------------------------------------------------------------------------

24. ### Compound {.western}

    1.  #### Test Case {.western}

  ---------------------- --------------------------------------------------------------------
  **Test ID**            BVT\_Compound\_RelatedRequests

  **Message Sequence**   NEGOTIATE
                         
                         SESSION\_SETUP
                         
                         TREE\_CONNECT
                         
                         COMPOUND related request (CREATE, WRITE, and CLOSE to a same file)
                         
                         Verify COMPOUND response
                         
                         TREEDISCONNECT
                         
                         LOGOFF
  ---------------------- --------------------------------------------------------------------

\
\

  ---------------------- -------------------------------------------------------------------------
  **Test ID**            BVT\_Compound\_UnrelatedRequests

  **Message Sequence**   NEGOTIATE
                         
                         SESSION\_SETUP
                         
                         TREE\_CONNECT
                         
                         COMPOUND unrelated request (two CREATE requests to two different files)
                         
                         Verify responses to the COMPOUND request
                         
                         TREEDISCONNECT
                         
                         LOGOFF
  ---------------------- -------------------------------------------------------------------------

25. ### ValidateNegotiateInfo {.western}

    1.  #### Scenario {.western}

  ------------------------------- -------------------------------------------------
  **Description**                 Request validation of a previous SMB2 NEGOTIATE

  **Message Sequence**            NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  IOCTL: FSCTL\_VALIDATE\_NEGOTIATE\_INFO
                                  
                                  Expect success or disconnection
                                  
                                  TREE\_DISCONNECT (optional)
                                  
                                  LOGOFF (optional)

  **Cluster Involved Scenario**   **NO**
  ------------------------------- -------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- ------------------------------------------------------------------------
  **Test ID**                BVT\_ValidateNegotiateInfo

  **Description**            Test whether server can handle IOCTL FSCTL\_VALIDATE\_NEGOTIATE\_INFO.

  **Prerequisites**          \
                             

  **Test Execution Steps**   NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             IOCTL (with valid FSCTL\_VALIDATE\_NEGOTIATE\_INFO)
                             
                             Expected success in IOCTL response
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------

\
\

2.  SMB2 Feature Test {.western}
    -----------------

Test scenarios are prioritized and designed based on customer interests
and SMB3 new features.

1.  ### AppInstanceId {.western}

Allow an application to failover on a new client and open a file that
was previously opened using an application instance identifier.

1.  #### Model {.western}

    1.  ##### Coverage {.western}

**AppInstanceId** Model covers all statements of the following sections:

-   3.3.5.9.13 Handling the SMB2\_CREATE\_APP\_INSTANCE\_ID Create
    Context

-   2.2.13.2.13 SMB2\_CREATE\_APP\_INSTANCE\_ID

2.  ##### Assumptions/Restrictions {.western}

N/A

3.  ##### Scenario Design {.western}

  ------------------- --------------------------------------------------------------------------------------------------------------------------
  **Scenario Name**   AppInstanceId

  **Description**     Basic scenario:
                      
                      Create an open first with/without AppInstanceId, then send create request again to see if the open can be closed or not.

  **Machine**         ReadConfig;
                      
                      PrepareOpen;
                      
                      OpenRequest;
                      
                      OpenResponse;
  ------------------- --------------------------------------------------------------------------------------------------------------------------

\
\

2.  #### Traditional Case {.western}

Scenario see [section 3.1.15.1](#_Scenario)

  -------------------------- -----------------------------------------------------------------------------------------------------
  **Test ID**                Negative\_AppInstanceId\_DifferentAppInstanceIdAfterFailover

  **Description**            Open a file with a different AppInstanceId after failover so that server treat the open differently

  **Prerequisites**          \
                             

  **Test Execution Steps**   Based on NIC1, create Client1:
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (With AppInstanaceID)
                             
                             WRITE
                             
                             \
                             
                             Disable NIC1
                             
                             \
                             
                             Switch to NIC2 and create Client2:
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (With a different AppInstanceID)
                             
                             Expect error in CREATE response
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                Enable NIC1
  -------------------------- -----------------------------------------------------------------------------------------------------

\
\

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                AppInstanceId\_Negative\_DifferentAppInstanceIdInReopen

  **Description**            This test case is designed to check that if a client fails over to a new client, whether the previously opened file can be reopened with different AppInstanceId.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client1 sends the following requests: NEGOTIATE; SESSION\_SETUP; TREE\_CONNECT
                             
                             2.  Server responses successfully.
                             
                             3.  Client1 sends CREATE request with the contexts of SMB2\_CREATE\_DURABLE\_HANDLE\_REQUEST\_V2 and SMB2\_CREATE\_APP\_INSTANCE\_ID.
                             
                             4.  Server responses successfully.
                             
                             5.  Client2 sends the following requests:
                             
                             NEGOTIATE; SESSION\_SETUP; TREE\_CONNECT
                             
                             6.  Server responses successfully.
                             
                             7.  Client2 sends CREATE request to the same file with client1, and with SMB2\_CREATE\_DURABLE\_HANDLE\_REQUEST\_V2 and different AppInstanceId.
                             
                             8.  Client1 sends WRITE request to write content.
                             
                             9.  Server responses successfully.
                             
                             10. Tear down client1.
                             
                             11. Tear down client2.
                             
                             

  **Cleanup**                Enable NIC1
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                AppInstanceId\_Smb311

  **Description**            The case is designed to test if the server implements dialect 3.11, and when client fails over to a new client, the previous open can be closed by the new client with the same AppInstanceId. AppInstanceId should work without DH2Q create context.

  **Prerequisites**          The server implements dialect 3.11.

  **Test Execution Steps**   1.  Client1 sends NEGOTIATE request with dialect 3.11 and gets NEGOTIATE response also with dialect 3.11.
                             
                             2.  Client1 sends the following requests: SESSION\_SETUP; TREE\_CONNECT.
                             
                             3.  Server responses successfully.
                             
                             4.  Client1 sends CREATE request with the context SMB2\_CREATE\_APP\_INSTANCE\_ID, without DH2Q create context.
                             
                             5.  Server responses successfully.
                             
                             6.  Client2 sends the following requests:
                             
                             NEGOTIATE; SESSION\_SETUP; TREE\_CONNECT.
                             
                             7.  Server responses successfully.
                             
                             8.  Client2 sends CREATE request to the same file with client1, and same AppInstanceId, and without DH2Q create context. Client2 should create the open successfully.
                             
                             9.  The first client sends another WRITE request and gets failure because the open is closed.
                             
                             10. Tear down client1.
                             
                             11. Tear down client2.
                             
                             

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

2.  ### AppInstanceVersion {.western}

    1.  #### Scenario {.western}

See section [3.1.14.1](#_Scenario_6).

2.  #### Test Case {.western}

  -------------------------- ------------------------------------------------------------------------------------------------------------------------
  **Test ID**                Negative\_AppInstanceVersion\_SMB311\_NoVersion

  **Description**            Check when client fails over to a new client, the previous opened file can NOT be reopened with no AppInstanceVersion.

  **Prerequisites**          The server implements dialect 3.11.

  **Test Execution Steps**   1.  Start the first client by sending the following requests: NEGOTIATE; SESSION\_SETUP; TREE\_CONNECT.
                             
                             2.  The first client sends CREATE request with AppInstanceVersionHigh = 1, AppInstanceVersionLow = 0.
                             
                             3.  Start the second client by sending the following requests: NEGOTIATE; SESSIONSETUP; TREE\_CONNECT.
                             
                             4.  The second client sends CREATE request without AppInstanceVersion and gets failure.
                             
                             5.  Client1 sends another WRITE request and succeeds since the open is not closed.
                             
                             6.  Tear down the two clients by sending the following requests: CLOSE; TREE\_DISCONNECT; LOG\_OFF; DISCONNECT
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                AppInstanceVersion\_SMB311\_SMB302

  **Description**            Check if server can fail the create request if the second client send a create request with dialect302 and AppInstanceID create context.

  **Prerequisites**          The server implements dialect 3.11.

  **Test Execution Steps**   1.  Start the first client by sending the following requests: NEGOTIATE with dialect 3.11; SESSION\_SETUP; TREE\_CONNECT.
                             
                             2.  The first client sends CREATE request with AppInstanceVersionHigh = 1, AppInstanceVersionLow = 0.
                             
                             3.  Start the second client by sending the following requests: NEGOTIATE with dialect 3.02; SESSIONSETUP; TREE\_CONNECT.
                             
                             4.  The second client sends CREATE request with a valid AppInstanceId, but no AppInstanceVersion, and gets failure.
                             
                             5.  Client1 sends another WRITE request and succeeds since the open is not closed.
                             
                             6.  Tear down the two clients by sending the following requests: CLOSE; TREE\_DISCONNECT; LOG\_OFF; DISCONNECT
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                AppInstanceVersion\_SMB302\_SMB311

  **Description**            Check when the first client negotiates dialect 3.02, the second client negotiates dialect 3.11, the create request with SMB2\_CREATE\_APP\_INSTANCE\_VERSION create context sent by the second client should succeed.

  **Prerequisites**          The server implements dialect 3.11.

  **Test Execution Steps**   1.  Start the first client by sending the following requests: NEGOTIATE with dialect 3.02; SESSION\_SETUP; TREE\_CONNECT.
                             
                             2.  The first client sends CREATE request with an AppInstanceId context.
                             
                             3.  Start the second client by sending the following requests: NEGOTIATE with dialect 3.11; SESSIONSETUP; TREE\_CONNECT.
                             
                             4.  The second client sends CREATE request with a valid AppInstanceId and AppInstanceVersion and succeeds.
                             
                             5.  Client1 sends another WRITE request and gets failure since the open is closed.
                             
                             6.  Tear down the two clients by sending the following requests: CLOSE; TREE\_DISCONNECT; LOG\_OFF; DISCONNECT
                             
                             

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

3.  ### CreateClose {.western}

Client uses create operation to request either creation or access to a
file, and uses close to close a file that was opened previously with a
successful create.

The feature has 34 model-based test cases and several traditional test
cases.

1.  #### Model {.western}

    1.  ##### Coverage {.western}

**CreateClose** Model covers all statements (except which are mentioned
in “Assumptions/Restrictions”) of the following sections:

-   3.3.5.9 Receiving an SMB2 CREATE Request

-   3.3.5.10 Receiving an SMB2 CLOSE Request

-   2.2.13 SMB2 CREATE Request

-   2.2.14 SMB2 CREATE Response

-   2.2.15 SMB2 CLOSE Request

-   2.2.16 SMB2 CLOSE Response

1.  ##### Assumptions/Restrictions {.western}

-   This model doesn’t test all the flag combination of fields
    FileAttributes/ShareAccess/CreateDisposition/CreateOptions of CREATE
    Request. It picks the ones mentioned in “section 3.3.5.9 Receiving
    an SMB2 CREATE Request”.

-   This model doesn’t test create contexts. The create contexts are
    tested in individual Feature Tests.

1.  ##### Scenario Design {.western}

      ------------------- ---------------------------------------------------------------------------------
      **Scenario Name**   CreateClose

      **Description**     Basic scenario to test how the server handles CREATE Request and CLOSE Request.

      **Machine**          ReadConfig; 
                          
                           SetupConnection; //Negotiate, Session Setup, Tree Connect
                          
                           CreateRequest;
                          
                           CreateResponse;
                          
                           (
                          
                               CloseRequest;
                          
                               CloseResponse;
                          
                           )\*;  
      ------------------- ---------------------------------------------------------------------------------

#### Traditional Case {.western}

Scenario see [section 3.1.23](#_Toc387924530)

  ---------------------- --------------------------------------------------------------------------------------------------------------------------------
  **Test ID**            CreateClose\_SymbolicLinkInMiddle

  **Description**        This case is designed to test whether server can handle Create operation with symbolic link in middle of file path.

  **Message Sequence**   NEGOTIATE
                         
                         SESSION\_SETUP
                         
                         TREE\_CONNECT
                         
                         CREATE (CreateOption: FILE\_DIRECTORY\_FILE; CreateDisposition: FILE\_CREATE, file name contains symbolic link in the middle.)
                         
                         Expect server failed with STATUS\_STOPPED\_ON\_SYMLINK.
                         
                         CLOSE
                         
                         TREE\_DISCONNECT
                         
                         LOGOFF
  ---------------------- --------------------------------------------------------------------------------------------------------------------------------

\
\

  ---------------------- -------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**            CreateClose\_SymbolicLinkAtLast

  **Description**        This case is designed to test whether server can handle Create operation with symbolic link at last of file path.

  **Message Sequence**   NEGOTIATE
                         
                         SESSION\_SETUP
                         
                         TREE\_CONNECT
                         
                         CREATE (CreateOption: FILE\_DIRECTORY\_FILE; CreateDisposition: FILE\_CREATE, file name contains symbolic link in the last of file path.)
                         
                         Expect server failed with STATUS\_STOPPED\_ON\_SYMLINK.
                         
                         CLOSE
                         
                         TREE\_DISCONNECT
                         
                         LOGOFF
  ---------------------- -------------------------------------------------------------------------------------------------------------------------------------------

\
\

  ---------------------- --------------------------------------------------------------------------------------------------------------------------------
  **Test ID**            CreateClose\_InvalidSymbolicLink

  **Description**        This case is designed to test whether server can handle Create operation with other invalid symbolic link.

  **Message Sequence**   NEGOTIATE
                         
                         SESSION\_SETUP
                         
                         TREE\_CONNECT
                         
                         CREATE (CreateOption: FILE\_DIRECTORY\_FILE; CreateDisposition: FILE\_CREATE, file name contains symbolic link in the middle.)
                         
                         Expect server failed with STATUS\_STOPPED\_ON\_SYMLINK.
                         
                         CLOSE
                         
                         TREE\_DISCONNECT
                         
                         LOGOFF
  ---------------------- --------------------------------------------------------------------------------------------------------------------------------

\
\

  ---------------------- ------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**            CreateClose\_DeleteFile\_DesiredAccessNotIncludeDeleteOrGenericAll

  **Description**        This case is designed to test whether server can handle delete file request when desired access does not include DELETE or GENERIC\_ALL.

  **Message Sequence**   NEGOTIATE
                         
                         SESSION\_SETUP
                         
                         TREE\_CONNECT
                         
                         CREATE (CreateOption: FILE\_DIRECTORY\_FILE; CreateDisposition: FILE\_CREATE, file name contains symbolic link in the middle.)
                         
                         Expect server failed with specific error code according to server’s implementation.
                         
                         CLOSE
                         
                         TREE\_DISCONNECT
                         
                         LOGOFF
  ---------------------- ------------------------------------------------------------------------------------------------------------------------------------------

\
\

  ---------------------- ----------------------------------------------------------------------------------------
  **Test ID**            InvalidCreateRequestStructureSize

  **Description**        Test the server response when it receives an invalid structure size of CREATE request.

  **Message Sequence**   NEGOTIATE
                         
                         SESSION\_SETUP
                         
                         TREE\_CONNECT
                         
                         CREATE with invalid structure size.
                         
                         Expect server sends error response STATUS\_INVALID\_PARAMETER.
                         
                         CLOSE
                         
                         TREE\_DISCONNECT
                         
                         LOGOFF
  ---------------------- ----------------------------------------------------------------------------------------

\
\

4.  ### CreditMgmt {.western}

**CreditMgmt** model verify that server handles the request correctly
when client sends READ (for response payload verification)/WRITE (for
request payload verification) requests with different MessageId,
CreditCharge, CreditRequest and payload length.

This feature contains 49 model-based test cases.

1.  #### Model {.western}

    1.  ##### Coverage {.western}

**CreditMgmt** model covers the statements in following sections with
exceptions mentioned in Assumptions/Restrictions section

-   3.3.1.1 Algorithm for Handling Available Message Sequence Numbers by
    the Server

-   3.3.1.2 Algorithm for the Granting of Credits

-   3.3.4.1.2 Granting Credits to the Client

-   3.3.5.2.3 Verifying the Sequence Number

-   3.3.5.2.5 Verifying the Credit Charge and the Payload Size

1.  ##### Assumptions/Restrictions {.western}

-   The model assumes the situation that the underlying connection
    supports multi-credit request (i.e. no NetBIOS transport used)

-   The model does not cover credit verification for
    async/compounded/cancel requests

1.  ##### Scenario Design {.western}

      ------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------
      **Scenario Name**   CreditMgmt

      **Description**     This scenario covers basic message sequence with various MessageId, CreditCharge, CreditRequest and payload length to test server behavior of credit verification.

      **Machine**         ReadConfig;
                          
                          SetupConnection; //Negotiate,SessionSetup,TreeConnect,Create
                          
                          (
                          
                              CreditOperationRequest;
                          
                              CreditOperationResponse?; ExpectDisconnect?;
                          
                          );
      ------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------

### DirectoryLeasing {.western}

1.  #### Basic {.western}

    1.  ##### Scenario {.western}

See [section 3.1.13.1.1](#_Scenario_3)

2.  ##### Test Case {.western}

\

  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DirectoryLeasing\_ReadCaching

  **Description**            Ensure server could handle read directory leasing correctly

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request
                             
                             2.  Server sends NEGOTIATE response
                             
                             3.  Client sends SESSION\_SETUP request
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends TREE\_CONNECT request
                             
                             7.  Server sends TREE\_CONNECT response
                             
                             8.  Client sends CREATE request for a directory with SMB2\_CREATE\_REQUEST\_LEASE\_V2, LeaseState setting to SMB2\_LEASE\_READ\_CACHING
                             
                             9.  Server sends CREATE response
                             
                             10. Write to the directory with another client
                             
                             11. Server sends LEASE\_BREAK notification
                             
                             12. Client sends LEASE\_BREAK acknowledgement
                             
                             13. Server sends LEASE\_BREAK response
                             
                             14. Client sends CLOSE request
                             
                             15. Server sends CLOSE response
                             
                             16. Client sends TREE\_DISCONNECT request
                             
                             17. Server sends TREE\_DISCONNECT response
                             
                             18. Client sends LOGOFF request
                             
                             19. Server sends LOGOFF response
                             
                             

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------

\

  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DirectoryLeasing\_ReadWriteCaching

  **Description**            Ensure server could handle READ\_WRITE directory leasing correctly

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request
                             
                             2.  Server sends NEGOTIATE response
                             
                             3.  Client sends SESSION\_SETUP request
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends TREE\_CONNECT request
                             
                             7.  Server sends TREE\_CONNECT response
                             
                             8.  Client sends CREATE request for a directory with SMB2\_CREATE\_REQUEST\_LEASE\_V2, LeaseState setting to SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_WRITE\_CACHING
                             
                             9.  Server sends CREATE response
                             
                             10. Read the directory content with another client
                             
                             11. Server sends LEASE\_BREAK notification
                             
                             12. Client sends LEASE\_BREAK acknowledgement
                             
                             13. Server sends LEASE\_BREAK response
                             
                             14. Client sends CLOSE request
                             
                             15. Server sends CLOSE response
                             
                             16. Client sends TREE\_DISCONNECT request
                             
                             17. Server sends TREE\_DISCONNECT response
                             
                             18. Client sends LOGOFF request
                             
                             19. Server sends LOGOFF response
                             
                             

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------

\

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DirectoryLeasing\_ReadHandleCaching

  **Description**            Ensure server could handle READ\_HANDLE directory leasing correctly

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request
                             
                             2.  Server sends NEGOTIATE response
                             
                             3.  Client sends SESSION\_SETUP request
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends TREE\_CONNECT request
                             
                             7.  Server sends TREE\_CONNECT response
                             
                             8.  Client sends CREATE request for a directory with SMB2\_CREATE\_REQUEST\_LEASE\_V2, LeaseState setting to SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING
                             
                             9.  Server sends CREATE response
                             
                             10. Delete the directory with another client
                             
                             11. Server sends LEASE\_BREAK notification
                             
                             12. Client sends LEASE\_BREAK acknowledgement
                             
                             13. Server sends LEASE\_BREAK response
                             
                             14. Client sends CLOSE request
                             
                             15. Server sends CLOSE response
                             
                             16. Client sends TREE\_DISCONNECT request
                             
                             17. Server sends TREE\_DISCONNECT response
                             
                             18. Client sends LOGOFF request
                             
                             19. Server sends LOGOFF response
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                Negative\_DirectoryLeasing\_SMB21

  **Description**            Negative test case to test SMB3 directory leasing feature using SMB2.1 dialect.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request with dialect SMB2.002 and SMB2.1.
                             
                             2.  Server sends NEGOTIATE response with dialect SMB2.1
                             
                             3.  Client sends SESSION\_SETUP request
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends TREE\_CONNECT request
                             
                             7.  Server sends TREE\_CONNECT response
                             
                             8.  Client sends CREATE request for a directory with SMB2\_CREATE\_REQUEST\_LEASE\_V2, LeaseState setting to SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_WRITE\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING
                             
                             9.  Server sends CREATE response
                             
                             10. Write to the directory with another client
                             
                             11. Server sends LEASE\_BREAK notification
                             
                             12. Client sends LEASE\_BREAK acknowledgement
                             
                             13. Server sends LEASE\_BREAK response
                             
                             14. Client sends CLOSE request
                             
                             15. Server sends CLOSE response
                             
                             16. Client sends TREE\_DISCONNECT request
                             
                             17. Server sends TREE\_DISCONNECT response
                             
                             18. Client sends LOGOFF request
                             
                             19. Server sends LOGOFF response
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                Negative\_DirectoryLeasing\_SMB2002

  **Description**            Negative test case to test SMB3 directory leasing feature using SMB2.002 dialect.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request with only SMB2.002 dialect.
                             
                             2.  Server sends NEGOTIATE response with dialect SMB2.002
                             
                             3.  Client sends SESSION\_SETUP request
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends TREE\_CONNECT request
                             
                             7.  Server sends TREE\_CONNECT response
                             
                             8.  Client sends CREATE request for a directory with SMB2\_CREATE\_REQUEST\_LEASE\_V2, LeaseState setting to SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_WRITE\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING
                             
                             9.  Server sends CREATE response
                             
                             10. Write to the directory with another client
                             
                             11. Server sends LEASE\_BREAK notification
                             
                             12. Client sends LEASE\_BREAK acknowledgement
                             
                             13. Server sends LEASE\_BREAK response
                             
                             14. Client sends CLOSE request
                             
                             15. Server sends CLOSE response
                             
                             16. Client sends TREE\_DISCONNECT request
                             
                             17. Server sends TREE\_DISCONNECT response
                             
                             18. Client sends LOGOFF request
                             
                             19. Server sends LOGOFF response
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DirectoryLeasing\_InvalidClientGuidInLeaseBreakAck

  **Description**            The LEASE\_BREAK\_ACK for open which is already closed

  **Prerequisites**          \
                             

  **Test Execution Steps**   Test preparation
                             
                             Create a directory on a share
                             
                             \
                             
                             From client1
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (Directory, with SMB2\_CREATE\_REQUEST\_LEASE\_V2 and lease state SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING)
                             
                             \
                             
                             From SUT adapter to access same directory to trigger leasing break
                             
                             \
                             
                             From client1
                             
                             Receive LEASE\_BREAK
                             
                             CLOSE
                             
                             Send LEASE\_BREAK\_ACK
                             
                             Expect error in response
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------

\

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DirectoryLeasing\_InvalidLeaseStateInLeaseBreakAck

  **Description**            The info in LEASE\_BREAK\_ACK contains invalid LeaseState

  **Prerequisites**          \
                             

  **Test Execution Steps**   Test preparation
                             
                             Create a directory on a share
                             
                             \
                             
                             From client1
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (Directory, with SMB2\_CREATE\_REQUEST\_LEASE\_V2 and lease state SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING)
                             
                             \
                             
                             From SUT adapter to access same directory to trigger leasing break
                             
                             \
                             
                             From client1
                             
                             Receive LEASE\_BREAK
                             
                             Send LEASE\_BREAK\_ACK (with invalid LeaseState)
                             
                             Expect error in response
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------

\

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DirectoryLeasing\_Invalid LeaseKeyInLeaseBreakAck

  **Description**            The info in LEASE\_BREAK\_ACK contains invalid LeaseKey

  **Prerequisites**          \
                             

  **Test Execution Steps**   Test preparation
                             
                             Create a directory on a share
                             
                             \
                             
                             From client1
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (Directory, with SMB2\_CREATE\_REQUEST\_LEASE\_V2 and lease state SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING)
                             
                             \
                             
                             From SUT adapter to access same directory to trigger leasing break
                             
                             \
                             
                             From client1
                             
                             Receive LEASE\_BREAK
                             
                             Send LEASE\_BREAK\_ACK (with invalid LeaseKey)
                             
                             Expect error in response
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------

\
\

2.  #### DirectoryLeasing\_BreakByAccurateOperation {.western}

      ------------------------------ -------------------------
      RequestLeaseStateFromClient1   BreakOperationByClient2
      R                              ChildRenamed
      R                              ChildDeleted
      R                              ChildModified
      RH                             ConflictOpen
      RH                             ParentDeleted
      RH                             ParentRenamed
      ------------------------------ -------------------------

    1.  ##### Scenario {.western}

  ------------------------------- ---------------------------------------------------------------
  **Description**                 Trigger the lease break by specific operations

  **Message Sequence**            **Test preparation**
                                  
                                  Create a directory on a share
                                  
                                  \
                                  
                                  **From client1**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (Directory, with SMB2\_CREATE\_REQUEST\_LEASE\_V2)
                                  
                                  \
                                  
                                  **From client2 to trigger lease break by specific operation**
                                  
                                  \
                                  
                                  **From client1**
                                  
                                  Receive LEASE\_BREAK if expect one
                                  
                                  Send LEASE\_BREAK\_ACK if there’s LEASE\_BREAK
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF
                                  
                                  \
                                  
                                  **From client2**
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **NO**
  ------------------------------- ---------------------------------------------------------------

\
\

2.  ##### Test Case {.western}

\
\

  -------------------------- ---------------------------------------------------------------------------------------------------------------
  **Test ID**                DirectoryLeasing\_BreakReadCachingByChildRenamed

  **Description**            Test whether server can handle READ lease break notification triggered by renaming child item on a directory.

  **Prerequisites**          \
                             

  **Test Execution Steps**   **Test preparation**
                             
                             Create a directory on a share
                             
                             Create a file in the directory
                             
                             \
                             
                             **From client1**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (Directory, with SMB2\_CREATE\_REQUEST\_LEASE\_V2 with LeaseState SMB2\_LEASE\_READ\_CACHING)
                             
                             \
                             
                             **From client2 to trigger lease break by renaming the child item**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (File in the directory with DELETE access mask)
                             
                             SetInfo with FileRenameInformation to rename the file
                             
                             \
                             
                             **From client1**
                             
                             Receive LEASE\_BREAK
                             
                             Send LEASE\_BREAK\_ACK if server requires
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF
                             
                             \
                             
                             **From client2**
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ---------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ---------------------------------------------------------------------------------------------------------------
  **Test ID**                DirectoryLeasing\_BreakReadCachingByChildDeleted

  **Description**            Test whether server can handle READ lease break notification triggered by deleting child item on a directory.

  **Prerequisites**          \
                             

  **Test Execution Steps**   **Test preparation**
                             
                             Create a directory on a share
                             
                             Create a file in the directory
                             
                             \
                             
                             **From client1**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (Directory, with SMB2\_CREATE\_REQUEST\_LEASE\_V2 with LeaseState SMB2\_LEASE\_READ\_CACHING)
                             
                             \
                             
                             **From client2 to trigger lease break by deleting the child item**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (File in the directory, with DELETE access mask and FILE\_DELETE\_ON\_CLOSE create option)
                             
                             CLOSE to commit the delete
                             
                             \
                             
                             **From client1**
                             
                             Receive LEASE\_BREAK
                             
                             Send LEASE\_BREAK\_ACK if server requires
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF
                             
                             \
                             
                             **From client2**
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ---------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------
  **Test ID**                DirectoryLeasing\_BreakReadCachingByChildModified

  **Description**            Test whether server can handle READ lease break notification triggered by modifying child item on a directory.

  **Prerequisites**          \
                             

  **Test Execution Steps**   **Test preparation**
                             
                             Create a directory on a share
                             
                             Create a file in the directory
                             
                             \
                             
                             **From client1**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (Directory, with SMB2\_CREATE\_REQUEST\_LEASE\_V2 with LeaseState SMB2\_LEASE\_READ\_CACHING)
                             
                             \
                             
                             **From client2 to trigger lease break by modifying the child item**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (File in the directory, with WRITE access mask)
                             
                             WRITE content to the file
                             
                             CLOSE to commit the write
                             
                             \
                             
                             **From client1**
                             
                             Receive LEASE\_BREAK
                             
                             Send LEASE\_BREAK\_ACK if server requires
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF
                             
                             \
                             
                             **From client2**
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ----------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DirectoryLeasing\_BreakHandleCachingByConflictOpen

  **Description**            Test whether server can handle HANDLE lease break notification triggered by a conflict open.

  **Prerequisites**          \
                             

  **Test Execution Steps**   **Test preparation**
                             
                             Create a directory on a share
                             
                             \
                             
                             **From client1**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (Directory, with SMB2\_CREATE\_REQUEST\_LEASE\_V2 with LeaseState SMB2\_LEASE\_HANDLE\_CACHING | SMB2\_LEASE\_READ\_CACHING and with NO share access)
                             
                             \
                             
                             **From client2 to trigger lease break by sharing\_violate access**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (File in the directory, with WRITE access mask)
                             
                             \
                             
                             **From client1**
                             
                             Receive LEASE\_BREAK
                             
                             Send LEASE\_BREAK\_ACK if server requires
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF
                             
                             \
                             
                             **From client2**
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DirectoryLeasing\_BreakHandleCachingByParentDeleted

  **Description**            Test whether server can handle HANDLE lease break notification triggered by deleting parent directory.

  **Prerequisites**          \
                             

  **Test Execution Steps**   **Test preparation**
                             
                             Create a parent directory on a share
                             
                             Create a test directory in the parent directory
                             
                             \
                             
                             **From client1**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (on test directory, with SMB2\_CREATE\_REQUEST\_LEASE\_V2 with LeaseState SMB2\_LEASE\_HANDLE\_CACHING | SMB2\_LEASE\_READ\_CACHING)
                             
                             \
                             
                             **From client2 to trigger lease break by deleting the parent directory**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (on the parent directory, with DELETE access mask and FILE\_DELETE\_ON\_CLOSE create option)
                             
                             SetInfo (FileDispositionInformation with DeletePending = 1)
                             
                             CLOSE to commit the delete
                             
                             \
                             
                             // Additional CREATE to open the parent directory to trigger the lease break
                             
                             // It’s the same way for Windows attempt to delete the parent directory when //child is opened by others
                             
                             CREATE (on the parent directory, with DELETE access mask and FILE\_DELETE\_ON\_CLOSE create option)
                             
                             \
                             
                             \
                             
                             **From client1**
                             
                             Receive LEASE\_BREAK
                             
                             Send LEASE\_BREAK\_ACK if server requires
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF
                             
                             \
                             
                             **From client2**
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DirectoryLeasing\_BreakHandleCachingByParentRenamed

  **Description**            Test whether server can handle HANDLE lease break notification triggered by renaming parent directory.

  **Prerequisites**          \
                             

  **Test Execution Steps**   **Test preparation**
                             
                             Create a parent directory on a share
                             
                             Create a test directory in the parent directory
                             
                             \
                             
                             **From client1**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (on the test directory, with SMB2\_CREATE\_REQUEST\_LEASE\_V2 with LeaseState SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING)
                             
                             \
                             
                             **From client2 to trigger lease break by renaming the parent directory**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (on the parent directory, with DELETE access mask and FILE\_DELETE\_ON\_CLOSE create option)
                             
                             SetInfo ( with FileRenameInformation to rename the file)
                             
                             \
                             
                             **From client1**
                             
                             Receive LEASE\_BREAK
                             
                             Send LEASE\_BREAK\_ACK if server requires
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF
                             
                             \
                             
                             **From client2**
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------

\
\

3.  #### DirectoryLeasing\_WriteCachingCleared {.western}

    1.  ##### Scenario {.western}

  ------------------------------- -----------------------------------------------------------
  **Description**                 Verify WRITE caching is cleared when server grants lease

  **Message Sequence**            **Test preparation**
                                  
                                  Create a directory on a share
                                  
                                  \
                                  
                                  **From client1**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (Directory, with SMB2\_CREATE\_REQUEST\_LEASE\_V2)
                                  
                                  Verify no WRITE caching is granted by server
                                  
                                  \
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **NO**
  ------------------------------- -----------------------------------------------------------

\
\

2.  ##### Test Case {.western}

  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DirectoryLeasing\_RWGrantedAsR

  **Description**            Verify only SMB2\_LEASE\_READ\_CACHING granted when client request SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_WRITE\_CACHING

  **Prerequisites**          \
                             

  **Test Execution Steps**   **Test preparation**
                             
                             Create a directory on a share
                             
                             \
                             
                             **From client1**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (Directory, with SMB2\_CREATE\_REQUEST\_LEASE\_V2 and LeaseState SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_WRITE\_CACHING)
                             
                             Verify server only granted SMB2\_LEASE\_READ\_CACHING in response
                             
                             \
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DirectoryLeasing\_RWHGrantedAsRH

  **Description**            Verify only SMB2\_ SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING granted when client request SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_WRITE\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING

  **Prerequisites**          \
                             

  **Test Execution Steps**   **Test preparation**
                             
                             Create a directory on a share
                             
                             \
                             
                             **From client1**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (Directory, with SMB2\_CREATE\_REQUEST\_LEASE\_V2 and LeaseState SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_WRITE\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING)
                             
                             Verify server only granted SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING in response
                             
                             \
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

6.  ### Encryption {.western}

    1.  #### Model {.western}

**Encryption** Model is to test whether the server can handle encryption
functionality correctly according to client request and server
configuration.

The feature has 90 Model-Based test cases and 5 traditional test case.

1.  ##### Coverage {.western}

**Encryption** Model covers all statements (except which are mentioned
in “Assumptions/Restrictions”) of the following sections:

3.1.4.3 Encrypting the Message

3.2.5.1.3 Verifying the Signature

3.2.5.3.1 Handling a New Authentication

3.2.5.5 Receiving an SMB2 TREE\_CONNECT Response

2.  ##### Assumptions/Restrictions {.western}

This model doesn’t test the specific algorithm mentioned in section
2.2.41, which will be covered with traditional test cases.

This model doesn’t test TRANSFORM\_HEADER message type, which will be
covered with traditional test cases

3.  ##### Scenario Design {.western}

This model has one scenario:

  ------------------- ----------------------------------------------------------------------------------------------------------------
  **Scenario Name**   Encryption

  **Description**     It’s a basic scenario to test how the server handles encryption request under different situation.

  **Machine**          ReadConfig; 
                      
                       SetupConnection; //Negotiate
                      
                       (
                      
                      SessionSetupRequest;
                      
                      SessionSetupResponse;
                      
                      TreeConnectRequest;
                      
                      (TreeConnectResponse|ExpectDisconnect);
                      
                      (
                      
                      FileOperationVerifyEncryptionRequest; //Write, Read
                      
                      (FileOperationVerifyEncryptionResponse|ExpectDisconnect);
                      
                      //If the server which does not support encryption receive encrypted message, it will disconnect the connection
                      
                      )?;
                      
                      );
  ------------------- ----------------------------------------------------------------------------------------------------------------

2.  #### Traditional case {.western}

For traditional encryption BVT test cases, refer to section
[3.1.12](#_Encryption).

1.  #### For other traditional encryption test cases, refer to section [3.4.5](#_FileServerFailover_Encryption). {.western}

### Handle {.western}

1.  #### Model {.western}

    1.  ##### Coverage {.western}

**Handle** Model covers all statements (except which are mentioned in
“Assumptions/Restrictions”) of the following sections:

-   3.3.5.6 Receiving an SMB2 LOGOFF Request

-   3.3.5.9 Receiving an SMB2 CREATE Request.

-   3.3.5.9.6 Handling the SMB2\_CREATE\_DURABLE\_HANDLE\_REQUEST Create
    Context

-   3.3.5.9.7 Handling the SMB2\_CREATE\_DURABLE\_HANDLE\_RECONNECT
    Create Context

-   3.3.5.9.10 Handling the SMB2\_CREATE\_DURABLE\_HANDLE\_REQUEST\_V2
    Create Context

-   3.3.5.9.12 Handling the SMB2\_CREATE\_DURABLE\_HANDLE\_RECONNECT\_V2
    Create Context

1.  ##### Assumptions/Restrictions {.western}

-   All lease state used in this model is SMB2\_LEASE\_HANDLE\_CACHING |
    SMB2\_LEASE\_READ\_CACHING

-   The model does not cover the scenario that the file name in
    ReconnectOpenRequest is different from PrepareOpen.

-   Open in this model is an open to a non-directory file.

-   The model does not cover the scenario that the dialect negotiated in
    ReconnectOpenRequest is different from PrepareOpen.

3.  ##### Scenario Design {.western}

This model has 10 scenarios:

  ------------------- ------------------------------------------------------------------------------------------------------------
  **Scenario Name**   RequestDurableHandleV1BatchOplock

  **Description**     Basic scenario to test create durable handle v1 with batch oplock

  **Machine**         ReadConfig;
                      
                      OpenRequest(
                      
                      {ModelDialectRevision.Smb21, ModelDialectRevision.Smb30, ModelDialectRevision.Smb302}, // clientMaxDialect
                      
                      PersistentBitType.PersistentBitNotSet,
                      
                      CAShareType.NonCAShare,
                      
                      {OplockLeaseType.BatchOplock, OplockLeaseType.NoOplockOrLease},
                      
                      \_, // durableV1RequestContext
                      
                      DurableV2RequestContext.DurableV2RequestContextNotExist,
                      
                      \_, // durableV1ReconnectContext
                      
                      DurableV2ReconnectContext.DurableV2ReconnectContextNotExist);
                      
                      OpenResponse;
  ------------------- ------------------------------------------------------------------------------------------------------------

\

  ------------------- ------------------------------------------------------------------------------------------------------------
  **Scenario Name**   RequestDurableHandleV1LeaseV1

  **Description**     Basic scenario to test create durable handle v1 with lease v1

  **Machine**         ReadConfig;
                      
                      OpenRequest(
                      
                      {ModelDialectRevision.Smb21, ModelDialectRevision.Smb30, ModelDialectRevision.Smb302}, // clientMaxDialect
                      
                      PersistentBitType.PersistentBitNotSet,
                      
                      CAShareType.NonCAShare,
                      
                      {OplockLeaseType.LeaseV1, OplockLeaseType.NoOplockOrLease},
                      
                      \_, // durableV1RequestContext
                      
                      DurableV2RequestContext.DurableV2RequestContextNotExist,
                      
                      \_, // durableV1ReconnectContext
                      
                      DurableV2ReconnectContext.DurableV2ReconnectContextNotExist);
                      
                      OpenResponse;
  ------------------- ------------------------------------------------------------------------------------------------------------

\

  ------------------- --------------------------------------------------------------------------------------------------------------------------------------------
  **Scenario Name**   RequestDurableHandleV2BatchOplock

  **Description**     Basic scenario to test create durable handle v2 with batch oplock

  **Machine**         ReadConfig;
                      
                      OpenRequest(
                      
                      {ModelDialectRevision.Smb30, ModelDialectRevision.Smb302}, // clientMaxDialect
                      
                      PersistentBitType.PersistentBitNotSet,
                      
                      CAShareType.NonCAShare,
                      
                      {OplockLeaseType.BatchOplock, OplockLeaseType.NoOplockOrLease},
                      
                      DurableV1RequestContext.DurableV1RequestContextNotExist,
                      
                      {DurableV2RequestContext.DurableV2RequestContextExistWithoutPersistent, DurableV2RequestContext.DurableV2RequestContextNotExist},
                      
                      DurableV1ReconnectContext.DurableV1ReconnectContextNotExist,
                      
                      {DurableV2ReconnectContext.DurableV2ReconnectContextExistWithoutPersistent, DurableV2ReconnectContext.DurableV2ReconnectContextNotExist});
                      
                      OpenResponse;
  ------------------- --------------------------------------------------------------------------------------------------------------------------------------------

\

  ------------------- --------------------------------------------------------------------------------------------------------------------------------------------
  **Scenario Name**   RequestDurableHandleV2LeaseV1

  **Description**     Basic scenario to test create durable handle v2 with lease v1

  **Machine**         ReadConfig;
                      
                      OpenRequest(
                      
                      {ModelDialectRevision.Smb30, ModelDialectRevision.Smb302}, // clientMaxDialect
                      
                      PersistentBitType.PersistentBitNotSet,
                      
                      CAShareType.NonCAShare,
                      
                      {OplockLeaseType.LeaseV1, OplockLeaseType.NoOplockOrLease},
                      
                      DurableV1RequestContext.DurableV1RequestContextNotExist,
                      
                      {DurableV2RequestContext.DurableV2RequestContextExistWithoutPersistent, DurableV2RequestContext.DurableV2RequestContextNotExist},
                      
                      DurableV1ReconnectContext.DurableV1ReconnectContextNotExist,
                      
                      {DurableV2ReconnectContext.DurableV2ReconnectContextExistWithoutPersistent, DurableV2ReconnectContext.DurableV2ReconnectContextNotExist});
                      
                      OpenResponse;
  ------------------- --------------------------------------------------------------------------------------------------------------------------------------------

\

  ------------------- --------------------------------------------------------------------------------------------------------------------------------------------
  **Scenario Name**   RequestDurableHandleV2LeaseV2

  **Description**     Basic scenario to test create durable handle v2 with lease v2

  **Machine**         ReadConfig;
                      
                      OpenRequest(
                      
                      {ModelDialectRevision.Smb30, ModelDialectRevision.Smb302}, // clientMaxDialect
                      
                      PersistentBitType.PersistentBitNotSet,
                      
                      CAShareType.NonCAShare,
                      
                      {OplockLeaseType.LeaseV1, OplockLeaseType.NoOplockOrLease},
                      
                      DurableV1RequestContext.DurableV1RequestContextNotExist,
                      
                      {DurableV2RequestContext.DurableV2RequestContextExistWithoutPersistent, DurableV2RequestContext.DurableV2RequestContextNotExist},
                      
                      DurableV1ReconnectContext.DurableV1ReconnectContextNotExist,
                      
                      {DurableV2ReconnectContext.DurableV2ReconnectContextExistWithoutPersistent, DurableV2ReconnectContext.DurableV2ReconnectContextNotExist});
                      
                      OpenResponse;
  ------------------- --------------------------------------------------------------------------------------------------------------------------------------------

\

  ------------------- -----------------------------------------------------------------------------------------------------------------------------------------
  **Scenario Name**   RequestPersistentHandle

  **Description**     Basic scenario to test create persistent handle

  **Machine**         ReadConfig;
                      
                      OpenRequest(
                      
                      {ModelDialectRevision.Smb30, ModelDialectRevision.Smb302}, // clientMaxDialect
                      
                      \_, // persistentBit
                      
                      \_, // connectToCAShare
                      
                      OplockLeaseType.NoOplockOrLease,
                      
                      DurableV1RequestContext.DurableV1RequestContextNotExist,
                      
                      {DurableV2RequestContext.DurableV2RequestContextExistWithPersistent, DurableV2RequestContext.DurableV2RequestContextNotExist},
                      
                      DurableV1ReconnectContext.DurableV1ReconnectContextNotExist,
                      
                      {DurableV2ReconnectContext.DurableV2ReconnectContextExistWithPersistent, DurableV2ReconnectContext.DurableV2ReconnectContextNotExist});
                      
                      OpenResponse;
  ------------------- -----------------------------------------------------------------------------------------------------------------------------------------

\

  ------------------- ------------------------------------------------------------------------------------------------------------
  **Scenario Name**   DurableHandleV1PreparedWithBatchOplockReconnect

  **Description**     Test reconnect durable handle
                      
                      The durablev1 open is created with batch lock
                      
                      Client does Logoff/Disconnect/Nothing.
                      
                      Client reconnects the open.

  **Machine**         ReadConfig;
                      
                      \
                      
                      PrepareOpen(
                      
                      {ModelDialectRevision.Smb21, ModelDialectRevision.Smb30, ModelDialectRevision.Smb302}, // clientMaxDialect
                      
                      PersistentBitType.PersistentBitNotSet,
                      
                      CAShareType.NonCAShare,
                      
                      ModelHandleType.DurableHandleV1,
                      
                      OplockLeaseType.BatchOplock);
                      
                      \
                      
                      (LogOff|Disconnect)?;
                      
                      \
                      
                      ReconnectOpenRequest(
                      
                      \_, // durableV1ReconnectContext
                      
                      DurableV2ReconnectContext.DurableV2ReconnectContextNotExist,
                      
                      {OplockLeaseType.BatchOplock, OplockLeaseType.NoOplockOrLease},
                      
                      \_, // leaseKeyDifferentialType
                      
                      \_, // clientIdType
                      
                      \_);// createGuidType
                      
                      \
                      
                      OpenResponse;
  ------------------- ------------------------------------------------------------------------------------------------------------

\

  ------------------- ----------------------------------------------------------------------------------------
  **Scenario Name**   DurableHandleV1PreparedWithLeaseV1Reconnect

  **Description**     Test reconnect durable handle
                      
                      The durablev1 open is created with lease v1
                      
                      Client does Logoff/Disconnect/Nothing.
                      
                      Client reconnects the open.

  **Machine**         ReadConfig;
                      
                      PrepareOpen(
                      
                      {ModelDialectRevision.Smb21, ModelDialectRevision.Smb30, ModelDialectRevision.Smb302},
                      
                      PersistentBitType.PersistentBitNotSet,
                      
                      CAShareType.NonCAShare,
                      
                      ModelHandleType.DurableHandleV1,
                      
                      OplockLeaseType.LeaseV1);
                      
                      \
                      
                      (LogOff|Disconnect)?;
                      
                      \
                      
                      ReconnectOpenRequest(
                      
                      \_, // durableV1ReconnectContext
                      
                      DurableV2ReconnectContext.DurableV2ReconnectContextNotExist,
                      
                      {OplockLeaseType.LeaseV1, OplockLeaseType.NoOplockOrLease},
                      
                      \_, // leaseKeyDifferentialType
                      
                      \_, // clientIdType
                      
                      \_);// createGuidType
                      
                      \
                      
                      OpenResponse;
  ------------------- ----------------------------------------------------------------------------------------

\

  ------------------- -------------------------------------------------------------------------------------------------------------------------------------------
  **Scenario Name**   DurableHandleV2PreparedWithBatchOplockReconnect

  **Description**     Test reconnect durable handle
                      
                      The durablev2 open is created with batch oplock
                      
                      Client does Logoff/Disconnect/Nothing.
                      
                      Client reconnects the open.
                      
                      The cases are only applied for Dialect 3.0 or later.

  **Machine**         ReadConfig;
                      
                      PrepareOpen(
                      
                      {ModelDialectRevision.Smb30, ModelDialectRevision.Smb302},
                      
                      PersistentBitType.PersistentBitNotSet,
                      
                      CAShareType.NonCAShare,
                      
                      ModelHandleType.DurableHandleV2,
                      
                      OplockLeaseType.BatchOplock);
                      
                      \
                      
                      (LogOff|Disconnect)?;
                      
                      \
                      
                      ReconnectOpenRequest(
                      
                      DurableV1ReconnectContext.DurableV1ReconnectContextNotExist,
                      
                      {DurableV2ReconnectContext.DurableV2ReconnectContextExistWithoutPersistent, DurableV2ReconnectContext.DurableV2ReconnectContextNotExist},
                      
                      {OplockLeaseType.BatchOplock, OplockLeaseType.NoOplockOrLease},
                      
                      \_, // leaseKeyDifferentialType
                      
                      \_, // clientIdType
                      
                      \_);// createGuidType
                      
                      \
                      
                      OpenResponse;
  ------------------- -------------------------------------------------------------------------------------------------------------------------------------------

\

  ------------------- -------------------------------------------------------------------------------------------------------------------------------------------
  **Scenario Name**   DurableHandleV2PreparedWithLeaseV1Reconnect

  **Description**     Test reconnect durable handle
                      
                      The durablev2 open is created with lease v1
                      
                      Client does Logoff/Disconnect/Nothing.
                      
                      Client reconnects the open.
                      
                      The cases are only applied for Dialect 3.0 or later.

  **Machine**         ReadConfig;
                      
                      PrepareOpen(
                      
                      {ModelDialectRevision.Smb30, ModelDialectRevision.Smb302},
                      
                      PersistentBitType.PersistentBitNotSet,
                      
                      CAShareType.NonCAShare,
                      
                      ModelHandleType.DurableHandleV2,
                      
                      OplockLeaseType.LeaseV1);
                      
                      \
                      
                      (LogOff|Disconnect)?;
                      
                      \
                      
                      ReconnectOpenRequest(
                      
                      DurableV1ReconnectContext.DurableV1ReconnectContextNotExist,
                      
                      {DurableV2ReconnectContext.DurableV2ReconnectContextExistWithoutPersistent, DurableV2ReconnectContext.DurableV2ReconnectContextNotExist},
                      
                      {OplockLeaseType.LeaseV1, OplockLeaseType.NoOplockOrLease},
                      
                      \_, // leaseKeyDifferentialType
                      
                      \_, // clientIdType
                      
                      \_);// createGuidType
                      
                      \
                      
                      OpenResponse;
  ------------------- -------------------------------------------------------------------------------------------------------------------------------------------

\

  ------------------- -------------------------------------------------------------------------------------------------------------------------------------------
  **Scenario Name**   DurableHandleV2PreparedWithLeaseV2Reconnect

  **Description**     Test reconnect durable handle
                      
                      The durablev2 open is created with lease v2
                      
                      Client does Logoff/Disconnect/Nothing.
                      
                      Client reconnects the open.
                      
                      The cases are only applied for Dialect 3.0 or later.

  **Machine**         ReadConfig;
                      
                      PrepareOpen(
                      
                      {ModelDialectRevision.Smb30, ModelDialectRevision.Smb302},
                      
                      PersistentBitType.PersistentBitNotSet,
                      
                      CAShareType.NonCAShare,
                      
                      ModelHandleType.DurableHandleV2,
                      
                      OplockLeaseType.LeaseV2);
                      
                      \
                      
                      (LogOff|Disconnect)?;
                      
                      \
                      
                      ReconnectOpenRequest(
                      
                      DurableV1ReconnectContext.DurableV1ReconnectContextNotExist,
                      
                      {DurableV2ReconnectContext.DurableV2ReconnectContextExistWithoutPersistent, DurableV2ReconnectContext.DurableV2ReconnectContextNotExist},
                      
                      {OplockLeaseType.LeaseV2, OplockLeaseType.NoOplockOrLease},
                      
                      \_, // leaseKeyDifferentialType
                      
                      \_, // clientIdType
                      
                      \_);// createGuidType
                      
                      \
                      
                      OpenResponse;
  ------------------- -------------------------------------------------------------------------------------------------------------------------------------------

\

  ------------------- --------------------------------------------------------------
  **Scenario Name**   PersistentHandleReconnect

  **Description**     Test reconnect persistent handle
                      
                      The persistent open is created.
                      
                      Client does Logoff/Disconnect.
                      
                      Client reconnects to the open.
                      
                      The cases are only applied for Dialect 3.0 or later.

  **Machine**         ReadConfig;
                      
                      PrepareOpen(
                      
                      {ModelDialectRevision.Smb30, ModelDialectRevision.Smb302},
                      
                      \_, // persistentBit
                      
                      CAShareType.CAShare, // connectToCAShare
                      
                      ModelHandleType.PersistentHandle,
                      
                      OplockLeaseType.NoOplockOrLease);
                      
                      \
                      
                      (LogOff|Disconnect);
                      
                      \
                      
                      ReconnectOpenRequest(
                      
                      DurableV1ReconnectContext.DurableV1ReconnectContextNotExist,
                      
                      \_, // durableV2ReconnectContext
                      
                      OplockLeaseType.NoOplockOrLease,
                      
                      \_, // leaseKeyDifferentialType
                      
                      \_, // clientIdType
                      
                      \_);// createGuidType
                      
                      \
                      
                      OpenResponse;
  ------------------- --------------------------------------------------------------

2.  #### Traditional case {.western}

The traditional test case is used to cover the below statement in
section 3.3.5.9.7:

If the user represented by SessionSecurityContext is not the same user
denoted by Open.DurableOwner, the server MUST fail the request with
STATUS\_ACCESS\_DENIED. 

If the server disconnect the connection, the reconnect will be
successful.

  ------------------------------- -----------------------------------------------------------------------------------
  **Test ID**                     DurableHandleV2\_Reconnection\_WithDifferentDurableOwner

  **Description**                 Test reconnect with different durable owner will fail with STATUS\_ACCESS\_DENIED

  **Message Sequence**            **Open a file and request durable handle v2 then write content to file**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (with CREATE\_DURABLE\_HANDLE\_REQUEST\_V2)
                                  
                                  WRITE
                                  
                                  \
                                  
                                  **Disconnect/Reconnect the network to simulate network failure**
                                  
                                  **Reconnect previous durable handle v2 and read content from file**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP (Reconnect using different account credential)
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (with CREATE\_DURABLE\_HANDLE\_RECONNECT\_V2)
                                  
                                  \
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **NO**
  ------------------------------- -----------------------------------------------------------------------------------

\
\

  ------------------------------- --------------------------------------------------------------------------------------------------
  **Test ID**                     DurableHandleV1\_Reconnect\_WithoutLogoffOrDisconnect\_WithPreviousSessionIdSet

  **Description**                 Test reconnect with DurableHandleV1, without log off or disconnect but with previous session id.

  **Message Sequence**            **Open a file and request durable handle v1 then write content to file**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (with CREATE\_DURABLE\_HANDLE\_REQUEST\_V1)
                                  
                                  WRITE
                                  
                                  \
                                  
                                  **Reconnect previous durable handle v2 and read content from file**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP (Reconnect using SessionId in above step as PreviousSessionId)
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (with CREATE\_DURABLE\_HANDLE\_RECONNECT\_V1)
                                  
                                  \
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **NO**
  ------------------------------- --------------------------------------------------------------------------------------------------

\
\

  ------------------------------- -----------------------------------------------------------------------------------------------------
  **Test ID**                     DurableHandleV1\_Reconnect\_WithoutLogoffOrDisconnect\_WithoutPreviousSessionIdSet

  **Description**                 Test reconnect with DurableHandleV1, without log off or disconnect but without previous session id.

  **Message Sequence**            **Open a file and request durable handle v1 then write content to file**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (with CREATE\_DURABLE\_HANDLE\_REQUEST\_V1)
                                  
                                  WRITE
                                  
                                  \
                                  
                                  **Reconnect previous durable handle v2 and read content from file**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP (Reconnect not using SessionId in above step as PreviousSessionId)
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (with CREATE\_DURABLE\_HANDLE\_RECONNECT\_V1)
                                  
                                  \
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **NO**
  ------------------------------- -----------------------------------------------------------------------------------------------------

\
\

  ------------------------------- -------------------------------------------------------------------------------
  **Test ID**                     DurableHandleV1\_Reconnect\_AfterServerDisconnect

  **Description**                 Test reconnect with durable handle V1 with server disconnect

  **Message Sequence**            **Open a file and request durable handle v2 then write content to file**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (with CREATE\_DURABLE\_HANDLE\_REQUEST\_V1)
                                  
                                  WRITE
                                  
                                  \
                                  
                                  **Send Negotiate after create to make server disconnect the connection**
                                  
                                  **Reconnect previous durable handle v1**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP (Reconnect using SessionId in above step as PreviousSessionId)
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (with CREATE\_DURABLE\_HANDLE\_RECONNECT\_V1)
                                  
                                  \
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **NO**
  ------------------------------- -------------------------------------------------------------------------------

\
\

  -------------------------- ------------------------------------------------------------------------------------------------------------
  **Test ID**                DurableHandleV2\_NoPersistenceGrantedOnNonCAShare

  **Description**            Test no persistent handle is granted by the server when the share doesn’t have CA capability

  **Prerequisites**          \
                             

  **Test Execution Steps**   Client sends NEGOTIATE request
                             
                             Server sends NEGOTIATE response
                             
                             Client sends SESSION\_SETUP request
                             
                             Server sends SESSION\_SETUP response
                             
                             According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             Client sends TREE\_CONNECT request to connect share without CA capability
                             
                             Server sends TREE\_CONNECT response (no SMB2\_SHARE\_CAP\_CONTINUOUS\_AVAILABILITY flag set in Capability)
                             
                             Client sends CREATE request with CREATE\_DURABLE\_HANDLE\_REQUEST\_V2 create context
                             
                             Server sends CREATE response (server should not grant persistent handle in response)

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------
  **Test ID**                DurableHandleV2\_Reconnection\_WithoutPersistence

  **Description**            Test durable handle V2 without persistence could be reconnected

  **Prerequisites**          \
                             

  **Test Execution Steps**   Client sends NEGOTIATE request
                             
                             Server sends NEGOTIATE response
                             
                             Client sends SESSION\_SETUP request
                             
                             Server sends SESSION\_SETUP response
                             
                             According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             Client sends TREE\_CONNECT request
                             
                             Server sends TREE\_CONNECT response
                             
                             Client sends CREATE request with CREATE\_DURABLE\_HANDLE\_REQUEST\_V2 create context
                             
                             Client sends WRITE request
                             
                             Server sends WRITE response
                             
                             \
                             
                             **Disconnect the client to simulate network failure**
                             
                             \
                             
                             Client sends NEGOTIATE request
                             
                             Server sends NEGOTIATE response
                             
                             Client sends SESSION\_SETUP request
                             
                             Server sends SESSION\_SETUP response
                             
                             According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             Client sends TREE\_CONNECT request
                             
                             Server sends TREE\_CONNECT response
                             
                             Client sends CREATE request (with CREATE\_DURABLE\_HANDLE\_RECONNECT\_V2)
                             
                             Server sends CREATE response
                             
                             Client sends READ request
                             
                             Server sends READ response
                             
                             Client sends CLOSE request
                             
                             Server sends CLOSE response
                             
                             Client sends TREE\_DISCONNECT request
                             
                             Server sends TREE\_DISCONNECT response
                             
                             Client sends LOGOFF request
                             
                             Server sends LOGOFF response

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------

8.  ### Leasing {.western}

**Leasing** means the client can cache specified data in local. There
are three different capabilities within a lease: READ, WRITE and HANDLE.

-   READ caching permits the SMB2 client to cache data read from the
    object.

-   WRITE caching permits the SMB2 client to cache writes and byte-range
    locks on an object.

-   HANDLE caching permits one or more SMB2 clients to delay closing
    handles it holds open, or to defer sending opens.

The feature has 379 Model-Based test cases and 2 traditional test case.

For traditional BVT test cases, please refer to section
[3.1.11](#_DirectoryLeasing) and [3.1.16](#_FileLeasing)

1.  #### Model {.western}

    1.  ##### Coverage {.western}

This model covers all statements (except which are mentioned in
“Assumptions/Restrictions”) of the following sections:

-   2.2.13.2.8 SMB2\_CREATE\_REQUEST\_LEASE

-   2.2.13.2.10 SMB2\_CREATE\_REQUEST\_LEASE\_V2

-   2.2.23.2 Lease Break Notification

-   2.2.24.2 Lease Break Acknowledgment

-   2.2.25.2 Lease Break Response

-   3.3.1.4 Algorithm for Leasing in an Object Store

-   3.3.4.7 Object Store Indicates a Lease Break

-   3.3.5.9 Receiving an SMB2 CREATE Request

-   3.3.5.9.8 Handling the SMB2\_CREATE\_REQUEST\_LEASE Create Context

-   3.3.5.9.11 Handling the SMB2\_CREATE\_REQUEST\_LEASE\_V2 Create
    Context

-   3.3.5.22.2 Processing a Lease Acknowledgment

1.  ##### Assumptions/Restrictions {.western}

1.  This model only covers the lease on a file and does not cover the
    lease on a directory.

2.  This model does not cover the statements in section “3.3.6.1 Oplock
    Break Acknowledgment Timer Event”.

3.  ##### Scenario Design {.western}

This model has 4 scenarios.

1.  BreakReadLeasingV1

  ----------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Description**   It’s a scenario to test how the server handles read leasing for LeaseV1

  **Machine**       ReadConfig;
                    
                    SetupConnection;
                    
                    CreateRequest(ConnectTargetType.ConnectToNonDirectory, LeaseContextType.LeaseV1, LeaseKeyType.ValidLeaseKey, 1,
                    
                    \_, \_);
                    
                    CreateResponse;
                    
                    (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_OVERWRITE, FileOperation.WRITE\_DATA, FileOperation.SIZE\_CHANGED, FileOperation.RANGE\_LOCK}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    // 1 R -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.None, 1, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    )?;
  ----------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

2.  BreakReadLeasingV2

  ----------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Description**   It’s a scenario to test how the server handles read leasing for LeaseV2.

  **Machine**         ReadConfig;
                    
                    SetupConnection({ModelDialectRevision.Smb30, ModelDialectRevision.Smb302}, \_);
                    
                    CreateRequest(ConnectTargetType.ConnectToNonDirectory, LeaseContextType.LeaseV2, LeaseKeyType.ValidLeaseKey, 1,
                    
                    \_, \_);
                    
                    CreateResponse;
                    
                    (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_OVERWRITE, FileOperation.WRITE\_DATA, FileOperation.SIZE\_CHANGED, FileOperation.RANGE\_LOCK}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    // 1 R -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.None, 1, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    )?;
  ----------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

3.  BreakReadWriteLeasingV1

  ----------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Description**   It’s a scenario to test how the server handles Read&Write leasing for LeaseV1

  **Machine**       ReadConfig;
                    
                    SetupConnection;
                    
                    CreateRequest(ConnectTargetType.ConnectToNonDirectory, LeaseContextType.LeaseV1, LeaseKeyType.ValidLeaseKey, 5,
                    
                    LeaseFlagsValues.SMB2\_LEASE\_FLAG\_PARENT\_LEASE\_KEY\_SET, ParentLeaseKeyType.ValidParentLeaseKey);
                    
                    CreateResponse;
                    
                    (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_WITHOUT\_OVERWRITE}, OperatorType.SameClientId, \_, out \_);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    (
                    
                    (
                    
                    FileOperationToBreakLeaseRequest(FileOperation.OPEN\_OVERWRITE, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    // 1 RW -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 5, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_WITHOUT\_OVERWRITE}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    ((
                    
                    // 2 RW -\> R
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 5, 1);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 1);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 1);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_OVERWRITE, FileOperation.WRITE\_DATA, FileOperation.SIZE\_CHANGED, FileOperation.RANGE\_LOCK}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    // 2.1 R -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.None, 1, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    // 3 RW -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 5, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ))
                    
                    )
                    
                    );
                    
                    )?;
  ----------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

4.  BreakReadWriteLeasingV2

  ----------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Description**   It’s a scenario to test how the server handles Read&Write leasing for LeaseV2

  **Machine**       ReadConfig;
                    
                    SetupConnection({ModelDialectRevision.Smb30, ModelDialectRevision.Smb302}, \_);
                    
                    CreateRequest(ConnectTargetType.ConnectToNonDirectory, LeaseContextType.LeaseV2, LeaseKeyType.ValidLeaseKey, 5,
                    
                    LeaseFlagsValues.SMB2\_LEASE\_FLAG\_PARENT\_LEASE\_KEY\_SET, ParentLeaseKeyType.ValidParentLeaseKey);
                    
                    CreateResponse;
                    
                    (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_WITHOUT\_OVERWRITE}, OperatorType.SameClientId, \_, out \_);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    (
                    
                    (
                    
                    FileOperationToBreakLeaseRequest(FileOperation.OPEN\_OVERWRITE, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    // 1 RW -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 5, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_WITHOUT\_OVERWRITE}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    ((
                    
                    // 2 RW -\> R
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 5, 1);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 1);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 1);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_OVERWRITE, FileOperation.WRITE\_DATA, FileOperation.SIZE\_CHANGED, FileOperation.RANGE\_LOCK}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    // 2.1 R -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.None, 1, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    // 3 RW -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 5, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ))
                    
                    )
                    
                    );
                    
                    )?;
  ----------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

\
\

5.  BreakReadHandleLeasingV1

  ----------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Description**   It’s a scenario to test how the server handles Read&Handle leasing for LeaseV1

  **Machine**       ReadConfig;
                    
                    SetupConnection;
                    
                    CreateRequest(ConnectTargetType.ConnectToNonDirectory, LeaseContextType.LeaseV1, LeaseKeyType.ValidLeaseKey, 3,
                    
                    LeaseFlagsValues.SMB2\_LEASE\_FLAG\_PARENT\_LEASE\_KEY\_SET, ParentLeaseKeyType.ValidParentLeaseKey);
                    
                    CreateResponse;
                    
                    (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_SHARING\_VIOLATION, FileOperation.OPEN\_SHARING\_VIOLATION\_WITH\_OVERWRITE, FileOperation.RENAMEED}, OperatorType.SameClientId, \_, out \_);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ((
                    
                    FileOperationToBreakLeaseRequest(FileOperation.DELETED, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    ((
                    
                    // 1 RH -\> R, and no other operation after delete
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 1);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 1);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 1);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    // 2 RH -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ))
                    
                    ) | (
                    
                    // 3 RH -\> RH, and no other operation after delete
                    
                    FileOperationToBreakLeaseRequest(FileOperation.DELETED, OperatorType.SameClientId, \_, out \_);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_SHARING\_VIOLATION, FileOperation.OPEN\_SHARING\_VIOLATION\_WITH\_OVERWRITE, FileOperation.RENAMEED}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    ((
                    
                    // 4 RH -\> R
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 1);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 1);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 1);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_OVERWRITE, FileOperation.WRITE\_DATA, FileOperation.SIZE\_CHANGED, FileOperation.RANGE\_LOCK}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    // 4.1 R -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.None, 1, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    // 5 RH -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ))
                    
                    ) | (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.PARENT\_DIR\_RENAMED}, \_, \_, out \_);
                    
                    ((
                    
                    // 6 RH -\> R
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 1);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 1);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 1);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_OVERWRITE, FileOperation.WRITE\_DATA, FileOperation.SIZE\_CHANGED, FileOperation.RANGE\_LOCK}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    // 6.1 R -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.None, 1, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    // 7 RH -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ))
                    
                    ));
                    
                    )?;
  ----------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

6.  BreakReadHandleLeasingV2

  ----------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Description**   It’s a scenario to test how the server handles Read&Handle leasing for LeaseV2

  **Machine**       ReadConfig;
                    
                    SetupConnection({ModelDialectRevision.Smb30, ModelDialectRevision.Smb302}, \_);
                    
                    CreateRequest(ConnectTargetType.ConnectToNonDirectory, LeaseContextType.LeaseV2, LeaseKeyType.ValidLeaseKey, 3,
                    
                    LeaseFlagsValues.SMB2\_LEASE\_FLAG\_PARENT\_LEASE\_KEY\_SET, ParentLeaseKeyType.ValidParentLeaseKey);
                    
                    CreateResponse;
                    
                    (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_SHARING\_VIOLATION, FileOperation.OPEN\_SHARING\_VIOLATION\_WITH\_OVERWRITE, FileOperation.RENAMEED}, OperatorType.SameClientId, \_, out \_);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ((
                    
                    FileOperationToBreakLeaseRequest(FileOperation.DELETED, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    ((
                    
                    // 1 RH -\> R, and no other operation after delete
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 1);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 1);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 1);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    // 2 RH -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ))
                    
                    ) | (
                    
                    // 3 RH -\> RH, and no other operation after delete
                    
                    FileOperationToBreakLeaseRequest(FileOperation.DELETED, OperatorType.SameClientId, \_, out \_);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_SHARING\_VIOLATION, FileOperation.OPEN\_SHARING\_VIOLATION\_WITH\_OVERWRITE, FileOperation.RENAMEED}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    ((
                    
                    // 4 RH -\> R
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 1);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 1);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 1);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_OVERWRITE, FileOperation.WRITE\_DATA, FileOperation.SIZE\_CHANGED, FileOperation.RANGE\_LOCK}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    // 4.1 R -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.None, 1, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    // 5 RH -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ))
                    
                    ) | (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.PARENT\_DIR\_RENAMED}, \_, \_, out \_);
                    
                    ((
                    
                    // 6 RH -\> R
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 1);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 1);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 1);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_OVERWRITE, FileOperation.WRITE\_DATA, FileOperation.SIZE\_CHANGED, FileOperation.RANGE\_LOCK}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    // 6.1 R -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.None, 1, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    // 7 RH -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ))
                    
                    ));
                    
                    )?;
  ----------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

\
\

7.  BreakReadWriteHandleLeasingV1

  ----------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Description**   It’s a scenario to test how the server handles Read&Write&Handle leasing for LeaseV1.

  **Machine**         ReadConfig;
                    
                    SetupConnection;
                    
                    CreateRequest(ConnectTargetType.ConnectToNonDirectory, LeaseContextType.LeaseV1, LeaseKeyType.ValidLeaseKey, 7,
                    
                    LeaseFlagsValues.SMB2\_LEASE\_FLAG\_PARENT\_LEASE\_KEY\_SET, ParentLeaseKeyType.ValidParentLeaseKey);
                    
                    CreateResponse;
                    
                    (
                    
                    (
                    
                    (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_SHARING\_VIOLATION, FileOperation.OPEN\_SHARING\_VIOLATION\_WITH\_OVERWRITE}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_)
                    
                    |
                    
                    FileOperationToBreakLeaseRequest(FileOperation.PARENT\_DIR\_RENAMED, \_, \_, out \_)
                    
                    );
                    
                    ((
                    
                    // 1 RWH -\> RW
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 7, 5);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 5);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 5);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    (
                    
                    (
                    
                    FileOperationToBreakLeaseRequest(FileOperation.OPEN\_OVERWRITE, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    // 1.1 RW -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 5, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_WITHOUT\_OVERWRITE}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    ((
                    
                    // 1.2 RW -\> R
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 5, 1);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 1);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 1);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_OVERWRITE, FileOperation.WRITE\_DATA, FileOperation.SIZE\_CHANGED, FileOperation.RANGE\_LOCK}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    // 1.2.1 R -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.None, 1, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    // 1.3 RW -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 5, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ))
                    
                    )
                    
                    );
                    
                    ) | (
                    
                    // 2 RWH -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 7, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ));
                    
                    ) | (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_WITHOUT\_OVERWRITE}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    ((
                    
                    // 3 RWH -\> RH
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 7, 3);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 3);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 3);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ((
                    
                    FileOperationToBreakLeaseRequest(FileOperation.DELETED, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    ((
                    
                    // 3.1 RH -\> R, and no other operation after delete
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 1);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 1);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 1);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    // 3.2 RH -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ))
                    
                    ) | (
                    
                    // 3.3 RH -\> RH, and no other operation after delete
                    
                    FileOperationToBreakLeaseRequest(FileOperation.DELETED, OperatorType.SameClientId, \_, out \_);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_SHARING\_VIOLATION, FileOperation.OPEN\_SHARING\_VIOLATION\_WITH\_OVERWRITE, FileOperation.RENAMEED}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    ((
                    
                    // 3.4 RH -\> R
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 1);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 1);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 1);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_OVERWRITE, FileOperation.WRITE\_DATA, FileOperation.SIZE\_CHANGED, FileOperation.RANGE\_LOCK}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    // 3.4.1 R -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.None, 1, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    // 3.5 RH -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ))
                    
                    ) | (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.PARENT\_DIR\_RENAMED}, \_, \_, out \_);
                    
                    ((
                    
                    // 3.6 RH -\> R
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 1);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 1);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 1);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_OVERWRITE, FileOperation.WRITE\_DATA, FileOperation.SIZE\_CHANGED, FileOperation.RANGE\_LOCK}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    // 3.6.1 R -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.None, 1, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    // 3.7 RH -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ))
                    
                    ));
                    
                    ) | (
                    
                    // 4 RWH -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 7, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ))
                    
                    )
                    
                    )?;
  ----------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

8.  BreakReadWriteHandleLeasingV2

  ----------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Description**   It’s a scenario to test how the server handles Read&Write&Handle leasing for LeaseV2.

  **Machine**         ReadConfig;
                    
                    SetupConnection({ModelDialectRevision.Smb30, ModelDialectRevision.Smb302}, \_);
                    
                    CreateRequest(ConnectTargetType.ConnectToNonDirectory, LeaseContextType.LeaseV2, LeaseKeyType.ValidLeaseKey, 7,
                    
                    LeaseFlagsValues.SMB2\_LEASE\_FLAG\_PARENT\_LEASE\_KEY\_SET, ParentLeaseKeyType.ValidParentLeaseKey);
                    
                    CreateResponse;
                    
                    (
                    
                    (
                    
                    (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_SHARING\_VIOLATION, FileOperation.OPEN\_SHARING\_VIOLATION\_WITH\_OVERWRITE}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_)
                    
                    |
                    
                    FileOperationToBreakLeaseRequest(FileOperation.PARENT\_DIR\_RENAMED, \_, \_, out \_)
                    
                    );
                    
                    ((
                    
                    // 1 RWH -\> RW
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 7, 5);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 5);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 5);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    (
                    
                    (
                    
                    FileOperationToBreakLeaseRequest(FileOperation.OPEN\_OVERWRITE, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    // 1.1 RW -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 5, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_WITHOUT\_OVERWRITE}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    ((
                    
                    // 1.2 RW -\> R
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 5, 1);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 1);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 1);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_OVERWRITE, FileOperation.WRITE\_DATA, FileOperation.SIZE\_CHANGED, FileOperation.RANGE\_LOCK}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    // 1.2.1 R -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.None, 1, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    // 1.3 RW -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 5, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ))
                    
                    )
                    
                    );
                    
                    ) | (
                    
                    // 2 RWH -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 7, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ));
                    
                    ) | (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_WITHOUT\_OVERWRITE}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    ((
                    
                    // 3 RWH -\> RH
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 7, 3);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 3);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 3);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ((
                    
                    FileOperationToBreakLeaseRequest(FileOperation.DELETED, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    ((
                    
                    // 3.1 RH -\> R, and no other operation after delete
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 1);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 1);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 1);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    // 3.2 RH -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ))
                    
                    ) | (
                    
                    // 3.3 RH -\> RH, and no other operation after delete
                    
                    FileOperationToBreakLeaseRequest(FileOperation.DELETED, OperatorType.SameClientId, \_, out \_);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_SHARING\_VIOLATION, FileOperation.OPEN\_SHARING\_VIOLATION\_WITH\_OVERWRITE, FileOperation.RENAMEED}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    ((
                    
                    // 3.4 RH -\> R
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 1);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 1);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 1);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_OVERWRITE, FileOperation.WRITE\_DATA, FileOperation.SIZE\_CHANGED, FileOperation.RANGE\_LOCK}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    // 3.4.1 R -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.None, 1, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    // 3.5 RH -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ))
                    
                    ) | (
                    
                    FileOperationToBreakLeaseRequest({FileOperation.PARENT\_DIR\_RENAMED}, \_, \_, out \_);
                    
                    ((
                    
                    // 3.6 RH -\> R
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 1);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 1);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 1);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    FileOperationToBreakLeaseRequest({FileOperation.OPEN\_OVERWRITE, FileOperation.WRITE\_DATA, FileOperation.SIZE\_CHANGED, FileOperation.RANGE\_LOCK}, {OperatorType.SameClientGuidDifferentLeaseKey, OperatorType.SecondClient}, \_, out \_);
                    
                    // 3.6.1 R -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.None, 1, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ) | (
                    
                    // 3.7 RH -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 3, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ))
                    
                    ));
                    
                    ) | (
                    
                    // 4 RWH -\> None
                    
                    OnLeaseBreakNotification(\_, LEASE\_BREAK\_Notification\_Packet\_Flags\_Values.SMB2\_NOTIFY\_BREAK\_LEASE\_FLAG\_ACK\_REQUIRED, 7, 0);
                    
                    LeaseBreakAcknowledgmentRequest(ModelLeaseKeyType.ValidLeaseKey, 0);
                    
                    LeaseBreakResponse(ModelSmb2Status.STATUS\_SUCCESS, 0);
                    
                    FileOperationToBreakLeaseResponse;
                    
                    ))
                    
                    )
                    
                    )?;
  ----------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

9.  ### Negotiate {.western}

**Negotiate** means the client can exchange the capabilities with the
server.

The feature has 94 Model-Based test cases and 7 traditional test case.

For traditional test cases, please refer to section
[3.1.6.](#_Negotiation)

1.  #### Model {.western}

    1.  ##### Coverage {.western}

This Model covers all statements (except which are mentioned in
“Assumptions/Restrictions”) of the following sections:

-   2.2.3 SMB2 NEGOTIATE Request

-   2.2.4 SMB2 NEGOTIATE Response

-   3.3.5.2.2 Verifying the Connection State

-   3.3.5.2.3 Verifying the Sequence Number

-   3.3.5.3 Receiving an SMB\_COM\_NEGOTIATE

-   3.3.5.3.1 SMB 2.1 or SMB 3.0 Support

-   3.3.5.3.2 SMB 2.002 Support

-   3.3.5.4 Receiving an SMB2 NEGOTIATE Request

1.  ##### Assumptions/Restrictions {.western}

1.  This model does not test all flags combination of fields in section
    2.2.3 and 2.2.4.

2.  This model focuses on different dialects and different sequences.

3.  ##### Scenario Design {.western}

This model has 1 scenario.

  ----------------- --------------------------------------------------------------------------------------------------------------------------------------------------
  **Description**   It’s a basic scenario to test how the server handles Negotiate Request and ComNegotiate Request with different dialects and different sequences.

  **Machine**        ReadConfig; 
                    
                     SetupConnection;
                    
                      (
                    
                         (ComNegotiateRequest | NegotiateRequest);
                    
                    (NegotiateResponse | ExpectDisconnect)
                    
                     )+;  
  ----------------- --------------------------------------------------------------------------------------------------------------------------------------------------

2.  #### Traditional Case {.western}

Scenario see section [3.1.6.1](#_Scenario_4).

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                Negotiate\_SMB311\_WithoutAnyContexts

  **Description**            This test case is designed to test whether server can handle NEGOTIATE with Smb 3.11 dialect and without any Negotiate Contexts.

  **Prerequisites**          The server implements dialect 3.11.

  **Test Execution Steps**   1.  Client send Negotiate request with dialect SMB 3.11, and without any Negotiate Contexts.
                             
                             2.  Verify server fails the negotiate request with STATUS\_INVALID\_PARAMETER.
                             
                             

  **Cleanup**                \
                             
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                Negotiate\_SMB311\_WithEncryptionContextWithoutIntegrityContext

  **Description**            This test case is designed to test whether server can handle NEGOTIATE with Smb 3.11 dialect, with SMB2\_ENCRYPTION\_CAPABILITIES Context and without SMB2\_PREAUTH\_INTEGRITY\_CAPABILITIES Context.

  **Prerequisites**          The server implements dialect 3.11.

  **Test Execution Steps**   1.  Send Negotiate request with dialect SMB 3.11, with SMB2\_ENCRYPTION\_CAPABILITIES context, without SMB2\_PREAUTH\_INTEGRITY\_CAPABILITIES context.
                             
                             2.  Verify server fails the negotiate request with STATUS\_INVALID\_PARAMETER.
                             
                             

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                Negotiate\_SMB311\_InvalidHashAlgorithm

  **Description**            This test case is designed to test whether server can handle NEGOTIATE with Smb 3.11 dialect and with an invalid HashAlgorithm in SMB2\_PREAUTH\_INTEGRITY\_CAPABILITIES Context.

  **Prerequisites**          The server implements dialect 3.11.

  **Test Execution Steps**   1.  Client send Negotiate request with dialect SMB 3.11, SMB2\_PREAUTH\_INTEGRITY\_CAPABILITIES context and set HashAlgorithm to an invalid value: 0xFFFF.
                             
                             2.  Verify server fails the negotiate request with STATUS\_SMB\_NO\_PREAUTH\_INTEGRITY\_HASH\_OVERLAP.
                             
                             

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                Negotiate\_SMB311\_InvalidCipher

  **Description**            This test case is designed to test whether server can handle NEGOTIATE with Smb 3.11 dialect and with an invalid Cihper in SMB2\_ENCRYPTION\_CAPABILITIES Context.

  **Prerequisites**          The server implements dialect 3.11.

  **Test Execution Steps**   1.  Client Send Negotiate request with dialect SMB 3.11, SMB2\_ENCRYPTION\_CAPABILITIES context and set Cipher to an invalid value: 0xFFFF.
                             
                             2.  Verify that server sets Connection.CipherId to 0 from the response.
                             
                             

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

\
\

10. ### Oplock {.western}

**Oplock** model verifies that server handles Oplock request and
acknowledgement correctly when client requests different Oplock levels
on various types of shares with a follow-up request break previous
Oplock.

The feature contains 336 model-based test cases in 4 scenarios.

1.  #### Model {.western}

    1.  ##### Coverage {.western}

**Oplock** model covers the statements in following sections with
exceptions mentioned in Assumptions/Restrictions section

-   3.3.4.6 Object Store Indicates an Oplock Break

-   3.3.5.9 Receiving an SMB2 CREATE Request (“Oplock Acquisition:”) (By
    default, covered by CreateClose Model)

-   3.3.5.22.1 Processing an Oplock Acknowledgment

1.  ##### Assumption/Restriction {.western}

-   The model does not cover Oplock requested on a directory which is
    not supported.

3.  ##### Scenario Design {.western}

  ------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Scenario Name**   OplockOnShareWithoutForceLevel2OrSOFS

  **Description**     Scenario for Share.ForceLevel2Oplock is FALSE and Share.Type does not includes STYPE\_CLUSTER\_SOFS

  **Machine**         ReadConfig;
                      
                      SetupConnection(\_, ModelShareFlag.NO\_SMB2\_SHAREFLAG\_FORCE\_LEVELII\_OPLOCK, ModelShareType.NO\_STYPE\_CLUSTER\_SOFS); //Negotiate,SessionSetup,TreeConnect
                      
                      RequestOplockAndOperateFileRequest(\_, \_, out \_, out \_);//Request Oplock and do another operation on same file to attempt to trigger Oplock break
                      
                      OplockBreakNotification?; // If no notification arrival, ack on non-breaking oplock will be tested
                      
                      OplockBreakAcknowledgementRequest;
                      
                      OplockBreakResponse;
                      
                      \
                      
  ------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  ------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Scenario Name**   OplockOnShareWithoutForceLevel2WithSOFS

  **Description**     Scenario for Share.ForceLevel2Oplock is FALSE and Share.Type includes STYPE\_CLUSTER\_SOFS

  **Machine**         ReadConfig;
                      
                      SetupConnection(\_, ModelShareFlag.NO\_SMB2\_SHAREFLAG\_FORCE\_LEVELII\_OPLOCK, ModelShareType.STYPE\_CLUSTER\_SOFS); //Negotiate,SessionSetup,TreeConnect
                      
                      RequestOplockAndOperateFileRequest(\_, \_, out \_, out \_);//Request Oplock and do another operation on same file to attempt to trigger Oplock break
                      
                      OplockBreakNotification?; // If no notification arrival, ack on non-breaking oplock will be tested
                      
                      OplockBreakAcknowledgementRequest;
                      
                      OplockBreakResponse;
                      
                      \
                      
  ------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  ------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Scenario Name**   OplockOnShareWithForceLevel2WithoutSOFS

  **Description**     Scenario for Share.ForceLevel2Oplock is TRUE and Share.Type does not includes STYPE\_CLUSTER\_SOFS

  **Machine**         ReadConfig;
                      
                      SetupConnection(\_, ModelShareFlag.SMB2\_SHAREFLAG\_FORCE\_LEVELII\_OPLOCK, ModelShareType.NO\_STYPE\_CLUSTER\_SOFS); //Negotiate,SessionSetup,TreeConnect
                      
                      RequestOplockAndOperateFileRequest(\_, \_, out \_, out \_);//Request Oplock and do another operation on same file to attempt to trigger Oplock break
                      
                      OplockBreakNotification?; // If no notification arrival, ack on non-breaking oplock will be tested
                      
                      OplockBreakAcknowledgementRequest;
                      
                      OplockBreakResponse;
                      
                      \
                      
  ------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  ------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------
  **Scenario Name**   OplockOnShareWithForceLevel2AndSOFS

  **Description**     Scenario for Share.ForceLevel2Oplock is TRUE and Share.Type includes STYPE\_CLUSTER\_SOFS

  **Machine**         ReadConfig;
                      
                      SetupConnection(\_, ModelShareFlag.SMB2\_SHAREFLAG\_FORCE\_LEVELII\_OPLOCK, ModelShareType.STYPE\_CLUSTER\_SOFS); //Negotiate,SessionSetup,TreeConnect
                      
                      RequestOplockAndOperateFileRequest(\_, \_, out \_, out \_); //Request Oplock and do another operation on same file to attempt to trigger Oplock break
                      
                      OplockBreakNotification?; // If no notification arrival, ack on non-breaking oplock will be tested
                      
                      OplockBreakAcknowledgementRequest;
                      
                      OplockBreakResponse;
                      
                      \
                      
  ------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

11. ### Replay {.western}

**Replay** means the client can resend the request to the server and
receive the same response.

The feature has 555 Model-Based test cases and 2 traditional test case.

For traditional test cases, please refer to section [3.1.17](#_Replay)

1.  #### Model {.western}

    1.  ##### Coverage {.western}

This model covers part of statements of the following sections which are
related with replay:

-   2.2.1.1 SMB2 Packet Header - ASYNC

-   2.2.1.2 SMB2 Packet Header - SYNC

-   2.2.13.2.3 SMB2\_CREATE\_DURABLE\_HANDLE\_REQUEST

-   2.2.13.2.8 SMB2\_CREATE\_REQUEST\_LEASE

-   2.2.13.2.10 SMB2\_CREATE\_REQUEST\_LEASE\_V2

-   2.2.13.2.11 SMB2\_CREATE\_DURABLE\_HANDLE\_REQUEST\_V2

-   2.2.14.2.3 SMB2\_CREATE\_DURABLE\_HANDLE\_RESPONSE

-   2.2.14.2.10 SMB2\_CREATE\_RESPONSE\_LEASE

-   2.2.14.2.11 SMB2\_CREATE\_RESPONSE\_LEASE\_V2

-   2.2.14.2.12 SMB2\_CREATE\_DURABLE\_HANDLE\_RESPONSE\_V2

-   2.2.31.3 NETWORK\_RESILIENCY\_REQUEST Request

-   2.2.32 SMB2 IOCTL Response

-   2.2.39 SMB2 SET\_INFO Request

-   2.2.40 SMB2 SET\_INFO Response

-   3.3.5.9.6 Handling the SMB2\_CREATE\_DURABLE\_HANDLE\_REQUEST Create
    Context

-   3.3.5.9.8 Handling the SMB2\_CREATE\_REQUEST\_LEASE Create Context

-   3.3.5.9.11 Handling the SMB2\_CREATE\_REQUEST\_LEASE\_V2 Create
    Context

-   3.3.5.15.9 Handling a Resiliency Request

-   3.3.5.21.1 Handling SMB2\_0\_INFO\_FILE

-   3.3.7.1 Handling Loss of a Connection

This model covers all statements (except which are mentioned in
“Assumptions/Restrictions” of the following sections:

-   3.3.4.1 Sending Any Outgoing Message

-   3.3.5.2.10 Verifying the Channel Sequence Number

-   3.3.5.9.10 Handling the SMB2\_CREATE\_DURABLE\_HANDLE\_REQUEST\_V2
    Create Context

1.  ##### Assumptions/Restrictions {.western}

1.  This model focuses on the flag SMB2\_FLAGS\_REPLAY\_OPERATION and
    ChannelSequence in the SMB2 header.

2.  This model focuses on how to handle the Handling the
    SMB2\_CREATE\_DURABLE\_HANDLE\_REQUEST\_V2 Create Context.

3.  This model also involves multi channels and leasing but only cover
    those behaviors related with replay operations.

4.  This model select READ as negative operation. Both the flag
    SMB2\_FLAGS\_REPLAY\_OPERATION and ChannelSequence should not impact
    the response.

5.  This model selects NETWORK\_RESILIENCY\_REQUEST Request to test
    IOCtl operation.

3.  ##### Scenario Design {.western}

This model has 6 scenarios.

1.  ReplayCreateWithoutHandle

  ----------------- --------------------------------------------------------------------------------------------------------------------------------------------------------
  **Description**   It’s a scenario to test how the server handles a create request with/without replay flag and valid/invalid channel sequence when no handle is created.

  **Machine**       ReadConfig;
                    
                    CreateRequest(
                    
                    {ModelDialectRevision.Smb30, ModelDialectRevision.Smb302},
                    
                    \_, // ReplayModelShareType
                    
                    \_, // ReplayModelClientSupportPersistent
                    
                    ReplayModelSwitchChannelType.MainChannel,
                    
                    \_, // ReplayModelChannelSequenceType
                    
                    \_, // ReplayModelSetReplayFlag
                    
                    \_, // ReplayModelDurableHandle
                    
                    \_, // ReplayModelRequestedOplockLevel
                    
                    \_, // ReplayModelLeaseState
                    
                    ReplayModelFileName.DefaultFileName,
                    
                    ReplayModelCreateGuid.DefaultCreateGuid,
                    
                    ReplayModelFileAttributes.DefaultFileAttributes,
                    
                    ReplayModelCreateDisposition.DefaultCreateDisposition,
                    
                    ReplayModelLeaseKey.DefaultLeaseKey);
                    
                    CreateResponse;
  ----------------- --------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

2.  ReplayCreateNormalHandle

  ----------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Description**   It’s a scenario to test how the server handles a create request with/without replay flag and valid/invalid channel sequence when a normal handle is created.

  **Machine**       ReadConfig;
                    
                    PrepareCreate(
                    
                    \_,
                    
                    ReplayModelClientSupportPersistent.ClientNotSupportPersistent,
                    
                    ReplayModelDurableHandle.NormalHandle,
                    
                    ReplayModelShareType.NonCAShare,
                    
                    ReplayModelRequestedOplockLevel.OplockLevelNone,
                    
                    ReplayModelLeaseState.LeaseStateIsNone);
                    
                    CreateRequest;
                    
                    CreateResponse;
  ----------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

3.  ReplayCreateDurableHandleV1

  ----------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Description**   It’s a scenario to test how the server handles a create request with/without replay flag and valid/invalid channel sequence when a durableV1 handle is created.

  **Machine**       ReadConfig;
                    
                    PrepareCreate(
                    
                    \_,
                    
                    ReplayModelClientSupportPersistent.ClientNotSupportPersistent,
                    
                    ReplayModelDurableHandle.DurableHandleV1,
                    
                    ReplayModelShareType.NonCAShare,
                    
                    ReplayModelRequestedOplockLevel.OplockLevelBatch,
                    
                    {ReplayModelLeaseState.LeaseStateIsNone});
                    
                    CreateRequest;
                    
                    CreateResponse;
  ----------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

4.  ReplayCreateDurableHandleV2

      ----------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      **Description**   It’s a scenario to test how the server handles a create request with/without replay flag and valid/invalid channel sequence when a durableV2 handle (Non persistent) is created.

      **Machine**       ReadConfig;
                        
                        PrepareCreate(
                        
                        \_,
                        
                        ReplayModelClientSupportPersistent.ClientNotSupportPersistent,
                        
                        ReplayModelDurableHandle.DurableHandleV2,
                        
                        ReplayModelShareType.NonCAShare,
                        
                        {ReplayModelRequestedOplockLevel.OplockLevelLeaseV1, ReplayModelRequestedOplockLevel.OplockLevelLeaseV2},
                        
                        {ReplayModelLeaseState.LeaseStateIncludeH});
                        
                        CreateRequest;
                        
                        CreateResponse;
      ----------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

5.  ReplayCreateDurableHandleV2Persistent

      ----------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------
      **Description**   It’s a scenario to test how the server handles a create request with/without replay flag and valid/invalid channel sequence when a persistent handle is created.

      **Machine**       ReadConfig;
                        
                        PrepareCreate(
                        
                        \_,
                        
                        ReplayModelClientSupportPersistent.ClientSupportPersistent,
                        
                        ReplayModelDurableHandle.DurableHandleV2Persistent,
                        
                        ReplayModelShareType.CAShare,
                        
                        {ReplayModelRequestedOplockLevel.OplockLevelLeaseV1, ReplayModelRequestedOplockLevel.OplockLevelLeaseV2},
                        
                        {ReplayModelLeaseState.LeaseStateIncludeH});
                        
                        CreateRequest;
                        
                        CreateResponse;
      ----------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------

6.  ReplayFileOperation

  ----------------- --------------------------------------------------------------------------------------------------------------------------------------------------
  **Description**   It’s a scenario to test how the server handles a READ/WRITE/IOCTL/SET\_INFO request with/without replay flag and valid/invalid channel sequence.

  **Machine**       ReadConfig;
                    
                    PrepareFileOperation({ModelDialectRevision.Smb30, ModelDialectRevision.Smb302}, requestCommand)?;
                    
                    FileOperationRequest(\_, \_, requestCommand, \_, \_, \_);
                    
                    FileOperationResponse;
  ----------------- --------------------------------------------------------------------------------------------------------------------------------------------------

12. ### ResilientHandle {.western}

**ResilientHandle** provides the capability to preserve the open even if
there is intermittent losses in the network connectivity.

1.  #### Model {.western}

    1.  ##### Coverage {.western}

**ResilientHandle** Model covers all statements (except which are
mentioned in “Assumptions/Restrictions”) of section 3.3.5.15.9 in
[MS-SMB2]. And also ResilientHandle Model covers the statements related
to Resilient Handle when Log Off or Loss Connection.

1.  ##### Assumptions/Restrictions {.western}

-   This model does not cover the logic related to Lock/Unlock, which
    will be cover in Lock/Unlock Model.

-   This model does not cover the logic related to Durable Handle, which
    is covered in Handle Model.

-   This model does not cover the logic related to Resilient Scavenger
    Timer, which is covered in traditional test case.

-   This model does not cover logic related to feature combination of
    Resilient Handle and Lease/OpLock Break, which will be covered in
    future Model for feature combination.

-   This model does not cover logic related to feature combination of
    Persistent Handle and Resilient Handle, which will be covered in
    traditional test case.

-   Do not cover common logic related to Receiving IoCtl Request, which
    will be in scope of IoCtrl Model.

3.  ##### Scenario Design {.western}

  ----------------- -------------------------------------------------------------------------------------------------------------------------
  **Scenario ID**   ResilientHandleBasic

  **Description**   Basic scenario to test how the server handles Resiliency Request and Resilient Handle when Log Off and Loss Connection.

  **Machine**       ReadConfig;
                    
                    // Negotiate, SessionSetup, TreeConnect, Create with no durable handle request
                    
                    PrepareOpen(\_, DurableHandle.NoDurableHandle);
                    
                    IoCtlResiliencyRequest; IoCtlResiliencyResponse;
                    
                    ( LogOff; | Disconnect; );
                    
                    // Re-Establish a Resilient Open according to the section 3.2.4.4 in [MS-SMB2]
                    
                    ReEstablishResilientOpenRequest;
                    
                    ReEstablishResilientOpenResponse; 
  ----------------- -------------------------------------------------------------------------------------------------------------------------

\
\

  ----------------- -------------------------------------------------------------------------------------------------------------------------
  **Scenario ID**   ResilientHandleDurable

  **Description**   Test how the server handles Resiliency Request on durable handle and Resilient Handle when Log Off and Loss Connection.

  **Machine**       ReadConfig;
                    
                    // Negotiate, SessionSetup, TreeConnect, Create with durable handle request V1
                    
                    PrepareOpen(\_, DurableHandle.DurableHandle);
                    
                    IoCtlResiliencyRequest; IoCtlResiliencyResponse;
                    
                    ( LogOff; | Disconnect; );
                    
                    // Re-Establish a Resilient Open according to the section 3.2.4.4 in [MS-SMB2]
                    
                    ReEstablishResilientOpenRequest;
                    
                    ReEstablishResilientOpenResponse; 
                    
                    \
                    
  ----------------- -------------------------------------------------------------------------------------------------------------------------

\
\

2.  #### Traditional Case {.western}

\

The traditional case is used to cover the below statement in section
3.3.5.9:

The server MUST verify the request size. If the size of the SMB2 CREATE
Request (excluding the SMB2 header) is less than specified in the
StructureSize field, then the request MUST be failed with STATUS\_
INVALID\_PARAMETER.

1.  ##### Resilient Handle with Persistent Handle {.western}

    1.  ###### Scenario {.western}

\

  ------------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Description**                 Request Resilient Handle on Persistent Handle.
                                  
                                  It covers the below statement in section 3.3.5.9:
                                  
                                  If Connection.Dialect is "3.000" and the request does not contain SMB2\_CREATE\_DURABLE\_HANDLE\_RECONNECT Create Context
                                  
                                  or SMB2\_CREATE\_DURABLE\_HANDLE\_RECONNECT\_V2 Create Context, the server MUST look up an existing open in the GlobalOpenTable where Open.FileName matches the file name in the Buffer field of the request. If an Open entry is found, if Open.IsPersistent is TRUE, \*Open.IsResilient is TRUE\* and if Open.Connection is NULL, the server MUST fail the request with STATUS\_FILE\_NOT\_AVAILABLE.

  **Message Sequence**            Open Persistent Handle with lease
                                  
                                  Send Resiliency Request
                                  
                                  Disconnect
                                  
                                  Open the same file from different client (Different client guid)
                                  
                                  Verify the OPEN is created successfully
                                  
                                  \
                                  

  **Cluster Involved Scenario**   **NO**
  ------------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\

2.  ###### Test Case {.western}

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                ResilientWithPersistentHandle\_OpenFromDiffClient

  **Description**            Verify that whether Open.IsResilient will impact persistent handle.
                             
                             Without resilient handle, server will return STATUS\_FILE\_NOT\_AVAILABLE when open the same file when Open.IsPersistent is True and Open is disconnected.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  SMB2 Negotiate with SUT
                             
                             2.  SMB2 Session Setup
                             
                             3.  SMB2 Tree Connect to Share
                             
                             4.  SMB2 Create with no create context
                             
                             5.  SMB2 Resiliency Request
                             
                             6.  Disconnect
                             
                             7.  SMB2 Negotiate with SUT using new Client Guid
                             
                             8.  SMB2 Session Setup
                             
                             9.  SMB2 Tree Connect to the same Share
                             
                             10. SMB2 Create with same file name
                             
                             11. Verify the Create Response with Status SUCCESS
                             
                             
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

2.  ##### Resilient Open Scavenger Timer {.western}

    1.  ###### Scenario {.western}

\

  ------------------------------- -----------------------------------------------------
  **Description**                 Resilient Open Scavenger Timer

  **Message Sequence**            Open File
                                  
                                  Send Resiliency Request with specific Timeout value
                                  
                                  Disconnect
                                  
                                  Wait for period time
                                  
                                  Verify the OPEN is terminated or not.
                                  
                                  \
                                  

  **Cluster Involved Scenario**   **NO**
  ------------------------------- -----------------------------------------------------

\
\

2.  ###### Test Case {.western}

  -------------------------- ------------------------------------------------------------------------------------------
  **Test ID**                ResilientOpenScavengerTimer\_ReconnectAfterTimeout

  **Description**            Verify that the Open will be terminated after Resilient Open Scavenger Timer is expired.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  SMB2 Negotiate with SUT
                             
                             2.  SMB2 Session Setup
                             
                             3.  SMB2 Tree Connect to Share
                             
                             4.  SMB2 Create with no create context
                             
                             5.  SMB2 Resiliency Request with Timeout = 150 seconds
                             
                             6.  Disconnect
                             
                             7.  Wait for (150 + 10) seconds
                             
                             8.  Re-Establish Resilient Open as section 3.2.4.4 [MS-SMB2]
                             
                             9.  Verify the returned status is STATUS\_OBJECT\_NAME\_NOT\_FOUND.
                             
                             
  -------------------------- ------------------------------------------------------------------------------------------

\
\

  -------------------------- ------------------------------------------------------------------------------------------
  **Test ID**                ResilientOpenScavengerTimer\_ReconnectBeforeTimeout

  **Description**            Verify that the Open will be preserved before Resilient Open Scavenger Timer is expired.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  SMB2 Negotiate with SUT
                             
                             2.  SMB2 Session Setup
                             
                             3.  SMB2 Tree Connect to Share
                             
                             4.  SMB2 Create with no create context
                             
                             5.  SMB2 Resiliency Request with Timeout = 150 seconds
                             
                             6.  Disconnect
                             
                             7.  Wait for (150 – 1) seconds
                             
                             8.  Re-Establish Resilient Open as section 3.2.4.4 [MS-SMB2]
                             
                             9.  Verify the returned status is STATUS\_SUCCESS.
                             
                             
  -------------------------- ------------------------------------------------------------------------------------------

\
\

  -------------------------- -----------------------------------------------------------------------------------------------------------------------
  **Test ID**                ResilientOpenScavengerTimer\_ReconnectBeforeTimeout\_Zero

  **Description**            Verify that the Open will be preserved before Resilient Open Scavenger Timer is expired.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  SMB2 Negotiate with SUT
                             
                             2.  SMB2 Session Setup
                             
                             3.  SMB2 Tree Connect to Share
                             
                             4.  SMB2 Create with no create context
                             
                             5.  SMB2 Resiliency Request with Timeout = 0 seconds, Server should set the timeout to the default value 300 seconds.
                             
                             6.  Disconnect
                             
                             7.  Wait for (300 – 1) seconds
                             
                             8.  Re-Establish Resilient Open as section 3.2.4.4 [MS-SMB2]
                             
                             9.  Verify the returned status is STATUS\_SUCCESS.
                             
                             
  -------------------------- -----------------------------------------------------------------------------------------------------------------------

\
\

13. ### SessionMgmt {.western}

**SessionMgmt** includes setup a session and logoff.

The feature has 251 Model-Based test cases and 3 traditional test cases.

For traditional test cases, please refer to section
[3.1.21](#_SessionMgmt)

1.  #### Model {.western}

    1.  ##### Coverage {.western}

**SessionMgmt** model covers all statements of the following sections:

-   2.2.5 SMB2 SESSION\_SETUP Request

-   2.2.6 SMB2 SESSION\_SETUP Response

-   2.2.7 SMB2 LOGOFF Request

-   2.2.8 SMB2 LOGOFF Request

-   3.3.5.5 Receiving an SMB2 SESSION\_SETUP Request

-   3.3.5.6 Receiving an SMB2 LOGOFF Request

2.  ##### Assumptions/Restrictions {.western}

NA

3.  ##### Scenario Design {.western}

This model has five scenarios:

  ------------------- ------------------------------------------------------------------------------------------------------------------------------------------------
  **Scenario Name**   SessionMgmtNewSession

  **Description**     It’s a basic scenario to test how the server handles SESSION\_SETUP Request and LOGOFF Request. Reconnection and binding is excluded.

  **Machine**           ReadConfig;
                      
                      (
                      
                      SetupConnection(ModelConnectionId.MainConnection,\_);
                      
                      (
                      
                      SessionSetupRequest(ModelConnectionId.MainConnection,\_,\_,ModelSigned.SignFlagNotSet,\_,\_,ModelAllowReauthentication.AllowReauthentication);
                      
                      SessionSetupResponse;
                      
                      )+;
                      
                      (
                      
                      (
                      
                      LogOffRequest(ModelConnectionId.MainConnection,\_);
                      
                      (LogOffResponse|ExpectDisconnect(ModelConnectionId.MainConnection,\_));
                      
                      )
                      
                      )\*;
                      
                      )
  ------------------- ------------------------------------------------------------------------------------------------------------------------------------------------

\
\

**Scenario Name**

SessionMgmtReconnectSession

**Description**

This scenario is to test session reconnection.

**Machine**

ReadConfig;

(

SetupConnection(ModelConnectionId.MainConnection,\_);

SessionSetupRequest(ModelConnectionId.MainConnection,ModelSessionId.ZeroSessionId,ModelSessionId.ZeroSessionId,ModelSigned.SignFlagNotSet,ModelFlags.NotBinding,ModelUser.DefaultUser,ModelAllowReauthentication.AllowReauthentication);

SessionSetupResponse;

(

TerminateConnection(ModelConnectionId.MainConnection);

)?;

SetupConnection(ModelConnectionId.AlternativeConnection,\_);

SessionSetupRequest(ModelConnectionId.AlternativeConnection,
ModelSessionId.ZeroSessionId, {ModelSessionId.MainSessionId,
ModelSessionId.ZeroSessionId,
ModelSessionId.AlternativeSessionId},ModelSigned.SignFlagNotSet,ModelFlags.NotBinding,ModelUser.DefaultUser,ModelAllowReauthentication.AllowReauthentication);

SessionSetupResponse;

)

\

\

\
\

**Scenario Name**

SessionMgmtBindSession

**Description**

This scenario is to test session binding.

**Machine**

ReadConfig;

(

SetupConnection(ModelConnectionId.MainConnection,\_);

SessionSetupRequest(ModelConnectionId.MainConnection,ModelSessionId.ZeroSessionId,ModelSessionId.ZeroSessionId,ModelSigned.SignFlagNotSet,ModelFlags.NotBinding,ModelUser.DefaultUser,ModelAllowReauthentication.NotAllowReauthentication);

SessionSetupResponse;

SetupConnection(ModelConnectionId.AlternativeConnection,\_);

SessionSetupRequest(ModelConnectionId.AlternativeConnection,{ModelSessionId.MainSessionId,
ModelSessionId.ZeroSessionId, ModelSessionId.AlternativeSessionId
/\*ModelSessionId.AlternativeSessionId has same effect as
ModelSessionId.InvalidSessionId
\*/},ModelSessionId.ZeroSessionId,\_,ModelFlags.Binding,\_,ModelAllowReauthentication.AllowReauthentication);

SessionSetupResponse;

)

\

\

\
\

**Scenario Name**

SessionMgmtBindSessionAfterLogOff

**Description**

This scenario is to test session binding after logoff.

**Machine**

ReadConfig;

(

SetupConnection(ModelConnectionId.MainConnection,\_);

SessionSetupRequest(ModelConnectionId.MainConnection,ModelSessionId.ZeroSessionId,ModelSessionId.ZeroSessionId,ModelSigned.SignFlagNotSet,ModelFlags.NotBinding,ModelUser.DefaultUser,ModelAllowReauthentication.AllowReauthentication);

SessionSetupResponse;

(

LogOffRequest(ModelConnectionId.MainConnection,ModelSessionId.MainSessionId);

(LogOffResponse|ExpectDisconnect(ModelConnectionId.MainConnection,\_));

);

SetupConnection(ModelConnectionId.AlternativeConnection,\_);

SessionSetupRequest(ModelConnectionId.AlternativeConnection,{ModelSessionId.MainSessionId,
ModelSessionId.ZeroSessionId, ModelSessionId.AlternativeSessionId
/\*ModelSessionId.AlternativeSessionId has same effect as
ModelSessionId.InvalidSessionId
\*/},ModelSessionId.ZeroSessionId,\_,ModelFlags.Binding,\_,ModelAllowReauthentication.AllowReauthentication);

SessionSetupResponse;

)

\

\

\
\

**Scenario Name**

SessionMgmtBindSessionAfterDisconnection

**Description**

This scenario is to test session binding after disconnection.

**Machine**

ReadConfig;

(

SetupConnection(ModelConnectionId.MainConnection,\_);

SessionSetupRequest(ModelConnectionId.MainConnection,ModelSessionId.ZeroSessionId,ModelSessionId.ZeroSessionId,ModelSigned.SignFlagNotSet,ModelFlags.NotBinding,ModelUser.DefaultUser,ModelAllowReauthentication.AllowReauthentication);

SessionSetupResponse;

(

TerminateConnection(ModelConnectionId.MainConnection);

);

SetupConnection(ModelConnectionId.AlternativeConnection,\_);

SessionSetupRequest(ModelConnectionId.AlternativeConnection,{ModelSessionId.MainSessionId,
ModelSessionId.ZeroSessionId, ModelSessionId.AlternativeSessionId
/\*ModelSessionId.AlternativeSessionId has same effect as
ModelSessionId.InvalidSessionId
\*/},ModelSessionId.ZeroSessionId,\_,ModelFlags.Binding,\_,ModelAllowReauthentication.AllowReauthentication);

SessionSetupResponse;

)

\

\

\
\

1.  #### Traditional Case {.western}

Scenario see [section 3.1.22](#_SessionMgmt)

  ------------------------------- ---------------------------------------------------------------------------------------------------------------------
  **Test ID**                     SessionMgmt\_ReconnectWithDifferentDialect

  **Description**                 This test case is designed to test whether server can handle reconnect with different dialect.

  **Message Sequence**            1.  Client1 sends NEGOTIATE request
                                  
                                  2.  Server sends NEGOTIATE response
                                  
                                  3.  Client1 sends SESSION\_SETUP request with sessionid set zero
                                  
                                  4.  Server sends SESSION\_SETUP response
                                  
                                  5.  Client1 disconnect.
                                  
                                  6.  Client2 sends NEGOTIATE request, with different dialect from the one used by Client1.
                                  
                                  7.  Server sends NEGOTIATE response
                                  
                                  8.  Client2 sends SESSION\_SETUP request with SESSION\_ID set to the value in the previous SESSION\_SETUP response.
                                  
                                  9.  Expect server sends response with STATUS\_USER\_SESSION\_DELETED.
                                  
                                  Client2 disconnect.

  **Cluster Involved Scenario**   NO
  ------------------------------- ---------------------------------------------------------------------------------------------------------------------

\
\

14. ### MultipleChannel {.western}

    1.  #### Traditional Case {.western}

Scenario see [section 3.1.7.1](#_Scenario_1)

  ------------------------------- -------------------------------------------------------
  **Test ID**                     MultipleChannel\_NicRedundantOnClient

  **Description**                 Operate file via multi-channel with 2 Nics on client.

  **Message Sequence**            SETUP\_CONNECTION from client NIC\_1 to SUT NIC\_1
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE
                                  
                                  WRITE
                                  
                                  \
                                  
                                  SETUP\_CONNECTION from client NIC\_2 to SUT NIC\_1
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP binding to the previous one
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE
                                  
                                  READ
                                  
                                  \
                                  
                                  Verify WRITE and READ data should be identical

  **Cluster Involved Scenario**   NO
  ------------------------------- -------------------------------------------------------

\
\

  ------------------------------- -------------------------------------------------------
  **Test ID**                     MultipleChannel\_NicRedundantOnServer

  **Description**                 Operate file via multi-channel with 2 Nics on server.

  **Message Sequence**            SETUP\_CONNECTION from client NIC\_1 to SUT NIC\_1
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE
                                  
                                  WRITE
                                  
                                  \
                                  
                                  SETUP\_CONNECTION from client NIC\_1 to SUT NIC\_2
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP binding to the previous one
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE
                                  
                                  READ
                                  
                                  \
                                  
                                  Verify WRITE and READ data should be identical

  **Cluster Involved Scenario**   NO
  ------------------------------- -------------------------------------------------------

\

  ------------------------------- ----------------------------------------------------
  **Test ID**                     MultipleChannel\_MultiChannelOnSameNic

  **Description**                 Operate file via multi-channel on same Nic.

  **Message Sequence**            SETUP\_CONNECTION from client NIC\_1 to SUT NIC\_1
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE
                                  
                                  WRITE
                                  
                                  \
                                  
                                  SETUP\_CONNECTION from client NIC\_1 to SUT NIC\_1
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP binding to the previous one
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE
                                  
                                  READ
                                  
                                  \
                                  
                                  Verify WRITE and READ data should be identical

  **Cluster Involved Scenario**   NO
  ------------------------------- ----------------------------------------------------

\

  ------------------------------- -------------------------------------------------------------------------------------------------------------------
  **Test ID**                     Negative\_MultipleChannel\_SMB21

  **Description**                 Operate file via multi-channel with SMB21 dialect, expect failure with error code STATUS\_REQUEST\_NOT\_ACCEPTED.

  **Message Sequence**            SETUP\_CONNECTION from client NIC\_1 to SUT NIC\_1
                                  
                                  NEGOTIATE with dialect SMB2.1
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE
                                  
                                  WRITE
                                  
                                  \
                                  
                                  SETUP\_CONNECTION from client NIC\_1 to SUT NIC\_2
                                  
                                  NEGOTIATE with dialect SMB2.1
                                  
                                  SESSION\_SETUP binding to the previous one
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE
                                  
                                  READ
                                  
                                  \
                                  
                                  Expect failure with error code STATUS\_REQUEST\_NOT\_ACCEPTED

  **Cluster Involved Scenario**   NO
  ------------------------------- -------------------------------------------------------------------------------------------------------------------

\

  ------------------------------- ---------------------------------------------------------------------------------------------------------------------
  **Test ID**                     Negative\_MultipleChannel\_SMB2002

  **Description**                 Operate file via multi-channel with SMB2002 dialect, expect failure with error code STATUS\_REQUEST\_NOT\_ACCEPTED.

  **Message Sequence**            SETUP\_CONNECTION from client NIC\_1 to SUT NIC\_1
                                  
                                  NEGOTIATE with dialect SMB2.1
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE
                                  
                                  WRITE
                                  
                                  \
                                  
                                  SETUP\_CONNECTION from client NIC\_1 to SUT NIC\_2
                                  
                                  NEGOTIATE with dialect SMB2.002
                                  
                                  SESSION\_SETUP binding to the previous one
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE
                                  
                                  READ
                                  
                                  \
                                  
                                  Expect failure with error code STATUS\_REQUEST\_NOT\_ACCEPTED

  **Cluster Involved Scenario**   NO
  ------------------------------- ---------------------------------------------------------------------------------------------------------------------

\

15. ### Signing {.western}

**Signing** Model is designed to test the server can handle signing
according to client request and server configuration.

The feature has 95 Model-Based test cases, 1 traditional test case

For traditional test case, please refer to section [3.1.19.](#_Signing)

1.  #### Model {.western}

    1.  ##### Coverage {.western}

**Signing** Model covers all statements (except which are mentioned in
“Assumptions/Restrictions”) of the following sections:

-   2.2.3 SMB2 NEGOTIATE Request

-   2.2.4 SMB2 NEGOTIATE Response

-   2.2.5 SMB2 SESSION\_SETUP Request

-   3.1.4.1 Signing An Outgoing Message

-   3.2.5.1.3 Verifying the Signature

-   3.2.5.3.1 Handling a New Authentication

-   3.2.5.3.2 Handling a Reauthentication

1.  ##### Assumptions/Restrictions {.western}

-   This model doesn’t test the algorithm of calculating the signature,
    for which will be covered with traditional test cases.

3.  ##### Scenario Design {.western}

This model has one scenario:

  ------------------- ---------------------------------------------------------------
  **Scenario Name**   Signing
                      
                      \
                      

  **Description**     It’s a basic scenario to test how the server handles signing.

  **Machine**          ReadConfig; 
                      
                       (
                      
                      NegotiateRequest;
                      
                      NegotiateResponse;
                      
                      \
                      
                      (
                      
                      SessionSetupRequest;
                      
                      SessionSetupResponse;
                      
                      \
                      
                      (
                      
                      TreeConnectRequest;
                      
                      TreeConnectResponse;
                      
                      )?;
                      
                      )?;
                      
                      );
                      
                      \
                      
  ------------------- ---------------------------------------------------------------

\
\

16. ### TreeMgmt {.western}

**TreeMgmt** test the server behavior of receiving TreeConnect and
TreeDisconnect.

1.  #### Model {.western}

    1.  ##### Coverage {.western}

**TreeMgmt** Model covers all statements (except which are mentioned in
“Assumptions/Restrictions”) of the following sections:

-   3.3.5.7 Receiving an SMB2 TREE\_CONNECT Request

-   3.3.5.8 Receiving an SMB2 TREE\_DISCONNECT Request

-   2.2.9 SMB2 TREE\_CONNECT Request

-   2.2.10 SMB2 TREE\_CONNECT Response

-   2.2.11 SMB2 TREE\_DISCONNECT Request

-   2.2.12 SMB2 TREE\_DISCONNECT Response

1.  ##### Assumptions/Restrictions {.western}

-   This model only contains single session with single tree connect.

-   Does not cover encryption related logic which has been covered in
    Encryption model.

-   Does not cover session related logic which has been covered in
    Session Management model.

-   Does not cover validation of Negotiate logic which has been covered
    in Validate Negotiate Info model.

-   Does not cover signing related logic which will be covered in
    Signing model.

-   Does not cover Share Flags SMB2\_SHAREFLAG\_DFS and
    SMB2\_SHAREFLAG\_DFS\_ROOT and Capability SMB2\_SHARE\_CAP\_DFS in
    TREE\_CONNECT response, which is in the scope of DFS test suite.

-   Does not cover Capabilities SMB2\_SHARE\_CAP\_SCALEOUT,
    SMB2\_SHARE\_CAP\_CLUSTER and
    SMB2\_SHARE\_CAP\_CONTINUOUS\_AVAILABILITY in TREE\_CONNECT
    response, which is in the scope of Cluster test suite.

-   Does not cover Share Flag SMB2\_SHAREFLAG\_ENABLE\_HASH in
    TREE\_CONNECT response, which is in the scope of BranchCache test
    suite.

-   Does not cover Share Flag SMB2\_SHAREFLAG\_FORCE\_LEVELII\_OPLOCK in
    TREE\_CONNECT response, which is in the scope of Leasing model and
    OpLock model.

-   Does not cover Share Flag
    SMB2\_SHAREFLAG\_ACCESS\_BASED\_DIRECTORY\_ENUM in TREE\_CONNECT
    response, which is in the scope of Set/Query Info model.

-   Does not cover Share Flags
    SMB2\_SHAREFLAG\_RESTRICT\_EXCLUSIVE\_OPENS and
    SMB2\_SHAREFLAG\_FORCE\_SHARED\_DELETE and MaximalAccess in
    TREE\_CONNECT response, which is in the scope of Create/Close Model.

-   Does not cover Offline. It costs much effort to change the SUT
    control adapter for one not important feature.

-   Only cover ShareType.Disk. Currently Share Type "Pipe" and "Print"
    is not in the scope of FileSharing Test Suite Family.

-   Does not cover detail test of Share Path (example, server name is
    NetBIOS, FQDN or IP address) in TreeConnect request, which is in the
    scope of MS-SRVS.

3.  ##### Scenario Design {.western}

  ------------------- ----------------------------------------------------
  **Scenario Name**   ResilientHandleBasic

  **Description**     TreeMgmt Model basic

  **Machine**         ReadConfig;
                      
                      // Negotiate, SessionSetup
                      
                      SetupConnection;
                      
                      (TreeConnectRequest; TreeConnectResponse;)?;
                      
                      (TreeDisconnectRequest; TreeDisconnectResponse;)+;
  ------------------- ----------------------------------------------------

\
\

2.  #### Traditional Case {.western}

  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                TreeMgmt\_SMB311\_CLUSTER\_RECONNECT

  **Description**            Once a client has successfully connected to a clustered share it must set the CLUSTER\_RECONNECT flag on all subsequent clustered tree connect requests to the same server.
                             
                             This test case is designed to test server can handle a TreeConnect request with flag SMB2\_SHAREFLAG\_CLUSTER\_RECONNECT successfully.

  **Prerequisites**          The server implements dialect 3.11.

  **Test Execution Steps**   1.  Start a client by sending the following requests: NEGOTIATE (dialect 3.11); SESSION\_SETUP.
                             
                             2.  Client sends TREE\_CONNECT request with flag SMB2\_SHAREFLAG\_CLUSTER\_RECONNECT and expects STATUS\_SUCCESS.
                             
                             3.  Tear down the client.
                             
                             

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

17. ### ValidateNegotiateInfo {.western}

Client uses an SMB2 IOCTL Request FSCTL\_VALIDATE\_NEGOTIATE\_INFO to
request validation of a previous SMB2 NEGOTIATE.

1.  #### Model {.western}

    1.  ##### Coverage {.western}

**ValidateNegotiateInfo** Model covers all statements of the following
sections:

-   3.3.5.15.12 Handling a Validate Negotiate Info Request

-   2.2.31.4 VALIDATE\_NEGOTIATE\_INFO Request

-   2.2.32.6 VALIDATE\_NEGOTIATE\_INFO Response

1.  ##### Assumptions/Restrictions {.western}

-   This model doesn’t cover all the parameters’ combination of
    Negotiate request.

3.  ##### Scenario Design {.western}

  ------------------- -----------------------------------------------------------------------------
  **Scenario Name**   ValidateNegotiateInfo

  **Description**     Basic scenario to test how the server handles ValidateNegotiateInfo Request

  **Machine**         ReadConfig;
                      
                      SetupConnection; // Negotiate, Session Setup, Tree Connect
                      
                      ValidateNegotiateInfoRequest;
                      
                      (ValidateNegotiateInfoResponse | TerminateConnection);
  ------------------- -----------------------------------------------------------------------------

\
\

2.  #### Traditional Case {.western}

Scenario see section [3.1.26.1](#_Scenario_7)

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                ValidateNegotiateInfo\_Negative\_InvalidGuid

  **Description**            Test whether the server terminates the transport connection and free the Connection object, if the Guid received in the VALIDATE\_NEGOTIATE\_INFO request structure is not equal to the Connection.ClientGuid.

  **Prerequisites**          The server implements dialect 3.0.

  **Test Execution Steps**   NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             IOCTL (with FSCTL\_VALIDATE\_NEGOTIATE\_INFO having Guid not equal to original ClientGuid)
                             
                             Expected server disconnects the connection

  **Cleanup**                \
                             
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                ValidateNegotiateInfo\_Negative\_InvalidDialects\_NoCommonDialect

  **Description**            Test whether server terminates the transport connection and free the connection object if no dialect is matched when determine the greatest common dialect between the dialects it implements and the dialects array of VALIDATE\_NEGOTIATE\_INFO request.

  **Prerequisites**          The server implements dialect 3.0.

  **Test Execution Steps**   NEGOTIATE with dialect larger or equal to 3.0
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             IOCTL (with FSCTL\_VALIDATE\_NEGOTIATE\_INFO having Dialect set to an unknown value)
                             
                             Expected server disconnects the connection

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                ValidateNegotiateInfo\_Negative\_InvalidDialects\_CommonDialectNotExpected

  **Description**            Test whether the server terminates the transport connection and free the Connection object, if the value is not equal to Connection.Dialect when determine the greatest common dialect between the dialects it implements and the Dialects array of the VALIDATE\_NEGOTIATE\_INFO request.

  **Prerequisites**          The server implements dialect 3.0.

  **Test Execution Steps**   NEGOTIATE with dialect larger or equal to 3.0
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             IOCTL (with FSCTL\_VALIDATE\_NEGOTIATE\_INFO having Dialects set to {smb 2.002, smb 2.1})
                             
                             Expected server disconnects the connection

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                ValidateNegotiateInfo\_Negative\_InvalidGuid

  **Description**            Test whether the server terminates the transport connection and free the Connection object, if the Guid received in the VALIDATE\_NEGOTIATE\_INFO request structure is not equal to the Connection.ClientGuid.

  **Prerequisites**          The server implements dialect 3.0.

  **Test Execution Steps**   NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             IOCTL (with FSCTL\_VALIDATE\_NEGOTIATE\_INFO having Guid field different from the ClientGuid in Negotiate)
                             
                             Expected server disconnects the connection

  **Cleanup**                \
                             
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                ValidateNegotiateInfo\_Negative\_InvalidSecurityMode

  **Description**            Test whether the server terminates the transport connection and free the Connection object, if the SecurityMode received in the VALIDATE\_NEGOTIATE\_INFO request structure is not equal to Connection.ClientSecurityMode.

  **Prerequisites**          The server implements dialect 3.0.

  **Test Execution Steps**   NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             IOCTL (with FSCTL\_VALIDATE\_NEGOTIATE\_INFO having SecurityMode field different from the one in Negotiate)
                             
                             Expected server disconnects the connection

  **Cleanup**                \
                             
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                ValidateNegotiateInfo\_Negative\_InvalidCapabilities

  **Description**            Test whether the server terminates the transport connection and free the Connection object, if Connection.ClientCapabilities is not equal to the Capabilities received in the VALIDATE\_NEGOTIATE\_INFO request structure.

  **Prerequisites**          The server implements dialect 3.0.

  **Test Execution Steps**   NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             IOCTL (with FSCTL\_VALIDATE\_NEGOTIATE\_INFO having ClientCapabilities field different from the one in Negotiate)
                             
                             Expected server disconnects the connection

  **Cleanup**                \
                             
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                ValidateNegotiateInfo\_Negative\_InvalidMaxOutputResponse

  **Description**            Test whether the server terminates the transport connection and free the Connection object, if MaxOutputResponse in the IOCTL request is less than the size of a VALIDATE\_NEGOTIATE\_INFO Response.

  **Prerequisites**          The server implements dialect 3.0.

  **Test Execution Steps**   NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             IOCTL (with FSCTL\_VALIDATE\_NEGOTIATE\_INFO having MaxOutputResponse field less than the size of a VALIDATE\_NEGOTIATE\_INFO Response)
                             
                             Expected server disconnects the connection

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                ValidateNegotiateInfo\_Negative\_SMB311

  **Description**            Test whether the server can terminate the transport connection when receiving a VALIDATE\_NEGOTIATE\_INFO request if the negotiated dialect is 3.11.

  **Prerequisites**          The server implements dialect 3.11.

  **Test Execution Steps**   NEGOTIATE with dialect 3.11
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             IOCTL (with valid FSCTL\_VALIDATE\_NEGOTIATE\_INFO)
                             
                             Expected server disconnects the connection

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

18. ### FileLevelTrim {.western}

This feature is to call IOCTL request with FSCTL\_FILE\_LEVEL\_TRIM to
trim unused space of a file.

1.  #### Model {.western}

\
\

Will not cover this feature in model.

2.  #### Traditional Case {.western}

Scenario see [section 3.1.9.1](#_Scenario_5)

  -------------------------- -----------------------------------------------------------------------------------------------------------
  **Test ID**                FileLevelTrim\_Negative\_NonZeroKeyInRequest

  **Description**            Test the server response when non-zero value is set to the Key field of FSCTL\_FILE\_LEVEL\_TRIM request.

  **Prerequisites**          \
                             

  **Test Execution Steps**   NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE
                             
                             WRITE
                             
                             CREATE
                             
                             IOCTL (with FSCTL\_FILE\_LEVEL\_TRIM, Key field is set to a non-zero random value)
                             
                             Expect to get error response with “STATUS\_INVALID\_PARAMETER”.
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------------------------------------------

\
\

19. ### CopyOfflaod {.western}

This feature is call IOCTL request with FSCTL\_OFFLOAD\_READ and
FSCTL\_OFFLOAD\_WRITE to copy file content.

1.  #### Model {.western}

Will not cover this feature in model.

2.  #### Traditional Case {.western}

Scenario see section [3.1.8.1](#_Scenario_2)

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                CopyOffload\_CopyContentWithinSameFile

  **Description**            This test case is designed to test whether server can handle offload copy correctly when copy content in the same file.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client sends NEGOTIATE request
                             
                             2.  Server sends NEGOTIATE response
                             
                             3.  Client sends SESSION\_SETUP request
                             
                             4.  Server sends SESSION\_SETUP response
                             
                             5.  According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             6.  Client sends TREE\_CONNECT request
                             
                             7.  Server sends TREE\_CONNECT response
                             
                             8.  Client sends CREATE request to create a test file.
                             
                             9.  Server sends CREATE response
                             
                             10. Client sends WRITE request to prepare content test file.
                             
                             11. Server sends WRITE response.
                             
                             12. Client sends FLUSH request to make sure the content is written to backend storage.
                             
                             13. Server sends FLUSH response.
                             
                             14. Client sends IOCTL request with FSCTL\_OFFLOAD\_READ to ask server to generate the token of the 1^st^ half of file content in the file for offload copy.
                             
                             15. Server sends IOCTL response
                             
                             16. Client sends IOCTL request with FSCTL\_OFFLOAD\_WRITE to ask server to copy the content to 2^nd^ half in the file.
                             
                             17. Server sends IOCTL response
                             
                             18. Client sends READ request to read content of 2^nd^ half in the file.
                             
                             19. Server sends READ response
                             
                             20. Compare the read content is identical to the content of 1^st^ half in the file.
                             
                             21. Client sends CLOSE request
                             
                             22. Server sends CLOSE response
                             
                             23. Client sends TREE\_DISCONNECT request
                             
                             24. Server sends TREE\_DISCONNECT response
                             
                             25. Client sends LOGOFF request
                             
                             26. Server sends LOGOFF response
                             
                             

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------

20. ### OperateOneFileFromTwoNodes {.western}

    1.  #### Model {.western}

        1.  ##### Coverage {.western}

This model is designed to test the conflicting scenario:

Two clients do file operations to the same file by connecting to two
Nodes of the scaleout file server. The file operations may have
conflict.

This model covers part of the below sections:

-   2.2.26 SMB2 LOCK Request

-   3.3.5.14 Receiving an SMB2 LOCK Request

-   2.2.13 SMB2 CREATE Request

-   2.2.19 SMB2 READ Request

-   2.2.21 SMB2 WRITE Request

-   2.2.15 SMB2 CLOSE Request

2.  ##### Assumptions/Restrictions {.western}

N/A

1.  ##### Scenario Design {.western}

      ------------------- --------------------------------------------------------------------------------------------
      **Scenario Name**   Conflict

      **Description**     ​1. Prepare a test file and initialize two clients.
                          
                          ​2. The first client does some file operation from one node to the test file successfully.
                          
                          ​3. The second client does some file operation from another node to the same test file.
                          
                          ​4. Verify the response to step 3.

      **Machine**         Preparation;
                          
                          ConflictRequest;
                          
                          ConflictResponse;
      ------------------- --------------------------------------------------------------------------------------------

### MixedOplockLease {.western}

1.  #### Model {.western}

    1.  ##### Coverage {.western}

This model is designed to test the below scenario:

One client requests Oplock, and another client requests Lease.

The model will verify if there should be an oplock or lease break, and
if the granted OplockLevel or LeaseState is correct. (Note: the
verification is based on Windows behavior)

This model covers part of the below sections:

-   3.3.4.7 Object Store Indicates a Lease Break

-   3.3.4.6 Object Store Indicates an Oplock Break

2.  ##### Assumptions/Restrictions {.western}

N/A

3.  ##### Scenario Design {.western}

  ------------------- ---------------------------------------------------------------------------------
  **Scenario Name**   OplockLeaseScenario

  **Description**     ​1. Initialize two clients.
                      
                      ​2. The first client requests Oplock
                      
                      ​3. The second client requests Lease
                      
                      ​4. Verify if there's an oplock break and if the granted LeaseState is correct.

  **Machine**         Preparation;
                      
                      RequestOplock;
                      
                      RequestLease;
                      
                      Verification;
  ------------------- ---------------------------------------------------------------------------------

\
\

  ------------------- --------------------------------------------------------------------------------
  **Scenario Name**   LeaseOplockScenario

  **Description**     ​1. Initialize two clients.
                      
                      ​2. The first client requests Lease
                      
                      ​3. The second client requests Oplock
                      
                      ​4. Verify if there's a lease break and if the granted OplockLevel is correct.

  **Machine**         Preparation;
                      
                      RequestLease;
                      
                      RequestOplock;
                      
                      Verification;
  ------------------- --------------------------------------------------------------------------------

\
\

2.  #### Traditional Case {.western}

No traditional cases for this feature.

3.  SMB2 Feature Combination {.western}
    ------------------------

Following scenarios extend “SMB2 Feature Test” by adding more complex
message sequence in test.

1.  ### MultipleChannelWithReplay {.western}

    1.  #### Scenario {.western}

  ------------------------------- ----------------------------------------------------------------------------------------------------------
  **Description**                 Replay the request via alternative channel when main channel connection lost

  **Message Sequence**            **Create main channel via connection1**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  \
                                  
                                  **Create alterative channel via connection2**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP (SMB2\_SESSION\_FLAG\_BINDING)
                                  
                                  \
                                  
                                  **Send CREATE request via main channel**
                                  
                                  CREATE (with no share access so that same CREATE without SMB2\_FLAGS\_REPLAY\_OPERATION flag would fail)
                                  
                                  \
                                  
                                  **Disconnect connection1**
                                  
                                  \
                                  
                                  **Replay the CREATE request via alternative channel**
                                  
                                  CREATE (with *SMB2\_FLAGS\_REPLAY\_OPERATION flag in header*)
                                  
                                  \
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **NO**
  ------------------------------- ----------------------------------------------------------------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------
  **Test Id**                MultipleChannel\_CreateReplay

  **Description**            Replay the request via alternative channel when main channel connection lost

  **Prerequisites**          \
                             

  **Test Execution Steps**   **Create main channel via connection1**
                             
                             Client sends NEGOTIATE request
                             
                             Server sends NEGOTIATE response
                             
                             Client sends SESSION\_SETUP request
                             
                             Server sends SESSION\_SETUP response
                             
                             According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             Client sends TREE\_CONNECT request
                             
                             Server sends TREE\_CONNECT response
                             
                             \
                             
                             **Create alterative channel via connection2**
                             
                             Client sends NEGOTIATE request
                             
                             Server sends NEGOTIATE response
                             
                             Client sends SESSION\_SETUP request (SMB2\_SESSION\_FLAG\_BINDING)
                             
                             Server sends SESSION\_SETUP response
                             
                             \
                             
                             **Send CREATE request via main channel**
                             
                             Client sends CREATE request (with no share access so that same CREATE without SMB2\_FLAGS\_REPLAY\_OPERATION flag would fail)
                             
                             Server sends CREATE response
                             
                             \
                             
                             **Disconnect connection1**
                             
                             \
                             
                             **Replay the CREATE request via alternative channel**
                             
                             Client sends same CREATE request (with *SMB2\_FLAGS\_REPLAY\_OPERATION flag in header*)
                             
                             Server sends CREATE response
                             
                             \
                             
                             Client sends CLOSE request
                             
                             Server sends CLOSE response
                             
                             Client sends TREE\_DISCONNECT request
                             
                             Server sends TREE\_DISCONNECT response
                             
                             Client sends LOGOFF request
                             
                             Server sends LOGOFF response

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------

\
\

2.  ### MultipleChannelWithEncryption {.western}

    1.  #### Scenario {.western}

  ------------------------------- ----------------------------------------------------------------------------------------
  **Description**                 Operate file via multi-channel with/without encryption on one channel or both channels

  **Message Sequence**            **Create main channel**
                                  
                                  NEGOTIATE (with/without SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT (IPC\$)
                                  
                                  IOCTL (FSCTL\_QUERY\_NETWORK\_INTERFACE\_INFO)
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (File)
                                  
                                  WRITE
                                  
                                  \
                                  
                                  **Create alterative channel**
                                  
                                  NEGOTIATE (with/without SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                                  
                                  SESSION\_SETUP (SMB2\_SESSION\_FLAG\_BINDING)
                                  
                                  READ
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **NO**
  ------------------------------- ----------------------------------------------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- ------------------------------------------------------------------
  **Test ID**                MultipleChannel\_EncryptionOnBothChannels

  **Description**            Operate file via multi-channel with encryption on both channels.

  **Prerequisites**          \
                             

  **Test Execution Steps**   Create main channel
                             
                             NEGOTIATE (with/without SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT (IPC\$)
                             
                             IOCTL (FSCTL\_QUERY\_NETWORK\_INTERFACE\_INFO)
                             
                             TREE\_CONNECT
                             
                             CREATE (File)
                             
                             WRITE
                             
                             \
                             
                             Create alterative channel
                             
                             NEGOTIATE (with/without SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                             
                             SESSION\_SETUP (SMB2\_SESSION\_FLAG\_BINDING)
                             
                             READ
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------
  **Test ID**                MultipleChannel\_Negative\_EncryptionOnMainChannel

  **Description**            Operate file via multi-channel only with encryption on main channel.

  **Prerequisites**          \
                             

  **Test Execution Steps**   Create main channel
                             
                             NEGOTIATE (with SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT (IPC\$)
                             
                             IOCTL (FSCTL\_QUERY\_NETWORK\_INTERFACE\_INFO)
                             
                             TREE\_CONNECT
                             
                             CREATE (File)
                             
                             WRITE
                             
                             \
                             
                             Create alterative channel
                             
                             NEGOTIATE (without SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                             
                             SESSION\_SETUP (SMB2\_SESSION\_FLAG\_BINDING)
                             
                             READ
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ----------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------
  **Test ID**                MultipleChannel\_Negative\_EncryptionOnAlternativeChannel

  **Description**            Operate file via multi-channel only with encryption on alternative channel

  **Prerequisites**          \
                             

  **Test Execution Steps**   Create main channel
                             
                             NEGOTIATE (without SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT (IPC\$)
                             
                             IOCTL (FSCTL\_QUERY\_NETWORK\_INTERFACE\_INFO)
                             
                             TREE\_CONNECT
                             
                             CREATE (File)
                             
                             WRITE
                             
                             \
                             
                             Create alterative channel
                             
                             NEGOTIATE (with SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                             
                             SESSION\_SETUP (SMB2\_SESSION\_FLAG\_BINDING)
                             
                             READ
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ----------------------------------------------------------------------------

\
\

3.  ### MultipleChannelWithLease {.western}

    1.  #### Scenario {.western}

  ------------------------------- --------------------------------------------------------------------------------------------------
  **Description**                 Operate file via multi-channel with file lease and the lease break is expected from main channel

  **Message Sequence**            **Create main channel via connection1**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT (IPC\$)
                                  
                                  IOCTL (FSCTL\_QUERY\_NETWORK\_INTERFACE\_INFO)
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (File, with SMB2\_CREATE\_REQUEST\_LEASE\_V2 and lease state)
                                  
                                  WRITE
                                  
                                  \
                                  
                                  **Create alterative channel via connection2**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP (SMB2\_SESSION\_FLAG\_BINDING)
                                  
                                  READ
                                  
                                  \
                                  
                                  \
                                  
                                  **From 3**^**rd**^**client to access the same file to trigger lease break**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (with specific create flag)
                                  
                                  \
                                  
                                  **From main channel via connection1**
                                  
                                  Expected to receive LEASE\_BREAK
                                  
                                  Send LEASE\_BREAK\_ACK
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **NO**
  ------------------------------- --------------------------------------------------------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- ---------------------------------------------------------------------------------------------------
  **Test ID**                MultipleChannel\_FileLease

  **Description**            Operate file via multi-channel with file lease and the lease break is expected from main channel.

  **Prerequisites**          \
                             

  **Test Execution Steps**   **Create main channel via connection1**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT (IPC\$)
                             
                             IOCTL (FSCTL\_QUERY\_NETWORK\_INTERFACE\_INFO)
                             
                             TREE\_CONNECT
                             
                             CREATE (File, with SMB2\_CREATE\_REQUEST\_LEASE\_V2 and lease state)
                             
                             WRITE
                             
                             \
                             
                             **Create alterative channel via connection2**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP (SMB2\_SESSION\_FLAG\_BINDING)
                             
                             READ
                             
                             \
                             
                             \
                             
                             **From 3**^**rd**^**client to access the same file to trigger lease break**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (with specific create flag)
                             
                             \
                             
                             **From main channel via connection1**
                             
                             Expected to receive LEASE\_BREAK
                             
                             Send LEASE\_BREAK\_ACK
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ---------------------------------------------------------------------------------------------------

\
\

4.  ### MultipleChannelWithLock {.western}

    1.  #### Scenario {.western}

  ------------------------------- ---------------------------------------------------------------------------------
  **Description**                 Operate file via multi-channel with lock operation on same/different channel

  **Message Sequence**            **Create main channel**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT (IPC\$)
                                  
                                  IOCTL (FSCTL\_QUERY\_NETWORK\_INTERFACE\_INFO)
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (File)
                                  
                                  LOCK (with SMB2\_LOCKFLAG\_SHARED\_LOCK in SMB2\_LOCK\_ELEMENT)
                                  
                                  WRITE
                                  
                                  \
                                  
                                  **Create alterative channel**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP (SMB2\_SESSION\_FLAG\_BINDING)
                                  
                                  READ (the locking range, expect success)
                                  
                                  WRITE (the locking range, expect success)
                                  
                                  \
                                  
                                  **From client3 open the same file and try to read and write the locking range**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (File)
                                  
                                  READ (the locking range, expect success)
                                  
                                  WRITE (the locking range, expect fail)
                                  
                                  \
                                  
                                  **From main/alternative channel to unlock the range**
                                  
                                  LOCK (with SMB2\_LOCKFLAG\_UNLOCK in SMB2\_LOCK\_ELEMENT)\
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF
                                  
                                  \
                                  
                                  **From client3 try to write the range**
                                  
                                  WRITE (the locking range, expect success)
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF
                                  
                                  \
                                  

  **Cluster Involved Scenario**   **NO**
  ------------------------------- ---------------------------------------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- ---------------------------------------------------------------------------------
  **Test ID**                MultipleChannel\_LockUnlockOnSameChannel

  **Description**            Operate file via multi-channel with lock operation on same channel.

  **Prerequisites**          \
                             

  **Test Execution Steps**   **Create main channel**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT (IPC\$)
                             
                             IOCTL (FSCTL\_QUERY\_NETWORK\_INTERFACE\_INFO)
                             
                             TREE\_CONNECT
                             
                             CREATE (File)
                             
                             LOCK (with SMB2\_LOCKFLAG\_SHARED\_LOCK in SMB2\_LOCK\_ELEMENT)
                             
                             WRITE
                             
                             \
                             
                             **Create alterative channel**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP (SMB2\_SESSION\_FLAG\_BINDING)
                             
                             READ (the locking range, expect success)
                             
                             WRITE (the locking range, expect failed)
                             
                             \
                             
                             **From client3 open the same file and try to read and write the locking range**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (File)
                             
                             READ (the locking range, expect success)
                             
                             WRITE (the locking range, expect fail)
                             
                             \
                             
                             **From main channel unlock the range**
                             
                             LOCK (with SMB2\_LOCKFLAG\_UNLOCK in SMB2\_LOCK\_ELEMENT)\
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF
                             
                             \
                             
                             **From client3 try to write the range**
                             
                             WRITE (the locking range, expect success)
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF
                             
                             \
                             

  **Cleanup**                \
                             
  -------------------------- ---------------------------------------------------------------------------------

\
\

  -------------------------- ---------------------------------------------------------------------------------
  **Test ID**                MultipleChannel\_LockUnlockOnDiffChannel

  **Description**            Operate file via multi-channel with lock operation on different channels.

  **Prerequisites**          \
                             

  **Test Execution Steps**   **Create main channel**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT (IPC\$)
                             
                             IOCTL (FSCTL\_QUERY\_NETWORK\_INTERFACE\_INFO)
                             
                             TREE\_CONNECT
                             
                             CREATE (File)
                             
                             LOCK (with SMB2\_LOCKFLAG\_SHARED\_LOCK in SMB2\_LOCK\_ELEMENT)
                             
                             WRITE
                             
                             \
                             
                             **Create alterative channel**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP (SMB2\_SESSION\_FLAG\_BINDING)
                             
                             READ (the locking range, expect success)
                             
                             WRITE (the locking range, expect failed)
                             
                             \
                             
                             **From client3 open the same file and try to read and write the locking range**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (File)
                             
                             READ (the locking range, expect success)
                             
                             WRITE (the locking range, expect fail)
                             
                             \
                             
                             **From alternative channel unlock the range**
                             
                             LOCK (with SMB2\_LOCKFLAG\_UNLOCK in SMB2\_LOCK\_ELEMENT)\
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF
                             
                             \
                             
                             **From client3 try to write the range**
                             
                             WRITE (the locking range, expect success)
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ---------------------------------------------------------------------------------

\
\

5.  ### AppInstanceWithEncryption {.western}

    1.  #### Scenario {.western}

  ------------------------------- --------------------------------------------------------------------------------
  **Description**                 Operate files with/without encryption before client failover or after failover

  **Message Sequence**            ***Based on NIC1, create******c******lient1:***
                                  
                                  NEGOTIATE (with/without SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (With AppInstanceId)
                                  
                                  WRITE
                                  
                                  \
                                  
                                  *Disable NIC1*
                                  
                                  \
                                  
                                  ***Switch to NIC2 and create Client2:***
                                  
                                  NEGOTIATE (with/without SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (With the same AppInstanceId)
                                  
                                  READ
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **NO**
  ------------------------------- --------------------------------------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- -----------------------------------------------------------------------
  **Test ID**                AppInstanceId\_Encryption

  **Description**            Operate files with encrypted message before and after client failover

  **Prerequisites**          \
                             

  **Test Execution Steps**   ***Based on NIC1, create client1:***
                             
                             NEGOTIATE (with SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT (EncryptedShare)
                             
                             Send following messages encrypted
                             
                             CREATE (With AppID, exclusive open)
                             
                             WRITE
                             
                             Disable NIC1
                             
                             \
                             
                             ***Switch to NIC2 and create Client2:***
                             
                             NEGOTIATE (with SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT (EncryptedShare)
                             
                             Send following messages encrypted
                             
                             CREATE (With the same AppID)
                             
                             READ
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------

\
\

  -------------------------- ---------------------------------------------------------------------------------------------------------
  **Test ID**                AppInstanceId\_Negative\_NoEncryptionInInitialOpen\_EncryptionInReOpen

  **Description**            Operate files with encrypted message before client failover but with unencrypted message after failover

  **Prerequisites**          \
                             

  **Test Execution Steps**   ***Based on NIC1, create client1:***
                             
                             NEGOTIATE (with SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT (EncryptedShare)
                             
                             Send following messages encrypted
                             
                             CREATE (With AppID, exclusive open)
                             
                             WRITE
                             
                             Disable NIC1
                             
                             \
                             
                             ***Switch to NIC2 and create Client2:***
                             
                             NEGOTIATE (with SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT (EncryptedShare)
                             
                             Send following messages unencrypted
                             
                             CREATE (With the same AppID)
                             
                             Expect error STATUS\_ACCESS\_DENIED in response
                             
                             \
                             
                             TREE\_DISCONNECT
                             
                             Expect error STATUS\_ACCESS\_DENIED in response
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ---------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------
  **Test ID**                AppInstanceId\_Negative\_EncryptionInInitialOpen\_NoEncryptionInReOpen

  **Description**            Operate files with encrypted message before failover but with unencrypted message after failover

  **Prerequisites**          \
                             

  **Test Execution Steps**   ***Based on NIC1, create client1:***
                             
                             NEGOTIATE (with SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT (EncryptedShare)
                             
                             Send following messages encrypted
                             
                             CREATE (With AppID, exclusive open)
                             
                             Expect error STATUS\_ACCESS\_DENIED in response
                             
                             Disable NIC1
                             
                             \
                             
                             ***Switch to NIC2 and create Client2:***
                             
                             NEGOTIATE (with SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT (EncryptedShare)
                             
                             Send following messages encrypted
                             
                             CREATE (With the same AppID)
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------

\
\

6.  ### AppInstanceWithLease {.western}

    1.  #### Scenario {.western}

  ------------------------------- ------------------------------------------------------------------------------------------------------------------------
  **Description**                 Operate file/directory with lease before client failover and expect no lease state is maintained after client failover

  **Message Sequence**            ***Based on NIC1, create******c******lient1:***
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (File/Directory, with AppInstanceId, SMB2\_CREATE\_REQUEST\_LEASE\_V2 and lease state request)
                                  
                                  WRITE
                                  
                                  \
                                  
                                  *Disable NIC1*
                                  
                                  \
                                  
                                  ***Switch to NIC2 and create******c******lient2:***
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (File/Directory, with the same AppInstanceId with no lease state)
                                  
                                  READ
                                  
                                  \
                                  
                                  **From client3 on NIC2**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (with WRITE)
                                  
                                  Receive the CREATE response (no lease state kept on server after client failover)
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF
                                  
                                  \
                                  
                                  **From client2 no lease break notification received**
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **NO**
  ------------------------------- ------------------------------------------------------------------------------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- --------------------------------------------------------------------------------------------------------------
  **Test ID**                AppInstanceId\_FileLeasing\_NoLeaseInReOpen

  **Description**            Operate file with lease before client failover and expect no lease state is maintained after client failover

  **Prerequisites**          \
                             

  **Test Execution Steps**   ***Based on NIC1, create client1:***
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (File, with AppInstanceId, SMB2\_CREATE\_REQUEST\_LEASE\_V2 and lease state request)
                             
                             WRITE
                             
                             \
                             
                             *Disable NIC1*
                             
                             \
                             
                             ***Switch to NIC2 and create client2:***
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (File, with the same AppInstanceId with no lease state)
                             
                             READ
                             
                             \
                             
                             **From client3 on NIC2**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (with WRITE)
                             
                             Receive the CREATE response (no lease state kept on server after client failover)
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF
                             
                             \
                             
                             **From client2 no lease break notification received**
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------
  **Test ID**                AppInstanceId\_DirectoryLeasing\_NoLeaseInReOpen

  **Description**            Operate file with lease before client failover and expect no lease state is maintained after client failover

  **Prerequisites**          \
                             

  **Test Execution Steps**   ***Based on NIC1, create client1:***
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (Directory, with AppInstanceId, SMB2\_CREATE\_REQUEST\_LEASE\_V2 and lease state request)
                             
                             \
                             
                             *Disable NIC1*
                             
                             \
                             
                             ***Switch to NIC2 and create client2:***
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (Directory, with the same AppInstanceId with no lease state)
                             
                             \
                             
                             **From client3 on NIC2**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (with WRITE)
                             
                             Receive the CREATE response (no lease state kept on server after client failover)
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF
                             
                             \
                             
                             **From client2 no lease break notification received**
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------------------

\
\

7.  ### AppInstanceWithLock {.western}

    1.  #### Scenario {.western}

  ------------------------------- -----------------------------------------------------------------------------------------------
  **Description**                 Operate file with lock during client failover and expect no lock is maintained after failover

  **Message Sequence**            ***Based on NIC1, create******c******lient1:***
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (File, with AppInstanceId)
                                  
                                  WRITE
                                  
                                  LOCK (with SMB2\_LOCKFLAG\_SHARED\_LOCK in SMB2\_LOCK\_ELEMENT)
                                  
                                  \
                                  
                                  *Disable NIC1*
                                  
                                  \
                                  
                                  ***Switch to NIC2 and create******c******lient2:***
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (File, with the same AppInstanceId)
                                  
                                  READ (the locking range, expect success)
                                  
                                  \
                                  
                                  **From client3 on NIC2**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (with WRITE)
                                  
                                  READ (the locking range, expect success)
                                  
                                  WRITE (the locking range, expect success)
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **NO**
  ------------------------------- -----------------------------------------------------------------------------------------------

\
\

1.  #### Test Case {.western}

      -------------------------- -----------------------------------------------------------------------------------------------
      **Test ID**                AppInstanceId\_Lock\_ExpectNoLockInReOpen

      **Description**            Operate file with lock during client failover and expect no lock is maintained after failover

      **Prerequisites**          \
                                 

      **Test Execution Steps**   ***Based on NIC1, create client1:***
                                 
                                 NEGOTIATE
                                 
                                 SESSION\_SETUP
                                 
                                 TREE\_CONNECT
                                 
                                 CREATE (File, with AppInstanceId)
                                 
                                 WRITE
                                 
                                 LOCK (with SMB2\_LOCKFLAG\_SHARED\_LOCK in SMB2\_LOCK\_ELEMENT)
                                 
                                 \
                                 
                                 *Disable NIC1*
                                 
                                 \
                                 
                                 ***Switch to NIC2 and create client2:***
                                 
                                 NEGOTIATE
                                 
                                 SESSION\_SETUP
                                 
                                 TREE\_CONNECT
                                 
                                 CREATE (File, with the same AppInstanceId)
                                 
                                 READ (the locking range, expect success)
                                 
                                 \
                                 
                                 **From client3 on NIC2**
                                 
                                 NEGOTIATE
                                 
                                 SESSION\_SETUP
                                 
                                 TREE\_CONNECT
                                 
                                 CREATE (with WRITE)
                                 
                                 READ (the locking range, expect success)
                                 
                                 WRITE (the locking range, expect success)
                                 
                                 CLOSE
                                 
                                 TREE\_DISCONNECT
                                 
                                 LOGOFF

      **Cleanup**                \
                                 
      -------------------------- -----------------------------------------------------------------------------------------------

### CompoundWithEncryption {.western}

1.  #### Scenario {.western}

      ------------------------------- -------------------------------------------------------------------
      **Description**                 Send encrypted and compounded requests to SUT and verify response

      **Message Sequence**            NEGOTIATE
                                      
                                      SESSION\_SETUP
                                      
                                      TREE\_CONNECT
                                      
                                      Encrypted COMPOUND request
                                      
                                      Verify COMPOUND response
                                      
                                      TREEDISCONNECT
                                      
                                      LOGOFF

      **Cluster Involved Scenario**   **NO**
      ------------------------------- -------------------------------------------------------------------

2.  #### Test Case {.western}

  ---------------------- ------------------------------------------------------------------------------------------------------------------
  **Test ID**            Compound\_Encrypt\_RelatedRequests

  **Description**        Send encrypted and compounded related requests (Create, Write and Close a same file) to SUT and verify response.

  **Message Sequence**   NEGOTIATE
                         
                         SESSION\_SETUP
                         
                         TREE\_CONNECT
                         
                         Encrypted COMPOUND related request (CREATE, WRITE, and CLOSE to a same file)
                         
                         Verify COMPOUND response
                         
                         TREEDISCONNECT
                         
                         LOGOFF
  ---------------------- ------------------------------------------------------------------------------------------------------------------

\
\

  ---------------------- -----------------------------------------------------------------------------------------------------------------------
  **Test ID**            Compound\_Encrypt\_UnrelatedRequests

  **Description**        Send encrypted and compounded unrelated requests (two Creates request to different files) to SUT and verify response.

  **Message Sequence**   NEGOTIATE
                         
                         SESSION\_SETUP
                         
                         TREE\_CONNECT
                         
                         Encrypted COMPOUND unrelated request (two Create requests to two different files)
                         
                         Verify COMPOUND response
                         
                         TREEDISCONNECT
                         
                         LOGOFF
  ---------------------- -----------------------------------------------------------------------------------------------------------------------

\
\

\
\

4.  Server Failover Test {.western}
    --------------------

  ----------------------------------------- ---------------- ------------------------------- ---------------------------------
  **Scenario**                              **Test Cases**   **SMB 3.0 New Feature**         **Hyper-V Scenario Importance**
  **SWNGetInterfaceList**                   2                **Yes**                         Optional
  **SWNRegistration**                       9                **Yes**                         Optional
  **SWNAsyncNotification**                  8                **Yes**                         **Critical**
  **AsmmetricShare**                        4                **No (SMB 3.02 new feature)**   **Critical**
  **FileServerFailover**                    5                **Yes**                         **Critical**
  **FileServerFailover\_Encryption**        3                **Yes**                         Optional
  **FileServerFailover\_Lease**             2                **Yes**                         **Critical**
  **FileServerFailover\_Lock**              1                **Yes**                         **Critical**
  **FileServerFailover\_DurableHandleV2**   1                **Yes**                         **Critical**
  ----------------------------------------- ---------------- ------------------------------- ---------------------------------

\
\

1.  ### SWNGetInterfaceList {.western}

    1.  #### Scenario {.western}

  ------------------------------- --------------------------
  **Description**                 Get SWN interface list.
  **Call Sequence**               WitnessrGetInterfaceList
  **Cluster Involved Scenario**   **YES**
  ------------------------------- --------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- ----------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_SWNGetInterfaceList\_ClusterSingleNode

  **Description**            Ensure that the cluster does not response the interface list correctly until there is an available node.

  **Prerequisites**          Only Node1 provides the service. Node2 is disabled.

  **Test Execution Steps**   1.  Bind to cluster server
                             
                             2.  Invoke WitnessrGetInterfaceList
                             
                             3.  Client expects timeout
                             
                             4.  Enable Node2
                             
                             5.  Invoke WitnessrGetInterfaceList
                             
                             6.  Client expects Status = **ERROR\_SUCCESS**, InterfaceList contains interface with
                             
                             -   InterfaceGroupName = **Node2**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             -   InterfaceGroupName = **Node1**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             7.  Unbind
                             
                             

  **Cleanup**                DeleteShareMapping
  -------------------------- ----------------------------------------------------------------------------------------------------------

\

  -------------------------- ----------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_SWNGetInterfaceList\_ScaleOutSingleNode

  **Description**            Ensure that single node does not response the interface list correctly until there is an available node.

  **Prerequisites**          Only Node1 provides the service. Node2 is disabled.

  **Test Execution Steps**   1.  Bind to Node1
                             
                             2.  Invoke WitnessrGetInterfaceList
                             
                             3.  Client expects timeout
                             
                             4.  Enable Node2
                             
                             5.  Invoke WitnessrGetInterfaceList
                             
                             6.  Client expects Status = **ERROR\_SUCCESS**, InterfaceList contains interface with
                             
                             -   InterfaceGroupName = **Node2**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             -   InterfaceGroupName = **Node1**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             7.  Unbind
                             
                             

  **Cleanup**                \
                             
  -------------------------- ----------------------------------------------------------------------------------------------------------

\
\

2.  ### SWNRegistration {.western}

    1.  #### Scenario {.western}

  ------------------------------- -------------------------------------
  **Description**                 Register and unregister the client.

  **Call Sequence**               WitnessrRegister
                                  
                                  WitnessUnRegister

  **Cluster Involved Scenario**   **YES**
  ------------------------------- -------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- -----------------------------------------------------------------------------------
  **Test ID**                SWNRegistration\_InvalidNetName

  **Description**            Register with WitnessrRegister and invalid netname.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  GetClusterResourceOwner
                             
                             2.  Bind to cluster server
                             
                             3.  Invoke WitnessrGetInterfaceList
                             
                             4.  Client expects Status = ERROR\_SUCCESS, InterfaceList contains interface with
                             
                             -   InterfaceGroupName != **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             -   InterfaceGroupName = **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             5.  Unbind
                             
                             6.  Bind to **valid node**
                             
                             7.  Invoke WitnessrRegister with **invalid NetName**
                             
                             8.  Client expect Status = **ERROR\_INVALID\_PARAMETER**, Context is **EMPTY**.
                             
                             9.  Unbind
                             
                             

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------------------

\

  -------------------------- -----------------------------------------------------------------------------------
  **Test ID**                SWNRegistration\_InvalidVersion

  **Description**            Register with WitnessrRegister and invalid version.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  GetClusterResourceOwner
                             
                             2.  Bind to cluster server
                             
                             3.  Invoke WitnessrGetInterfaceList
                             
                             4.  Client expects Status = ERROR\_SUCCESS, InterfaceList contains interface with
                             
                             -   InterfaceGroupName != **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             -   InterfaceGroupName = **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             5.  Unbind
                             
                             6.  Bind to **valid node**
                             
                             7.  Invoke WitnessrRegister with **invalid Version**
                             
                             8.  Client expect Status = **ERROR\_INVALID\_PARAMETER**, Context is **EMPTY**.
                             
                             9.  Unbind
                             
                             

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------------------

\
\

\
\

  -------------------------- ------------------------------------------------------------------------------------
  **Test ID**                SWNRegistration\_InvalidIpAddress

  **Description**            Register with WitnessrRegister and invalid IpAddress.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  GetClusterResourceOwner
                             
                             2.  Bind to cluster server
                             
                             3.  Invoke WitnessrGetInterfaceList
                             
                             4.  Client expects  Status = ERROR\_SUCCESS, InterfaceList contains interface with
                             
                             -   InterfaceGroupName != **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             -   InterfaceGroupName = **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             5.  Unbind
                             
                             6.  Bind to **valid node**
                             
                             7.  Invoke WitnessrRegister with **invalid IpAddress**
                             
                             8.  Client expect Status =  **ERROR\_INVALID\_STATE**, Context is **EMPTY**.
                             
                             9.  Unbind
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------

\

\

  -------------------------- -----------------------------------------------------------------------------------
  **Test ID**                SWNRegistration\_InvalidUnRegister

  **Description**            Register with WitnessrRegister and Unregister the client twice.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  GetClusterResourceOwner
                             
                             2.  Bind to cluster server
                             
                             3.  Invoke WitnessrGetInterfaceList
                             
                             4.  Client expects Status = ERROR\_SUCCESS, InterfaceList contains interface with
                             
                             -   InterfaceGroupName != **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             -   InterfaceGroupName = **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             5.  Unbind
                             
                             6.  Bind **valid node**
                             
                             7.  Invoke WitnessrRegister
                             
                             8.  Invoke WitnessrUnRegister twice
                             
                             9.  Client expects Status != **ERROR\_NOT\_FOUND**
                             
                             10. Unbind
                             
                             

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------------------

\

  -------------------------- -----------------------------------------------------------------------------------
  **Test ID**                SWNRegistrationEx\_InvalidNetName

  **Description**            Register with WitnessrRegisterEx and invalid NetName.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  GetClusterResourceOwner
                             
                             2.  Bind to cluster server
                             
                             3.  Invoke WitnessrGetInterfaceList
                             
                             4.  Client expects Status = ERROR\_SUCCESS, InterfaceList contains interface with
                             
                             -   InterfaceGroupName != **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             -   InterfaceGroupName = **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             5.  Unbind
                             
                             6.  Bind to **valid node**
                             
                             7.  Invoke WitnessrRegisterEx with **invalid NetName**
                             
                             8.  Client expect Status = **ERROR\_INVALID\_PARAMETER**, Context is **EMPTY**.
                             
                             9.  Unbind
                             
                             

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------------------

\
\

  -------------------------- -----------------------------------------------------------------------------------
  **Test ID**                SWNRegistrationEx\_InvalidVersion

  **Description**            Register with WitnessrRegisterEx and invalid version.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  GetClusterResourceOwner
                             
                             2.  Bind to cluster server
                             
                             3.  Invoke WitnessrGetInterfaceList
                             
                             4.  Client expects Status = ERROR\_SUCCESS, InterfaceList contains interface with
                             
                             -   InterfaceGroupName != **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             -   InterfaceGroupName = **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             5.  Unbind
                             
                             6.  Bind to **valid node**
                             
                             7.  Invoke WitnessrRegisterEx with **invalid Version**
                             
                             8.  Client expect Status = **ERROR\_INVALID\_PARAMETER**, Context is **EMPTY**.
                             
                             9.  Unbind
                             
                             
  -------------------------- -----------------------------------------------------------------------------------

\

  -------------------------- ------------------------------------------------------------------------------------
  **Test ID**                SWNRegistrationEx\_InvalidIpAddress

  **Description**            Register with WitnessrRegisterEx and invalid IpAddress.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  GetClusterResourceOwner
                             
                             2.  Bind to cluster server
                             
                             3.  Invoke WitnessrGetInterfaceList
                             
                             4.  Client expects  Status = ERROR\_SUCCESS, InterfaceList contains interface with
                             
                             -   InterfaceGroupName != **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             -   InterfaceGroupName = **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             5.  Unbind
                             
                             6.  Bind to **valid node**
                             
                             7.  Invoke WitnessrRegisterEx with **invalid IpAddress**
                             
                             8.  Client expect Status =  **ERROR\_INVALID\_STATE**, Context is **EMPTY**.
                             
                             9.  Unbind
                             
                             

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------

\
\

  -------------------------- -----------------------------------------------------------------------------------
  **Test ID**                SWNRegistrationEx\_InvalidUnRegister

  **Description**            Register with WitnessrRegisterEx and Unregister the client twice.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  GetClusterResourceOwner
                             
                             2.  Bind to cluster server
                             
                             3.  Invoke WitnessrGetInterfaceList
                             
                             4.  Client expects Status = ERROR\_SUCCESS, InterfaceList contains interface with
                             
                             -   InterfaceGroupName != **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             -   InterfaceGroupName = **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             5.  Unbind
                             
                             6.  Bind **valid node**
                             
                             7.  Invoke WitnessrRegisterEx
                             
                             8.  Invoke WitnessrUnRegister twice
                             
                             9.  Client expects Status != **ERROR\_NOT\_FOUND**
                             
                             10. Unbind
                             
                             

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------------------

\
\

  -------------------------- -----------------------------------------------------------------------------------
  **Test ID**                SWNRegistrationEx\_InvalidShareName

  **Description**            Register with invalid sharename.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  GetClusterResourceOwner
                             
                             2.  Bind to cluster server
                             
                             3.  Invoke WitnessrGetInterfaceList
                             
                             4.  Client expects Status = ERROR\_SUCCESS, InterfaceList contains interface with
                             
                             -   InterfaceGroupName != **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             -   InterfaceGroupName = **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             5.  Unbind
                             
                             6.  Bind **valid node**
                             
                             7.  Invoke WitnessrRegisterEx with invalid **ShareName**
                             
                             8.  Invoke WitnessrUnRegister twice
                             
                             9.  Client expects Status != **ERROR\_INVALID\_STATE**
                             
                             10. Unbind
                             
                             

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------------------

\
\

3.  ### SWNAsyncNotification {.western}

    1.  #### Scenario {.western}

  ------------------------------- ------------------------------------
  **Description**                 Get the asynchronous notification.

  **Call Sequence**               WitnessrRegister
                                  
                                  WitnessrAsyncNotify
                                  
                                  WitnessUnRegister

  **Cluster Involved Scenario**   **YES**
  ------------------------------- ------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- -------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_WitnessrRegister\_SWNAsyncNotification\_ClientMove

  **Description**            Register with WitnessrRegister and Get CLIENT\_MOVE\_NOTIFICATION on scaleout cluster server.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Get the address(Node01) of ScaleOutFs
                             
                             2.  Bind to Node01
                             
                             3.  Invoke WitnessrGetInterfaceList
                             
                             4.  Client expects Status = ERROR\_SUCCESS, InterfaceList contains interface with
                             
                             -   InterfaceGroupName = **Node02**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             -   InterfaceGroupName = **Node01**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             5.  Unbind
                             
                             6.  Bind to **NODE02**
                             
                             7.  Invoke **WitnessrRegister**
                             
                             8.  Client expect Status = **ERROR\_SUCCESS**, Context is not **EMPTY**.
                             
                             9.  Invoke WitnessrAsyncNotify with **valid context**
                             
                             10. Create a file on ScaleOutFs (Node01) and write buffer through SMB2.
                             
                             11. Call Move-SmbWitnessClient –ClientName X –DestinationName NODE02 on NODE01.
                             
                             12. Client expects Status = **ERROR\_SUCCESS**, **RESP\_ASYNC\_NOTIFY with MessageType( CLIENT\_MOVE\_NOTIFICATION 2)**
                             
                             13. Invoke WitnessrUnRegister with **valid context**
                             
                             14. Client expects Status = **ERROR\_SUCCESS**
                             
                             15. Unbind
                             
                             16. Read buffer and close the file on ScaleOutFs (Node02) through SMB2.
                             
                             

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------------------

\

\

  -------------------------- -------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_WitnessrRegisterEx\_SWNAsyncNotification\_ClientMove

  **Description**            Register with WitnessrRegisterEx and Get CLIENT\_MOVE\_NOTIFICATION on scaleout cluster server.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Get the address (Node01) of ScaleOutFs
                             
                             2.  Bind to Node01
                             
                             3.  Invoke WitnessrGetInterfaceList
                             
                             4.  Client expects Status = ERROR\_SUCCESS, InterfaceList contains interface with
                             
                             -   InterfaceGroupName = **Node02**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             -   InterfaceGroupName = **Node01**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             5.  Unbind
                             
                             6.  Bind to **NODE02**
                             
                             7.  Invoke **WitnessrRegisterEx**
                             
                             8.  Client expect Status = **ERROR\_SUCCESS**, Context is not **EMPTY**.
                             
                             9.  Invoke WitnessrAsyncNotify with **valid context**
                             
                             10. Create a file on ScaleOutFs (Node01) and write buffer through SMB2.
                             
                             11. Call Move-SmbWitnessClient –ClientName X –DestinationName NODE02 on NODE01.
                             
                             12. Client expects Status = **ERROR\_SUCCESS**, **RESP\_ASYNC\_NOTIFY with MessageType( CLIENT\_MOVE\_NOTIFICATION 2)**
                             
                             13. Invoke WitnessrUnRegister with **valid context**
                             
                             14. Client expects Status = **ERROR\_SUCCESS**
                             
                             15. Unbind
                             
                             16. Read buffer and close the file on ScaleOutFs (Node02) through SMB2.
                             
                             

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------------------

\

\

  -------------------------- -----------------------------------------------------------------------------------
  **Test ID**                SWNAsyncNotification\_InvalidRequest

  **Description**            Assure that server responses correctly with invalid context.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  GetClusterResourceOwner
                             
                             2.  Bind to cluster server(GeneralFS)
                             
                             3.  Invoke WitnessrGetInterfaceList
                             
                             4.  Client expects Status = ERROR\_SUCCESS, InterfaceList contains interface with
                             
                             -   InterfaceGroupName != **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             -   InterfaceGroupName = **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             5.  Unbind
                             
                             6.  Bind to **valid node**
                             
                             7.  Invoke WitnessrAsyncNotify with **invalid context**
                             
                             8.  Client expects Status = **ERROR\_NOT\_FOUND**
                             
                             9.  Unbind
                             
                             

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------------------

\

  -------------------------- -----------------------------------------------------------------------------------
  **Test ID**                WitnessrRegisterEx\_SWNAsyncNotification\_Timeout

  **Description**            Get Timeout notification on scaleout cluster server.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Get the address(Node01) of ScaleOutFs
                             
                             2.  Bind to Node01
                             
                             3.  Invoke WitnessrGetInterfaceList
                             
                             4.  Client expects Status = ERROR\_SUCCESS, InterfaceList contains interface with
                             
                             -   InterfaceGroupName = **Node02**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             -   InterfaceGroupName = **Node01**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             5.  Unbind
                             
                             6.  Bind to **NODE02**
                             
                             7.  Invoke WitnessrRegisterEx with KeepAliveTimout(10s)
                             
                             8.  Client expect Status = **ERROR\_SUCCESS**, Context is not **EMPTY**.
                             
                             9.  Invoke WitnessrAsyncNotify with **valid context**
                             
                             10. Client expects Status = **ERROR\_TIMEOUT**
                             
                             11. Invoke WitnessrUnRegister with **valid context**
                             
                             12. Client expects Status = **ERROR\_SUCCESS**
                             
                             13. Unbind
                             
                             

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------------------

\

  -------------------------- --------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_WitnessrRegisterEx\_SWNAsyncNotification\_ShareMove

  **Description**            Get SHARE\_MOVE\_NOTIFICATION on scaleout cluster server.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Get the address(Node01) of ScaleOutFs
                             
                             2.  Bind to Node01
                             
                             3.  Invoke WitnessrGetInterfaceList
                             
                             4.  Client expects Status = ERROR\_SUCCESS, InterfaceList contains interface with
                             
                                 1.  InterfaceGroupName = **Node02**
                             
                                 2.  State = **AVAILABLE**
                             
                                 3.  Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             1.  InterfaceGroupName = **Node01**
                             
                             2.  State = **AVAILABLE**
                             
                             3.  Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             Unbind
                             
                             Bind to **NODE02**
                             
                             Invoke WitnessrRegisterEx with **ShareName(**“**SMBClustered”)**
                             
                             Client expect Status = **ERROR\_SUCCESS**, Context is not **EMPTY**.
                             
                             Invoke WitnessrAsyncNotify with **valid context**
                             
                             Call Move-ClusterSharedVolume -Name “SMBScaleOutDisk” on scaleout cluster.
                             
                             Client expects Status = **ERROR\_SUCCESS**, **RESP\_ASYNC\_NOTIFY with MessageType( SHARE\_MOVE\_NOTIFICATION 3)**
                             
                             Invoke WitnessrUnRegister with **valid context**
                             
                             Client expects Status = **ERROR\_SUCCESS**
                             
                             Unbind

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------------------------

\

  -------------------------- -------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_WitnessrRegisterEx\_SWNAsyncNotification\_IPChange

  **Description**            Get IP\_CHANGE\_NOTIFICATION on scaleout cluster server.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Get the address(Node01) of ScaleOutFs
                             
                             2.  Bind to Node01
                             
                             3.  Invoke WitnessrGetInterfaceList
                             
                             4.  Client expects Status = ERROR\_SUCCESS, InterfaceList contains interface with
                             
                                 1.  InterfaceGroupName = **Node02**
                             
                                 2.  State = **AVAILABLE**
                             
                                 3.  Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             1.  InterfaceGroupName = **Node01**
                             
                             2.  State = **AVAILABLE**
                             
                             3.  Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             Unbind
                             
                             Bind to **NODE02**
                             
                             Invoke WitnessrRegisterEx with **Flags**(**WITNESS\_REGISTER\_IP\_NOTIFICATION 0x00000001)**
                             
                             Client expect Status = **ERROR\_SUCCESS**, Context is not **EMPTY**.
                             
                             Invoke WitnessrAsyncNotify with **valid context**and****
                             
                             Disable and enable network adapter for Node01.
                             
                             Client expects Status = **ERROR\_SUCCESS**, **RESP\_ASYNC\_NOTIFY with MessageType( IP\_CHANGE\_NOTIFICATION 4)**
                             
                             Invoke WitnessrUnRegister with **valid context**
                             
                             Client expects Status = **ERROR\_SUCCESS**
                             
                             Unbind

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------------

\

1.  ### AsmmetricShare {.western style="page-break-before: always"}

In dialect 3.02, a new flag SMB2\_SHARE\_CAP\_ASYMMETRIC 0x00000080 is
introduced in TREE\_CONNECT.Response.Capabilities. This flag indicates
the share is an asymmetric share and the client needs to register SWN
witness notification to the server. If the server finds that the client
didn’t connect the optimum node, the owner node of the asymmetric share,
the server will send an IP\_CHANGE\_NOTIFICATION to the client, and the
client should reconnect to the optimum node.

3.  #### Scenario {.western}

      ------------------------------- -------------------------------------------------------------------
      \                               Test the server behavior when client connect to asymmetric share.
                                      
      **Description**                 

      **Call Sequence**               Connect to asymmetric share
                                      
                                      Register SWN witness notification to the server

      **Cluster Involved Scenario**   **YES**
      ------------------------------- -------------------------------------------------------------------

4.  #### Test Case {.western}

Scenario see [section 3.1.25.1](#_Scenario_4)

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                AsymmetricShare\_OnNonOptimumNode

  **Description**            This test case is designed to test asymmetric share when the client connects to the asymmetric share on the non-optimum node.

  **Prerequisites**          \
                             

  **Test Execution Steps**   NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE
                             
                             WRITE
                             
                             READ
                             
                             WitnessrGetInterfaceList
                             
                             WitnessrRegisterEx
                             
                             WitnessrAsyncNotify
                             
                             WitnessrUnRegister
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE
                             
                             WRITE
                             
                             READ
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ---------------------------------------------------------------------------------------------------------------------------
  **Test ID**                AsymmetricShare\_OnOptimumNode

  **Description**            This test case is designed to test asymmetric share when the client connects to the asymmetric share on the optimum node.

  **Prerequisites**          \
                             

  **Test Execution Steps**   NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE
                             
                             WRITE
                             
                             READ
                             
                             WitnessrGetInterfaceList
                             
                             WitnessrRegisterEx
                             
                             WitnessrAsyncNotify
                             
                             WitnessrUnRegister
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE
                             
                             WRITE
                             
                             READ
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ---------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ---------------------------------------------------------------------------------------------------------
  **Test ID**                AsymmetricShare\_OnNonScaleOutShare

  **Description**            This test case is designed to test asymmetric share when the client connects to the non scaleout share.

  **Prerequisites**          \
                             

  **Test Execution Steps**   NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE
                             
                             WRITE
                             
                             READ
                             
                             WitnessrGetInterfaceList
                             
                             WitnessrRegisterEx
                             
                             WitnessrAsyncNotify
                             
                             WitnessrUnRegister
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE
                             
                             WRITE
                             
                             READ
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ---------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------
  **Test ID**                AsymmetricShare\_OnSmb30

  **Description**            This test case is designed to test asymmetric share when the client connects to the non-optimum node with Smb30 dialect.

  **Prerequisites**          \
                             

  **Test Execution Steps**   NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE
                             
                             WRITE
                             
                             READ
                             
                             WitnessrGetInterfaceList
                             
                             WitnessrRegisterEx
                             
                             WitnessrAsyncNotify
                             
                             WitnessrUnRegister
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE
                             
                             WRITE
                             
                             READ
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------------------------------

\
\

4.  ### FileServerFailover {.western}

    1.  #### Scenario {.western}

  ------------------------------- -----------------------------------------------------------------
  **Description**                 File sharing cluster failover

  **Message Sequence**            NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (with durable handle request)
                                  
                                  WRITE
                                  
                                  \
                                  
                                  *Disable current node of the Cluster which owns the connection*
                                  
                                  \
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (With durable handle reconnect)
                                  
                                  READ
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   YES
  ------------------------------- -----------------------------------------------------------------

\

2.  #### Test Case {.western}

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                FileServerFailover\_FileServer

  **Description**            This test case is designed to test whether server can handle failover to another node of continuous available file servers.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Start a client by sending the following requests: NEGOTIATE; SESSION\_SETUP; TREE\_CONNECT to GeneralFileServer.
                             
                             2.  Client sends CREATE request with SMB2\_CREATE\_DURABLE\_HANDLE\_REQUEST\_V2 with PERSISTENT flag set.
                             
                             3.  Client sends WRITE request to write content to the file.
                             
                             4.  Client sends FLUSH request.
                             
                             5.  Disable owner node for general file server or the node currently provides the access for scale-out file server.
                             
                             6.  Wait for available server.
                             
                             7.  Client sends NEGOTIATE request with the same clientguid of previous client.
                             
                             8.  Client sends SESSION\_SETUP request with the same SESSION\_ID of previous client.
                             
                             9.  Client retries TREE\_CONNECT until succeed or timeout because network path may not be available immediately.
                             
                             10. Client retries to send CREATE request with SMB2\_CREATE\_DURABLE\_HANDLE\_RECONNECT\_V2 context with PERSISTENT flag set until succeed or timeout.
                             
                             11. Client sends READ request to read content.
                             
                             12. Tear down the client by sending the following requests: CLOSE; TREE\_DISCONNECT; LOG\_OFF
                             
                             

  **Cleanup**                Enable Node1
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------

\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                FileServerFailover\_ScaleOutFileServer

  **Description**            This test case is designed to test whether server can handle failover to another node of continuous available scale out file servers.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Start a client by sending the following requests: NEGOTIATE; SESSION\_SETUP; TREE\_CONNECT to ScaleOutFileServer.
                             
                             2.  Client sends CREATE request with SMB2\_CREATE\_DURABLE\_HANDLE\_REQUEST\_V2 with PERSISTENT flag set.
                             
                             3.  Client sends WRITE request to write content to the file.
                             
                             4.  Client sends FLUSH request.
                             
                             5.  Disable owner node for general file server or the node currently provides the access for scale-out file server.
                             
                             6.  Wait for available server.
                             
                             7.  Client sends NEGOTIATE request with the same clientguid of previous client.
                             
                             8.  Client sends SESSION\_SETUP request with the same SESSION\_ID of previous client.
                             
                             9.  Client retries TREE\_CONNECT until succeed or timeout because network path may not be available immediately.
                             
                             10. Client retries to send CREATE request with SMB2\_CREATE\_DURABLE\_HANDLE\_RECONNECT\_V2 context with PERSISTENT flag set until succeed or timeout.
                             
                             11. Client sends READ request to read content.
                             
                             12. Tear down the client by sending the following requests: CLOSE; TREE\_DISCONNECT; LOG\_OFF
                             
                             

  **Cleanup**                Enable Node1
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------

\

  -------------------------- --------------------------------------------------------------------------------------------------
  **Test ID**                FileServerFailover\_ScaleOutFileServer\_ReconnectWithoutFailover

  **Description**            Ensure persistent handle could be re-connected via connection with another node without failover

  **Prerequisites**          \
                             

  **Test Execution Steps**   **Establish connection to node01**
                             
                             Client sends NEGOTIATE request
                             
                             Server sends NEGOTIATE response
                             
                             Client sends SESSION\_SETUP request
                             
                             Server sends SESSION\_SETUP response
                             
                             According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             Client sends TREE\_CONNECT request
                             
                             Server sends TREE\_CONNECT response
                             
                             Client sends CREATE request with CREATE\_DURABLE\_HANDLE\_REQUEST\_V2 create context
                             
                             Server sends CREATE response
                             
                             Client sends WRITE request
                             
                             Server sends WRITE response
                             
                             \
                             
                             **Establish connection to node02**
                             
                             Repeat step 1 to 7
                             
                             Client sends CREATE request with  SMB2\_CREATE\_DURABLE\_HANDLE\_RECONNECT\_V2
                             
                             Server sends CREATE response
                             
                             Client sends READ request
                             
                             Server sends READ response
                             
                             Client sends CLOSE request
                             
                             Server sends CLOSE response
                             
                             Client sends TREE\_DISCONNECT request
                             
                             Server sends TREE\_DISCONNECT response
                             
                             Client sends LOGOFF request
                             
                             Server sends LOGOFF response

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------

\
\

  -------------------------- -----------------------------------------------------------------------------------
  **Test ID**                SWNFileServerFailover\_FileServer

  **Description**            Get WitnessrAsyncNotify notification on cluster server.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  GetClusterResourceOwner
                             
                             2.  Bind to cluster server(GeneralFS)
                             
                             3.  Invoke WitnessrGetInterfaceList
                             
                             4.  Client expects Status = ERROR\_SUCCESS, InterfaceList contains interface with
                             
                             -   InterfaceGroupName != **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             -   InterfaceGroupName = **ClusterResourceOwner**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             5.  Unbind
                             
                             6.  Bind to **valid node**
                             
                             7.  Invoke WitnessrRegister
                             
                             8.  Client expect Status = **ERROR\_SUCCESS**, Context is not **EMPTY**.
                             
                             9.  Invoke WitnessrAsyncNotify with **valid context**
                             
                             10. Create a file on cluster (GeneralFS) and write buffer through SMB2.
                             
                             11. Disable **ClusSvc** on **ClusterResourceOwner**
                             
                             12. Client expects Status = **ERROR\_SUCCESS**, **R****ESOURCE\_CHANGE**
                             
                             -   ChangeType = **0xFFFFFFFF**
                             
                             -   ResourceName = **ClusterResourceOwner**
                             
                             13. Invoke WitnessrAsyncNotify with **valid context**
                             
                             14. Client expects Status = **ERROR\_SUCCESS**, **R****ESOURCE\_CHANGE**
                             
                             -   ChangeType = **0x00000001**
                             
                             -   ResourceName = **NewNode**
                             
                             15. Invoke WitnessrUnRegister with **valid context**
                             
                             16. Client expects Status = **ERROR\_SUCCESS**
                             
                             17. Unbind
                             
                             18. Read buffer and close the file on cluster (GeneralFS) through SMB2.
                             
                             

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------------------

\

  -------------------------- -----------------------------------------------------------------------------------
  **Test ID**                SWNFileServerFailover\_ScaleOutFileServer

  **Description**            Get WitnessrAsyncNotify notification on scaleout cluster server.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Get the address(Node01) of ScaleOutFs
                             
                             2.  Bind to Node01
                             
                             3.  Invoke WitnessrGetInterfaceList
                             
                             4.  Client expects Status = ERROR\_SUCCESS, InterfaceList contains interface with
                             
                             -   InterfaceGroupName = **Node02**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == true**
                             
                             and contains interface with
                             
                             -   InterfaceGroupName = **Node01**
                             
                             -   State = **AVAILABLE**
                             
                             -   Flags & **INTERFACE\_WITNESS(0x00000004) == false**
                             
                             5.  Unbind
                             
                             6.  Bind to **NODE02**
                             
                             7.  Invoke WitnessrRegister
                             
                             8.  Client expect Status = **ERROR\_SUCCESS**, Context is not **EMPTY**.
                             
                             9.  Invoke WitnessrAsyncNotify with **valid context**
                             
                             10. Create a file on ScaleOutFs (Node01) and write buffer through SMB2.
                             
                             11. Disable **ClusSvc** on **ClusterResourceOwner**
                             
                             12. Client expects Status = **ERROR\_SUCCESS**, **R****ESOURCE\_CHANGE**
                             
                             -   ChangeType = **0xFFFFFFFF**
                             
                             -   ResourceName = **Node01**
                             
                             13. Invoke WitnessrAsyncNotify with **valid context**
                             
                             14. Client expects Status = **ERROR\_SUCCESS**, **R****ESOURCE\_CHANGE**
                             
                             -   ChangeType = **0x00000001**
                             
                             -   ResourceName = **Node02**
                             
                             15. Invoke WitnessrUnRegister with **valid context**
                             
                             16. Client expects Status = **ERROR\_SUCCESS**
                             
                             17. Unbind
                             
                             18. Read buffer and close the file on ScaleOutFs (Node02) through SMB2.
                             
                             

  **Cleanup**                \
                             
  -------------------------- -----------------------------------------------------------------------------------

\
\

5.  ### FileServerFailover\_Encryption {.western}

    1.  #### Scenario {.western}

  ------------------------------- ---------------------------------------------------------------------------------------
  **Description**                 Operate files with/without encryption before/after server failover and after failover

  **Message Sequence**            **From client1**
                                  
                                  NEGOTIATE (with/without SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (with durable handle request)
                                  
                                  WRITE
                                  
                                  \
                                  
                                  *Disable current node of the Cluster which owns the connection*
                                  
                                  \
                                  
                                  **From client2**
                                  
                                  NEGOTIATE (with/without SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (With durable handle reconnect)
                                  
                                  READ
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **YES**
  ------------------------------- ---------------------------------------------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- -------------------------------------------------------------------------
  **Test ID**                FileServerFailover\_Encryption

  **Description**            Operate files with encryption before server failover and after failover

  **Prerequisites**          \
                             

  **Test Execution Steps**   **From client1**
                             
                             NEGOTIATE (with SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (with durable handle request)
                             
                             WRITE
                             
                             \
                             
                             *Disable current node of the Cluster which owns the connection*
                             
                             \
                             
                             **From client2**
                             
                             NEGOTIATE (with SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (With durable handle reconnect)
                             
                             READ
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------
  **Test ID**                FileServerFailover\_Negative\_EncryptionBeforeFailover\_NoEncryptionAfterFailover

  **Description**            Operate files with encryption before server failover but without encryption after failover

  **Prerequisites**          \
                             

  **Test Execution Steps**   **From client1**
                             
                             NEGOTIATE (with SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (with durable handle request)
                             
                             WRITE
                             
                             \
                             
                             *Disable current node of the Cluster which owns the connection*
                             
                             \
                             
                             **From client2**
                             
                             NEGOTIATE (without SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (With durable handle reconnect)
                             
                             Expect error STATUS\_ACCESS\_DENIED
                             
                             in response
                             
                             TREE\_DISCONNECT
                             
                             Expect error STATUS\_ACCESS\_DENIED
                             
                             in response
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------

\
\

  -------------------------- -------------------------------------------------------------------------------------
  **Test ID**                FileServerFailover\_Negative\_NoEncryptionBeforeFailover\_EncrytpionAfterFailover

  **Description**            Operate files without encryption before failover but with encryption after failover

  **Prerequisites**          \
                             

  **Test Execution Steps**   **From client1**
                             
                             NEGOTIATE (without SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (with durable handle request)
                             
                             Expect error STATUS\_ACCESS\_DENIED in response
                             
                             \
                             
                             *Disable current node of the Cluster which owns the connection*
                             
                             \
                             
                             **From client2**
                             
                             NEGOTIATE (with SMB2\_GLOBAL\_CAP\_ENCRYPTION)
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (With durable handle reconnect)
                             
                             Expect error STATUS\_OBJECT\_NAME\_NOT\_FOUND
                             
                             in response
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- -------------------------------------------------------------------------------------

\
\

6.  ### FileServerFailover\_Lease {.western}

    1.  #### Scenario {.western}

  ------------------------------- -----------------------------------------------------------------------------------------------------------------
  **Description**                 Operate file/directory with lease and durable handle before server failover and expect lease break notification

  **Message Sequence**            **From client1**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (File, with durable handle and SMB2\_CREATE\_REQUEST\_LEASE\_V2 and lease state)
                                  
                                  \
                                  
                                  *Disable current node of the Cluster which owns the connection*
                                  
                                  \
                                  
                                  **From client2**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (File, durable handle request with same lease state)
                                  
                                  \
                                  
                                  **From client3 to access same file to trigger leasing break**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (with WRITE)
                                  
                                  \
                                  
                                  **From client2**
                                  
                                  Receive LEASE\_BREAK
                                  
                                  Send LEASE\_BREAK\_ACK
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF
                                  
                                  \
                                  
                                  From client3
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF
                                  
                                  \
                                  

  **Cluster Involved Scenario**   **YES**
  ------------------------------- -----------------------------------------------------------------------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                FileServerFailover\_DirectoryLeasing

  **Description**            Operate directory with lease and durable handle before server failover and expect lease break notification

  **Prerequisites**          \
                             

  **Test Execution Steps**   **From client1**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (directory, with durable handle and SMB2\_CREATE\_REQUEST\_LEASE\_V2 and lease state SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING)
                             
                             \
                             
                             \
                             
                             *Disable current node of the Cluster which owns the connection*
                             
                             \
                             
                             **From client2**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (directory, durable handle request with same lease state SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING)
                             
                             \
                             
                             **From client3 to access same file to trigger leasing break**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (with DELETE)
                             
                             \
                             
                             **From client2**
                             
                             Receive LEASE\_BREAK
                             
                             Send LEASE\_BREAK\_ACK
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF
                             
                             \
                             
                             From client3
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF
                             
                             \
                             

  **Cleanup**                \
                             
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                FileServerFailover\_FileLeasing

  **Description**            Operate file with lease and durable handle before server failover and expect lease break notification

  **Prerequisites**          \
                             

  **Test Execution Steps**   **From client1**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (File, with durable handle and SMB2\_CREATE\_REQUEST\_LEASE\_V2 and lease state SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING | SMB2\_LEASE\_WRITE\_CACHING )
                             
                             \
                             
                             *Disable current node of the Cluster which owns the connection*
                             
                             \
                             
                             **From client2**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (File, durable handle request with same lease state SMB2\_LEASE\_READ\_CACHING | SMB2\_LEASE\_HANDLE\_CACHING | SMB2\_LEASE\_WRITE\_CACHING)
                             
                             \
                             
                             **From client3 to access same file to trigger leasing break**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (with WRITE)
                             
                             \
                             
                             **From client2**
                             
                             Receive LEASE\_BREAK
                             
                             Send LEASE\_BREAK\_ACK
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF
                             
                             \
                             
                             From client3
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

7.  ### FileServerFailover\_Lock {.western}

    1.  #### Scenario {.western}

  ------------------------------- ------------------------------------------------------------------------------------------
  **Test case**                   FileServer\_Filover\_Lock

  **Description**                 Operate files with lock during failover and expect the lock is maintained after failover

  **Message Sequence**            **From client1****open a file and lock a specific range**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (File, with durable handle request)
                                  
                                  WRITE
                                  
                                  LOCK (with SMB2\_LOCKFLAG\_SHARED\_LOCK in SMB2\_LOCK\_ELEMENT)
                                  
                                  \
                                  
                                  \
                                  
                                  *Disable current node of the Cluster which owns the connection*
                                  
                                  \
                                  
                                  **From client2**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (with durable handle reconnect)
                                  
                                  READ (the locking range, expect success)
                                  
                                  WRITE (the locking range, expect success)
                                  
                                  \
                                  
                                  **From client3 open the same file and try to read and write the locking range**
                                  
                                  NEGOTIATE
                                  
                                  SESSION\_SETUP
                                  
                                  TREE\_CONNECT
                                  
                                  CREATE (File)
                                  
                                  READ (the locking range, expect success)
                                  
                                  WRITE (the locking range, expect fail)
                                  
                                  \
                                  
                                  **From client2 unlock the range**
                                  
                                  LOCK (with SMB2\_LOCKFLAG\_UNLOCK in SMB2\_LOCK\_ELEMENT)\
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF
                                  
                                  \
                                  
                                  **From client3 try to write the range**
                                  
                                  WRITE (the locking range, expect success)
                                  
                                  CLOSE
                                  
                                  TREE\_DISCONNECT
                                  
                                  LOGOFF

  **Cluster Involved Scenario**   **YES**
  ------------------------------- ------------------------------------------------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- ------------------------------------------------------------------------------------------
  **Test ID**                FileServerFailover\_Lock

  **Description**            Operate files with lock during failover and expect the lock is maintained after failover

  **Prerequisites**          \
                             

  **Test Execution Steps**   **From client1 open a file and lock a specific range**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (File, with durable handle request)
                             
                             WRITE
                             
                             LOCK (with SMB2\_LOCKFLAG\_SHARED\_LOCK in SMB2\_LOCK\_ELEMENT)
                             
                             \
                             
                             \
                             
                             *Disable current node of the Cluster which owns the connection*
                             
                             \
                             
                             **From client2**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (with durable handle reconnect)
                             
                             READ (the locking range, expect success)
                             
                             WRITE (the locking range, expect success)
                             
                             \
                             
                             **From client3 open the same file and try to read and write the locking range**
                             
                             NEGOTIATE
                             
                             SESSION\_SETUP
                             
                             TREE\_CONNECT
                             
                             CREATE (File)
                             
                             READ (the locking range, expect success)
                             
                             WRITE (the locking range, expect fail)
                             
                             \
                             
                             **From client2 unlock the range**
                             
                             LOCK (with SMB2\_LOCKFLAG\_UNLOCK in SMB2\_LOCK\_ELEMENT)\
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF
                             
                             \
                             
                             **From client3 try to write the range**
                             
                             WRITE (the locking range, expect success)
                             
                             CLOSE
                             
                             TREE\_DISCONNECT
                             
                             LOGOFF

  **Cleanup**                \
                             
  -------------------------- ------------------------------------------------------------------------------------------

\
\

8.  ### FileServerFailover\_DurableHandleV2 {.western}

    1.  #### Scenario {.western}

          ------------------------------- --------------------------------------------------------------------------------------------------------------------
          **Description**                 Test the CREATE request from different client could not success after failover when persistent handle is requested

          **Message Sequence**            **From one client open a file and request persistent handle**
                                          
                                          NEGOTIATE
                                          
                                          SESSION\_SETUP
                                          
                                          TREE\_CONNECT
                                          
                                          CREATE(with CREATE\_DURABLE\_HANDLE\_REQUEST\_V2 create context)
                                          
                                          \
                                          
                                          **Disable Node1to simulate failover**
                                          
                                          \
                                          
                                          **From different client try to open the same file**
                                          
                                          Repeat step 1 to 3
                                          
                                          CREATE (Incompatible share access with previous CREATE request and will result violation)
                                          
                                          Expect error in response from server
                                          
                                          TREE\_DISCONNECT
                                          
                                          LOGOFF

          **Cluster Involved Scenario**   **YES**
          ------------------------------- --------------------------------------------------------------------------------------------------------------------

    2.  #### Test Case {.western}

  -------------------------- ----------------------------------------------------------------------------------------------------------------
  **Test ID**                FileServerFailover\_BlockCreateFromDifferentClient

  **Description**            Test the CREATE request from different client could succeed after failover when persistent handle is requested

  **Prerequisites**          \
                             

  **Test Execution Steps**   **From one client open a file and request persistent handle**
                             
                             Client sends NEGOTIATE request
                             
                             Server sends NEGOTIATE response
                             
                             Client sends SESSION\_SETUP request
                             
                             Server sends SESSION\_SETUP response
                             
                             According to the status code of last step, client may send more SESSION\_SETUP request as needed
                             
                             Client sends TREE\_CONNECT request
                             
                             Server sends TREE\_CONNECT response
                             
                             Client sends CREATE request with CREATE\_DURABLE\_HANDLE\_REQUEST\_V2 create context
                             
                             Server sends CREATE response
                             
                             \
                             
                             **Disable Node1to simulate failover**
                             
                             \
                             
                             **From different client try to open the same file**
                             
                             Repeat step 1 to 7
                             
                             Client sends CREATE request
                             
                             Expect error in response from server
                             
                             Client sends TREE\_DISCONNECT request
                             
                             Server sends TREE\_DISCONNECT response
                             
                             Client sends LOGOFF request
                             
                             Server sends LOGOFF response

  **Cleanup**                \
                             
  -------------------------- ----------------------------------------------------------------------------------------------------------------

\
\

5.  FSRVP Test {.western}
    ----------

      ------------------------------- ---------------- ------------------------- ---------------------------------
      **Scenario**                    **Test Cases**   **SMB 3.0 New Feature**   **Hyper-V Scenario Importance**
      **VSSOperateShadowCopySet**     6                **Yes**                   **Critical**
      **VSSSet****Context**           5                **Yes**                   **Critical**
      **VSS****AbortShadowCopySet**   3                **Yes**                   **Critical**
      ------------------------------- ---------------- ------------------------- ---------------------------------

    1.  ### VSSOperateShadowCopySet {.western}

        1.  #### Scenario {.western}

  ------------------------------- -------------------------------
  **Description**                 Operate a shadow copy set.

  **Call Sequence**               IsPathSupported
                                  
                                  GetSupportedVersion
                                  
                                  SetContext
                                  
                                  StartShadowCopySet
                                  
                                  AddToShadowCopySet
                                  
                                  PrepareShadowCopySet
                                  
                                  CommitShadowCopySet
                                  
                                  ExposeShadowCopySet
                                  
                                  GetShareMapping
                                  
                                  RecoveryCompleteShadowCopySet
                                  
                                  IsPathShadowCopied
                                  
                                  DeleteShareMapping

  **Cluster Involved Scenario**   YES
  ------------------------------- -------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- ------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_VSSOperateShadowCopySet\_WritableSnapshot\_GeneralFileServer

  **Description**            Check if the general file server supports the VSS provider to create a writable snapshot for remote files.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  IsPathSupported("\\\\GeneralFS.contoso.com\\SMBBasic")
                             
                             2.  GetSupportedVersion
                             
                             3.  SetContext(0x00400000)
                             
                             4.  StartShadowCopySet
                             
                             5.  AddToShadowCopySet
                             
                             6.  PrepareShadowCopySet
                             
                             7.  CommitShadowCopySet
                             
                             8.  ExposeShadowCopySet
                             
                             9.  GetShareMapping
                             
                             10. Create a file in the exposed share and expect the success.
                             
                             11. RecoveryCompleteShadowCopySet
                             
                             12. IsPathShadowCopied
                             
                             13. DeleteShareMapping
                             
                             

  **Cleanup**                AbortShadowCopySet
                             
                             DeleteShareMapping
  -------------------------- ------------------------------------------------------------------------------------------------------------

\

  -------------------------- -------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_VSSOperateShadowCopySet\_WritableSnapshot\_ScaleoutFileServer

  **Description**            Check if the scaleout file server supports the VSS provider to create a writable snapshot for remote files.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  IsPathSupported("\\\\ScaleOutFS.contoso.com\\SMBBasic")
                             
                             2.  GetSupportedVersion
                             
                             3.  SetContext(0x00400000)
                             
                             4.  StartShadowCopySet
                             
                             5.  AddToShadowCopySet
                             
                             6.  PrepareShadowCopySet
                             
                             7.  CommitShadowCopySet
                             
                             8.  ExposeShadowCopySet
                             
                             9.  GetShareMapping
                             
                             10. Create a file in the exposed share and expect the success.
                             
                             11. RecoveryCompleteShadowCopySet
                             
                             12. IsPathShadowCopied
                             
                             13. DeleteShareMapping
                             
                             

  **Cleanup**                AbortShadowCopySet
                             
                             DeleteShareMapping
  -------------------------- -------------------------------------------------------------------------------------------------------------

\

  -------------------------- -----------------------------------------------------------------------------------------------
  **Test ID**                BVT\_VSSOperateShadowCopySet\_WritableSnapshot\_SingleNode

  **Description**            Check if the server supports the VSS provider to create a writable snapshot for remote files.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  IsPathSupported("\\\\Node01\\SMBBasic")
                             
                             2.  GetSupportedVersion
                             
                             3.  SetContext(0x00400000)
                             
                             4.  StartShadowCopySet
                             
                             5.  AddToShadowCopySet
                             
                             6.  PrepareShadowCopySet
                             
                             7.  CommitShadowCopySet
                             
                             8.  ExposeShadowCopySet
                             
                             9.  GetShareMapping
                             
                             10. Create a file in the exposed share and expect the success.
                             
                             11. RecoveryCompleteShadowCopySet
                             
                             12. IsPathShadowCopied
                             
                             13. DeleteShareMapping
                             
                             

  **Cleanup**                AbortShadowCopySet
                             
                             DeleteShareMapping
  -------------------------- -----------------------------------------------------------------------------------------------

\

  -------------------------- ------------------------------------------------------------------------------------------------------------
  **Test ID**                VSSOperateShadowCopySet\_DifferentNodeSharePath

  **Description**            Check if the server returns correctly when adding different sharePath on multi nodes to a shadow copy set.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  IsPathSupported("\\\\Node01\\SMBBasic")
                             
                             2.  GetSupportedVersion
                             
                             3.  SetContext(0x00400000)
                             
                             4.  StartShadowCopySet
                             
                             5.  AddToShadowCopySet("\\\\Node01\\SMBBasic")
                             
                             6.  AddToShadowCopySet("\\\\Node02\\SMBBasic")
                             
                             7.  Expect the server returns an error code E\_INVALIDARG (0x80070057).
                             
                             

  **Cleanup**                AbortShadowCopySet
                             
                             DeleteShareMapping
  -------------------------- ------------------------------------------------------------------------------------------------------------

\

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_VSSOperateShadowCopySet\_ClusterSharePath\_OwnerNode

  **Description**            Check if the server returns correctly when adding different sharePath on the cluster and the owner node to a shadow copy set.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Get the owner of cluster resource “GeneralFS”
                             
                             2.  IsPathSupported("\\\\GeneralFS\\SMBClustered")
                             
                             3.  GetSupportedVersion
                             
                             4.  SetContext(0x00400000)
                             
                             5.  StartShadowCopySet
                             
                             6.  AddToShadowCopySet("\\\\GeneralFS\\SMBClustered")
                             
                             7.  AddToShadowCopySet("\\\\Owner\\SMBBasic")
                             
                             8.  PrepareShadowCopySet
                             
                             9.  CommitShadowCopySet
                             
                             10. ExposeShadowCopySet
                             
                             11. GetShareMapping
                             
                             12. Create a file in the exposed share and expect the success.
                             
                             13. RecoveryCompleteShadowCopySet
                             
                             14. IsPathShadowCopied
                             
                             15. DeleteShareMapping
                             
                             

  **Cleanup**                AbortShadowCopySet
                             
                             DeleteShareMapping
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------

\

  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_VSSOperateShadowCopySet\_ClusterSharePath\_NonOwnerNode

  **Description**            Check if the server returns correctly when adding different sharePath on the cluster and the non-owner node to a shadow copy set.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Get the owner of cluster resource “GeneralFS”
                             
                             2.  IsPathSupported("\\\\GeneralFS\\SMBClustered")
                             
                             3.  GetSupportedVersion
                             
                             4.  SetContext(0x00400000)
                             
                             5.  StartShadowCopySet
                             
                             6.  AddToShadowCopySet("\\\\GeneralFS\\SMBClustered")
                             
                             7.  AddToShadowCopySet("\\\\NonOwner\\SMBBasic")
                             
                             8.  Expect the server returns an error code E\_INVALIDARG (0x80070057).
                             
                             

  **Cleanup**                AbortShadowCopySet
                             
                             DeleteShareMapping
  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------

\
\

2.  ### VSSSetContext {.western}

    1.  #### Scenario {.western}

  ------------------------------- -------------------------------
  **Description**                 Test important context.

  **Call Sequence**               IsPathSupported
                                  
                                  GetSupportedVersion
                                  
                                  SetContext
                                  
                                  StartShadowCopySet
                                  
                                  AddToShadowCopySet
                                  
                                  PrepareShadowCopySet
                                  
                                  CommitShadowCopySet
                                  
                                  ExposeShadowCopySet
                                  
                                  GetShareMapping
                                  
                                  RecoveryCompleteShadowCopySet
                                  
                                  IsPathShadowCopied
                                  
                                  DeleteShareMapping

  **Cluster Involved Scenario**   NO
  ------------------------------- -------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_VSSSetContext\_ReadonlySnapshot\_BACKUP

  **Description**            Check if the server supports FsrvpContextValues.FSRVP\_CTX\_BACKUP|FsrvpShadowCopyAttributes.FSRVP\_ATTR\_NO\_AUTO\_RECOVERY (0x00000002).

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  IsPathSupported
                             
                             2.  GetSupportedVersion
                             
                             3.  SetContext(0x00000002)
                             
                             4.  StartShadowCopySet
                             
                             5.  AddToShadowCopySet
                             
                             6.  PrepareShadowCopySet
                             
                             7.  CommitShadowCopySet
                             
                             8.  ExposeShadowCopySet
                             
                             9.  GetShareMapping
                             
                             10. Create a file in the exposed share and expect the failure.
                             
                             11. RecoveryCompleteShadowCopySet
                             
                             12. IsPathShadowCopied
                             
                             13. DeleteShareMapping
                             
                             

  **Cleanup**                AbortShadowCopySet
                             
                             DeleteShareMapping
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                VSSSetContext\_ReadonlySnapshot\_APP\_ROLLBACK

  **Description**            Check if the server supports FsrvpContextValues.FSRVP\_CTX\_APP\_ROLLBACK|FsrvpShadowCopyAttributes.FSRVP\_ATTR\_NO\_AUTO\_RECOVERY (0x0000000B).

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  IsPathSupported
                             
                             2.  GetSupportedVersion
                             
                             3.  SetContext(0x0000000B)
                             
                             4.  StartShadowCopySet
                             
                             5.  AddToShadowCopySet
                             
                             6.  PrepareShadowCopySet
                             
                             7.  CommitShadowCopySet
                             
                             8.  ExposeShadowCopySet
                             
                             9.  GetShareMapping
                             
                             10. Create a file in the exposed share and expect the failure.
                             
                             11. RecoveryCompleteShadowCopySet
                             
                             12. IsPathShadowCopied
                             
                             13. DeleteShareMapping
                             
                             

  **Cleanup**                AbortShadowCopySet
                             
                             DeleteShareMapping
  -------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -----------------------------------------------------------------------------------------
  **Test ID**                VSSSetContext\_ReadonlySnapshot\_NAS\_ROLLBACK

  **Description**            Check if the server supports FsrvpContextValues.FSRVP\_CTX\_NAS\_ROLLBACK (0x00000010).

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  IsPathSupported
                             
                             2.  GetSupportedVersion
                             
                             3.  SetContext(0x00000010)
                             
                             4.  StartShadowCopySet
                             
                             5.  AddToShadowCopySet
                             
                             6.  PrepareShadowCopySet
                             
                             7.  CommitShadowCopySet
                             
                             8.  ExposeShadowCopySet
                             
                             9.  GetShareMapping
                             
                             10. Create a file in the exposed share and expect the failure.
                             
                             11. RecoveryCompleteShadowCopySet
                             
                             12. IsPathShadowCopied
                             
                             13. DeleteShareMapping
                             
                             

  **Cleanup**                AbortShadowCopySet
                             
                             DeleteShareMapping
  -------------------------- -----------------------------------------------------------------------------------------

\
\

  -------------------------- -----------------------------------------------------------------------------------------------
  **Test ID**                VSSSetContext\_ReadonlySnapshot\_FILE\_SHARE\_BACKUP

  **Description**            Check if the server supports FsrvpContextValues.FSRVP\_CTX\_FILE\_SHARE\_BACKUP (0x00000019).

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  IsPathSupported
                             
                             2.  GetSupportedVersion
                             
                             3.  SetContext(0x00000019)
                             
                             4.  StartShadowCopySet
                             
                             5.  AddToShadowCopySet
                             
                             6.  PrepareShadowCopySet
                             
                             7.  CommitShadowCopySet
                             
                             8.  ExposeShadowCopySet
                             
                             9.  GetShareMapping
                             
                             10. Create a file in the exposed share and expect the failure.
                             
                             11. RecoveryCompleteShadowCopySet
                             
                             12. IsPathShadowCopied
                             
                             13. DeleteShareMapping
                             
                             

  **Cleanup**                AbortShadowCopySet
                             
                             DeleteShareMapping
  -------------------------- -----------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                VSSSetContext\_Invalid

  **Description**            Check if the server does not support FsrvpShadowCopyAttributes.FSRVP\_ATTR\_NO\_AUTO\_RECOVERY|FsrvpShadowCopyAttributes.FSRVP\_ATTR\_AUTO\_RECOVERY (0x00400002).

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  IsPathSupported
                             
                             2.  GetSupportedVersion
                             
                             3.  SetContext(0x00400002)
                             
                             4.  Expect the server returns an error code FSRVP\_E\_UNSUPPORTED\_CONTEXT (0x8004231B).
                             
                             

  **Cleanup**                AbortShadowCopySet
                             
                             DeleteShareMapping
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

3.  ### VSSAbortShadowCopySet {.western}

    1.  #### Scenario {.western}

  ------------------------------- ----------------------------------------------------
  **Description**                 Test to abort a shadow copy set in specific state.

  **Call Sequence**               IsPathSupported
                                  
                                  GetSupportedVersion
                                  
                                  SetContext
                                  
                                  StartShadowCopySet (AbortShadowCopySet)
                                  
                                  AddToShadowCopySet (AbortShadowCopySet)
                                  
                                  PrepareShadowCopySet
                                  
                                  CommitShadowCopySet
                                  
                                  ExposeShadowCopySet
                                  
                                  GetShareMapping
                                  
                                  RecoveryCompleteShadowCopySet (AbortShadowCopySet)
                                  
                                  IsPathShadowCopied
                                  
                                  DeleteShareMapping

  **Cluster Involved Scenario**   NO
  ------------------------------- ----------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- -----------------------------------------------------------------------------------
  **Test ID**                VSSAbortShadowCopySet\_Started

  **Description**            Check if the server supports AbortShadowCopySet after calling StartShadowCopySet.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  IsPathSupported
                             
                             2.  GetSupportedVersion
                             
                             3.  SetContext(0x00000000)
                             
                             4.  StartShadowCopySet
                             
                             5.  AbortShadowCopySet
                             
                             6.  Expect the server returns SUCCESS(0x00000000)
                             
                             

  **Cleanup**                AbortShadowCopySet
                             
                             DeleteShareMapping
  -------------------------- -----------------------------------------------------------------------------------

\
\

  -------------------------- ---------------------------------------------------------------------------------
  **Test ID**                VSSAbortShadowCopySet\_Added

  **Description**            Check if the server supports AbortShadowCopySet after calling AddShadowCopySet.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  IsPathSupported
                             
                             2.  GetSupportedVersion
                             
                             3.  SetContext(0x00000000)
                             
                             4.  StartShadowCopySet
                             
                             5.  AddShadowCopySet
                             
                             6.  AbortShadowCopySet
                             
                             7.  Expect the server returns SUCCESS(0x00000000)
                             
                             

  **Cleanup**                AbortShadowCopySet
                             
                             DeleteShareMapping
  -------------------------- ---------------------------------------------------------------------------------

\
\

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                VSSAbortShadowCopySet\_Recovered

  **Description**            Check if the server responses with FSRVP\_E\_BAD\_STATE when calling AbortShadowCopySet after called RecoveryCompleteShadowCopySet.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  IsPathSupported
                             
                             2.  GetSupportedVersion
                             
                             3.  SetContext(0x00000000)
                             
                             4.  StartShadowCopySet
                             
                             5.  AddShadowCopySet
                             
                             6.  PrepareShadowCopySet
                             
                             7.  CommitShadowCopySet
                             
                             8.  ExposeShadowCopySet
                             
                             9.  RecoveryCompleteShadowCopySet
                             
                             10. AbortShadowCopySet
                             
                             11. Expect the server returns an error code FSRVP\_E\_BAD\_STATE(0x80042301)
                             
                             

  **Cleanup**                AbortShadowCopySet
                             
                             DeleteShareMapping
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------

\
\

3.6 RSVD Test {.western style="margin-left: 0.4in; text-indent: -0.4in"}
-------------

  -------------------------------------- ----------------
  **Scenario**                           **Test Cases**
  **OpenCloseSharedVHD**                 1
  **TunnelOperationToSharedVHD**         6
  **ReadWriteSharedVHD**                 2
  **QuerySharedVirtualDiskSupport**      1
  **TwoClientsAccessSameSharedVHD**      2
  **ReconnectVHDWithoutDeviceContext**   1
  **QueryVHDSetFileInfo**                2
  **ConvertVHDtoVHDSet**                 1
  **CreateDeleteCheckpoint**             1
  **ExtractVHDSet**                      1
  -------------------------------------- ----------------

\
\

6.  

    1.  ### OpenCloseSharedVHD {.western}

        1.  #### Scenario {.western}

              ------------------------------- -----------------------------------------------------------------------------------------
              **Description**                 Check if server handles the request to open/close a shared virtual disk file correctly.

              **Message Sequence**            OpenSharedVirtualDisk
                                              
                                              CloseSharedVirtualDisk

              **Cluster Involved Scenario**   YES
              ------------------------------- -----------------------------------------------------------------------------------------

        2.  #### Test Case {.western}

  -------------------------- ------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_OpenCloseSharedVHD

  **Description**            Check if the server supports opening/closing a shared virtual disk file.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client opens a shared virtual disk file with SMB2 create context SVHDX\_OPEN\_DEVICE\_CONTEXT and expects success.
                             
                             2.  Client closes the file and expect success.
                             
                             

  **Cleanup**                N/A
  -------------------------- ------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                ReconnectSharedVHDWithoutDeviceContext

  **Description**            Check if the client can reconnect the persistent handle to the shared virtual disk file without carrying device context.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client opens a shared virtual disk file with SMB2 create contexts SVHDX\_OPEN\_DEVICE\_CONTEXT and SMB2\_CREATE\_DURABLE\_HANDLE\_REQUEST\_V2 (persistent bit is set).
                             
                             2.  Client disconnects from the server.
                             
                             3.  Client reconnects the persistent handle without create context SVHDX\_OPEN\_DEVICE\_CONTEXT and expects success.
                             
                             

  **Cleanup**                N/A
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

2.  ### TunnelOperationToSharedVHD {.western}

    1.  #### Scenario {.western}

  ------------------------------- -----------------------------------------------------------------------------------------------
  **Description**                 Check if server handles the tunnel operation request to a shared virtual disk file correctly.

  **Message Sequence**            OpenSharedVirtualDisk
                                  
                                  TunnelOperation
                                  
                                  CloseSharedVirtualDisk

  **Cluster Involved Scenario**   YES
  ------------------------------- -----------------------------------------------------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- -----------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_TunnelGetFileInfoToSharedVHD

  **Description**            Check if server supports handling tunnel operation RSVD\_TUNNEL\_GET\_FILE\_INFO\_OPERATION.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client opens a shared virtual disk file successfully.
                             
                             2.  Client sends tunnel operation RSVD\_TUNNEL\_GET\_FILE\_INFO\_OPERATION to server and expects success.
                             
                             3.  Client closes the file.
                             
                             

  **Cleanup**                N/A
  -------------------------- -----------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_TunnelSCSIToSharedVHD

  **Description**            Check if server supports handling tunnel operation RSVD\_TUNNEL\_SCSI\_OPERATION.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client opens a shared virtual disk file successfully.
                             
                             2.  Client sends tunnel operation RSVD\_TUNNEL\_SCSI\_OPERATION to server and expects success.
                             
                             3.  Client closes the file.
                             
                             

  **Cleanup**                N/A
  -------------------------- ------------------------------------------------------------------------------------------------

\
\

  -------------------------- ---------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_TunnelCheckConnectionStatusToSharedVHD

  **Description**            Check if server supports handling tunnel operation RSVD\_TUNNEL\_CHECK\_CONNECTION\_STATUS\_OPERATION.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client opens a shared virtual disk file successfully.
                             
                             2.  Client sends tunnel operation RSVD\_TUNNEL\_CHECK\_CONNECTION\_STATUS\_OPERATION to server and expects success.
                             
                             3.  Client closes the file.
                             
                             

  **Cleanup**                N/A
  -------------------------- ---------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_TunnelSRBStatusToSharedVHD

  **Description**            Check if server supports handling tunnel operation RSVD\_TUNNEL\_SRB\_STATUS\_OPERATION.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client opens a shared virtual disk file successfully.
                             
                             2.  Read fail
                             
                             3.  Client sends tunnel operation RSVD\_TUNNEL\_SRB\_STATUS\_OPERATION to server and expects success.
                             
                             4.  Client closes the file.
                             
                             

  **Cleanup**                N/A
  -------------------------- -------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -----------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_TunnelGetDiskInfoToSharedVHD

  **Description**            Check if server supports handling tunnel operation RSVD\_TUNNEL\_GET\_DISK\_INFO\_OPERATION.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client opens a shared virtual disk file successfully.
                             
                             2.  Client sends tunnel operation RSVD\_TUNNEL\_GET\_DISK\_INFO\_OPERATION to server and expects success.
                             
                             3.  Client closes the file.
                             
                             

  **Cleanup**                N/A
  -------------------------- -----------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_TunnelValidateDiskToSharedVHD

  **Description**            Check if server supports handling tunnel operation RSVD\_TUNNEL\_VALIDATE\_DISK\_OPERATION.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client opens a shared virtual disk file successfully.
                             
                             2.  Client sends tunnel operation RSVD\_TUNNEL\_VALIDATE\_DISK\_OPERATION to server and expects success.
                             
                             3.  Client closes the file.
                             
                             

  **Cleanup**                N/A
  -------------------------- ----------------------------------------------------------------------------------------------------------

3.  ### ReadWriteSharedVHD {.western}

    1.  #### Scenario {.western}

  ------------------------------- -------------------------------------------------------------------------------------
  **Description**                 Check if server handles Read/Write request to a shared virtual disk file correctly.

  **Message Sequence**            OpenSharedVirtualDisk
                                  
                                  ReadContent
                                  
                                  WriteContent
                                  
                                  CloseSharedVirtualDisk

  **Cluster Involved Scenario**   YES
  ------------------------------- -------------------------------------------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- -------------------------------------------------------------------------------
  **Test ID**                BVT\_ReadSharedVHD

  **Description**            Check if server handles Read request to a shared virtual disk file correctly.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client opens a shared virtual disk file successfully.
                             
                             2.  Client reads file content successfully.
                             
                             3.  Client closes the file.
                             
                             

  **Cleanup**                N/A
  -------------------------- -------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------
  **Test ID**                BVT\_WriteSharedVHD

  **Description**            Check if server handles Write request to a shared virtual disk file correctly.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client opens a shared virtual disk file successfully.
                             
                             2.  Client writes file content successfully.
                             
                             3.  Client closes the file.
                             
                             

  **Cleanup**                N/A
  -------------------------- --------------------------------------------------------------------------------

4.  ### QuerySharedVirtualDiskSupport {.western}

    1.  #### Scenario {.western}

          ------------------------------- ---------------------------------------------------------------------------------------------------------
          **Description**                 Check if server handles SHARED\_VIRTUAL\_DISK\_SUPPORT request to a shared virtual disk file correctly.

          **Message Sequence**            OpenSharedVirtualDisk
                                          
                                          QuerySharedVirtualDiskSupport
                                          
                                          CloseSharedVirtualDisk

          **Cluster Involved Scenario**   YES
          ------------------------------- ---------------------------------------------------------------------------------------------------------

    2.  #### Test Case {.western}

          -------------------------- ---------------------------------------------------------------------------------------------------------
          **Test ID**                BVT\_QuerySharedVirtualDiskSupport

          **Description**            Check if server handles SHARED\_VIRTUAL\_DISK\_SUPPORT request to a shared virtual disk file correctly.

          **Prerequisites**          \
                                     

          **Test Execution Steps**   1.  Client opens a shared virtual disk file successfully.
                                     
                                     2.  Client sends SVHDX\_SHARED\_VIRTUAL\_DISK\_SUPPORT\_REQUEST to server and expects success.
                                     
                                     3.  Client closes the file.
                                     
                                     

          **Cleanup**                N/A
          -------------------------- ---------------------------------------------------------------------------------------------------------

5.  ### TwoClientsAccessSameSharedVHD {.western}

    1.  #### Scenario {.western}

  ------------------------------- ---------------------------------------------------------------------------------------------------
  **Description**                 Check if server handles requests to the same shared virtual disk file from two clients correctly.

  **Message Sequence**            The first client does some operation to the shared virtual disk file.
                                  
                                  The second client does some operation to the same shared virtual disk file.
                                  
                                  The two clients closes the shared virtual disk file.

  **Cluster Involved Scenario**   YES
  ------------------------------- ---------------------------------------------------------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- ------------------------------------------------------------------------------------------------
  **Test ID**                TwoClientsReadSameSharedVHD

  **Description**            Check if server handles Read request to a shared virtual disk file from two clients correctly.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  The first client opens a shared virtual disk file successfully.
                             
                             2.  The first client reads file content successfully.
                             
                             3.  The second client opens the same shared virtual disk file successfully.
                             
                             4.  The second client reads file content successfully.
                             
                             5.  The first client closes the file.
                             
                             6.  The second client closes the file.
                             
                             

  **Cleanup**                N/A
  -------------------------- ------------------------------------------------------------------------------------------------

\
\

  -------------------------- -------------------------------------------------------------------------------------------------
  **Test ID**                TwoClientsWriteSameSharedVHD

  **Description**            Check if server handles Write request to a shared virtual disk file from two clients correctly.

  **Prerequisites**          N/A

  **Test Execution Steps**   1.  The first client opens a shared virtual disk file successfully.
                             
                             2.  The first client writes file content successfully.
                             
                             3.  The second client opens the same shared virtual disk file successfully.
                             
                             4.  The second client writes file content successfully.
                             
                             5.  The first client closes the file.
                             
                             6.  The second client closes the file.
                             
                             

  **Cleanup**                N/A
  -------------------------- -------------------------------------------------------------------------------------------------

1.  ### ReconnectVHDWithoutDeviceContext {.western}

    1.  #### Scenario {.western}

  ------------------------------- -----------------------------------------------------------------------------------------------------------------------------------
  **Description**                 Check if server can reconnect the persistent handle to the shared virtual disk file without carrying device context successfully.

  **Message Sequence**            The client requests a persistent handle with device context and to the shared virtual disk file and expects success.
                                  
                                  The client disconnects.
                                  
                                  The client reconnects the persistent handle without carrying device context and expects success.

  **Cluster Involved Scenario**   YES
  ------------------------------- -----------------------------------------------------------------------------------------------------------------------------------

\
\

1.  #### Test Case {.western}

  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                ReconnectSharedVHDWithoutDeviceContext

  **Description**            Check if server can reconnect the persistent handle to the shared virtual disk file without carrying device context successfully.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  The client requests a persistent handle with device context successfully.
                             
                             2.  The client disconnects successfully.
                             
                             3.  The client reconnects the persistent handle without carrying device context and expects success.
                             
                             4.  The client closes the file.
                             
                             

  **Cleanup**                N/A
  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------

6.  ### QueryVHDSetFileInfo {.western}

    1.  #### Scenario {.western}

  ------------------------------- ---------------------------------------------------------------------------------------------------------------------
  **Description**                 Check if server handles the tunnel operation request to query a shared virtual disk set file information correctly.

  **Message Sequence**            OpenSharedVirtualDisk
                                  
                                  SvhdxTunnelVhdSetQueryInformation
                                  
                                  CloseSharedVirtualDisk

  **Cluster Involved Scenario**   YES
  ------------------------------- ---------------------------------------------------------------------------------------------------------------------

\
\

1.  #### Test Case {.western}

      -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      **Test ID**                BVT\_Query\_VHDSet\_FileInfo\_SnapshotList

      **Description**            Check if server supports handling tunnel operation SVHDX\_TUNNEL\_VHDSET\_FILE\_QUERY\_INFORMATION\_REQUEST while SetFileInfo is set to SvhdxVHDSetFileInformationTypeSnapshotList

      **Prerequisites**          \
                                 

      **Test Execution Steps**   1.  Client opens a shared virtual disk set file successfully.
                                 
                                 2.  Client sends tunnel operation SVHDX\_TUNNEL\_VHDSET\_FILE\_QUERY\_INFORMATION\_REQUEST with SetFileInfo set to SvhdxVHDSetFileInformationTypeSnapshotList to server and expects success.
                                 
                                 3.  Client closes the file.
                                 
                                 

      **Cleanup**                N/A
      -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

2.  #### Test Case {.western}

      -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      **Test ID**                BVT\_Query\_VHDSet\_FileInfo\_SnapshotEntry

      **Description**            Check if server supports handling tunnel operation SVHDX\_TUNNEL\_VHDSET\_FILE\_QUERY\_INFORMATION\_REQUEST while SetFileInfo is set to SvhdxVHDSetFileInformationTypeSnapshotEntry

      **Prerequisites**          \
                                 

      **Test Execution Steps**   1.  Client opens a shared virtual disk set file successfully.
                                 
                                 2.  Client sends tunnel operation SVHDX\_TUNNEL\_VHDSET\_FILE\_QUERY\_INFORMATION\_REQUEST with SetFileInfo set to SvhdxVHDSetFileInformationTypeSnapshotEntry to server and expects success.
                                 
                                 3.  Client closes the file.
                                 
                                 

      **Cleanup**                N/A
      -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

### ConvertVHDtoVHDSet {.western}

1.  #### Scenario {.western}

  ------------------------------- -------------------------------------------------------------------------------------------------------------------------------------------
  **Description**                 Check if server handles the tunnel operation request to convert a shared virtual disk file into a shared virtual disk set file correctly.

  **Message Sequence**            OpenSharedVirtualDisk
                                  
                                  SvhdxMetaOperationStart
                                  
                                  CloseSharedVirtualDisk

  **Cluster Involved Scenario**   YES
  ------------------------------- -------------------------------------------------------------------------------------------------------------------------------------------

\
\

1.  #### Test Case {.western}

      -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      **Test ID**                BVT\_Convert\_VHDFile\_to\_VHDSetFile

      **Description**            Check if server supports handling tunnel operation SVHDX\_META\_OPERATION\_START\_REQUEST with SVHDX\_META\_OPERATION\_CONVERT\_TO\_VHDSET in the payload to convert the .vhdx file into the .vhds file correctly.

      **Prerequisites**          \
                                 

      **Test Execution Steps**   1.  Client opens a shared virtual disk set file successfully.
                                 
                                 2.  Client sends tunnel operation SVHDX\_META\_OPERATION\_START\_REQUEST with SVHDX\_META\_OPERATION\_CONVERT\_TO\_VHDSET structure in the payload to server and expects success.
                                 
                                 3.  Client closes the file.
                                 
                                 

      **Cleanup**                N/A
      -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

### CreateDeleteCheckpoint {.western}

1.  #### Scenario {.western}

  ------------------------------- ---------------------------------------------------------------------------------------------------------------------------------
  **Description**                 Check if server handles the tunnel operation request to take and delete checkpoint on a shared virtual disk set file correctly.

  **Message Sequence**            OpenSharedVirtualDisk
                                  
                                  SvhdxMetaOperationStart
                                  
                                  SvhdxMetaOperationStart
                                  
                                  SvhdxTunnelDeleteSnapshot
                                  
                                  CloseSharedVirtualDisk

  **Cluster Involved Scenario**   YES
  ------------------------------- ---------------------------------------------------------------------------------------------------------------------------------

\
\

1.  #### Test Case {.western}

      -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      **Test ID**                BVT\_Create\_Delete\_Checkpoint

      **Description**            Check if server supports handling tunnel operation to create and delete checkpoint on a shared virtual disk set file correctly.

      **Prerequisites**          \
                                 

      **Test Execution Steps**   1.  Client opens a shared virtual disk set file successfully.
                                 
                                 2.  Client sends the first SVHDX\_META\_OPERATION\_START\_REQUEST with SVHDX\_META\_OPERATION\_CREATE\_SNAPSHOT structure in the payload to server to do initialization and expects success.
                                 
                                 3.  Client sends the second SVHDX\_META\_OPERATION\_START\_REQUEST with SVHDX\_META\_OPERATION\_CREATE\_SNAPSHOT structure in the payload to server to take a snapshot and expects success.
                                 
                                 4.  Client sends the SVHDX\_TUNNEL\_DELETE\_SNAPSHOT\_REQUEST to server to delete the created snapshot and expects success.
                                 
                                 5.  Client closes the file.
                                 
                                 

      **Cleanup**                N/A
      -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

### ExtractVHDSet {.western}

1.  #### Scenario {.western}

  ------------------------------- -------------------------------------------------------------------------------------------------------------
  **Description**                 Check if server handles the tunnel operation request to extract the shared virtual disk set file correctly.

  **Message Sequence**            OpenSharedVirtualDisk
                                  
                                  SvhdxMetaOperationStart
                                  
                                  CloseSharedVirtualDisk

  **Cluster Involved Scenario**   YES
  ------------------------------- -------------------------------------------------------------------------------------------------------------

\
\

2.  #### Test Case {.western}

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_Extract\_VHDSet

  **Description**            Check if server supports handling tunnel operation to extract the shared virtual disk set file correctly.

  **Prerequisites**          \
                             

  **Test Execution Steps**   1.  Client opens a shared virtual disk set file successfully.
                             
                             2.  Client sends the SVHDX\_META\_OPERATION\_START\_REQUEST with SVHDX\_META\_OPERATION\_EXTRACT structure in the payload to server and expects success.
                             
                             3.  Client closes the file.
                             
                             

  **Cleanup**                N/A
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------

3.7 DFSC Test {.western style="margin-left: 0.4in; text-indent: -0.4in"}
-------------

  ---------------------------------------------- ----------------
  **Scenario**                                   **Test Cases**
  **Domain\_referral\_to\_DC**                   5
  **DC\_referral\_to\_DC**                       6
  **Sysvol\_referral\_to\_DC**                   7
  **Root\_referral\_to\_DC**                     5
  **Link\_referral\_to\_DC**                     7
  **Root\_and\_Link\_referral\_to\_DFSServer**   11
  **Path\_Normalization\_to\_DFSServer**         2
  ---------------------------------------------- ----------------

\
\

The test cases are designed with below assumptions, and these terms will
be used in test case description or test steps:

-   **Domain name**: contoso.com

-   **DFS Server name**: node01

-   **Domain-based namespace**: DomainBased

-   **Stand-alone namespace**: Standalone

-   **DFS Link path**: DFSLink

-   **DFS interlink**: \\node01\\SMBDfs\\SMBDfsShare (This is another
    DFS link)

\

**The following scenarios are out of scope in DFSC test suite:**

-   The necessity of maintaining and sorting the root/link targets in
    the test environment and the metadata at the DFS server side is
    abstracted out and these are handled by the lower layer protocols.
    This includes the Client Target Failback feature.

-   Scenarios with domains in trusted forests in relationship to the
    client’s domain.

-   DFS referral target caches.

\

7.  

    1.  ### Domain\_referral\_to\_DC {.western}

        1.  #### Scenario {.western}

              ------------------------------- -------------------------------------------------------------
              **Description**                 Check if server handles domain referral requests correctly.

              **Message Sequence**            Client establishes SMB2 connection to server.
                                              
                                              Client sends domain referral request to server.
                                              
                                              Check server responses correctly.
                                              
                                              Disconnect and logoff SMB2 connection.

              **Cluster Involved Scenario**   NO
              ------------------------------- -------------------------------------------------------------

        2.  #### Test Case {.western}

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_DomainReferralV3ToDC

  **Description**            Client sends a version 3 Domain referral request to DC and expects positive response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes a SMB connection between client and DC server.
                             
                             ​2. Client sends a Domain referral v3 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is empty, MaxReferralLevel is 3) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and verify the accuracy of the response.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DomainReferralV1ToDC

  **Description**            Client sends a v1 Domain referral request to DC, and expects negative response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Domain referral v1 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is empty, MaxReferralLevel is 1) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_UNSUCCESSFUL.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DomainReferralV2ToDC

  **Description**            Client send a v2 Domain referral request to DC, and expects negative response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Domain referral v2 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is empty, MaxReferralLevel is 2) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_UNSUCCESSFUL.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DomainReferralV4EXSiteToDC

  **Description**            Client sends a v4 Domain referral request EX to DC, and expects positive response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Domain referral v4 REQ\_GET\_DFS\_REFERRAL\_EX message (RequestFileName is empty, MaxReferralLevel is 4, SiteName flag is set) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and RESP GET\_DFS\_REFERRAL message version is v3.
                             
                             ​4. Verify the accuracy of the response.
                             
                             ​5. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DomainReferralV4EXToDC

  **Description**            Client sends v4 Domain referral request EX to DC and expects positive response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Domain referral v4 REQ\_GET\_DFS\_REFERRAL\_EX message (RequestFileName is empty, MaxReferralLevel is 4, SiteName flag is not set) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and RESP GET\_DFS\_REFERRAL message version is v4.
                             
                             ​4. Verify the accuracy of the response.
                             
                             ​5. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

\
\

2.  ### DC\_referral\_to\_DC {.western}

    1.  #### Scenario {.western}

          ------------------------------- --------------------------------------------------------
          **Description**                 Check if server handles DC referral request correctly.

          **Message Sequence**            Client establishes SMB2 connection to server.
                                          
                                          Client sends DC referral request to server.
                                          
                                          Check server responses correctly.
                                          
                                          Disconnect and logoff SMB2 connection.

          **Cluster Involved Scenario**   NO
          ------------------------------- --------------------------------------------------------

    2.  #### Test Case {.western}

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_DCReferralV3ToDC

  **Description**            Client sends a version 3 DC referral request with a valid domain name(FQDN) to DC and expects positive response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes a SMB connection between client and DC server.
                             
                             ​2. Client sends a DC referral v3 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\contoso.com”, MaxReferralLevel is 3) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and RESP GET\_DFS\_REFERRAL message version is v3.
                             
                             ​4. Verify the name format is FQDN in response.
                             
                             ​5. Verify the response contains all DCs in the domain.
                             
                             ​6. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DCReferralV1ToDC

  **Description**            Client sends a v1 DC referral request to DC and expects negative response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a DC referral v1 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\contoso.com”, MaxReferralLevel is 1) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_UNSUCCESSFUL.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DCReferralV2ToDC

  **Description**            Client sends a v2 DC referral request to DC and expects negative response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a DC referral v2 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\contoso.com”, MaxReferralLevel is 2) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_UNSUCCESSFUL
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DCReferralV4EXNetbiosToDC

  **Description**            Client sends a v4 DC referral request EX with a valid domain name(NETBIOS) to DC and expects positive response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a DC referral v4 REQ\_GET\_DFS\_REFERRAL\_EX message (RequestFileName is “\\contoso”, MaxReferralLevel is 4, SiteName flag is not set) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and RESP GET\_DFS\_REFERRAL message version is v3.
                             
                             ​4. Verify the name format is NETBIOS in response.
                             
                             ​5. Verify the response contains all DCs in the domain.
                             
                             ​6. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                DCReferralV4EXSiteToDC

  **Description**            Client sends a v4 DC referral request EX with a site name to DC and expects positive response.

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a DC referral v4 REQ\_GET\_DFS\_REFERRAL\_EX message (RequestFileName is “\\contoso”, MaxReferralLevel is 4, SiteName flag is set) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and RESP GET\_DFS\_REFERRAL message version is v3.
                             
                             ​4. Verify the response.
                             
                             ​5. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                InvalidDCReferralToDC

  **Description**            Client sends a v4 DC referral request with an invalid domain name(NETBIOS) to DC and expects negative response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a DC referral v4 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\Invalid”, MaxReferralLevel is 4) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_INVALID\_PARAMETER.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------

\
\

3.  ### Sysvol\_referral\_to\_DC {.western}

    1.  #### Scenario {.western}

          ------------------------------- ---------------------------------------------------
          **Description**                 Check if server handles Sysvol request correctly.

          **Message Sequence**            Client establishes SMB2 connection to server.
                                          
                                          Client sends Sysvol referral request to server.
                                          
                                          Check server responses correctly.
                                          
                                          Disconnect and logoff SMB2 connection.

          **Cluster Involved Scenario**   NO
          ------------------------------- ---------------------------------------------------

    2.  #### Test Case {.western}

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_SysvolReferralV3ToDCNetlogonPath

  **Description**            Client sends a version 3 sysvol referral request with NETLOGON directory to DC, and expects positive response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes a SMB connection between client and DC server.
                             
                             ​2. Client sends a Sysvol referral v3 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\contoso\\NETLOGON”, MaxReferralLevel is 3) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and verifies the accuracy of the response.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_SysvolReferralV4ToDCSysvolPath

  **Description**            Client sends a v4 Sysvol referral request with SYSVOL directory to DC, and expects positive response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Sysvol referral v4 REQ\_GET\_DFS\_REFERRAL\_EX message (RequestFileName is “\\contoso.com\\NETLOGON”, MaxReferralLevel is 4) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and verify the accuracy of the response.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                InvalidSysvolReferralToDC

  **Description**            Client sends a v1 Sysvol referral request with invalid Domain name to DC and expects negative response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Sysvol referral v1 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\Invalid\\SYSVOL”, MaxReferralLevel is 1) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_NOT\_FOUND.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                SysvolReferralV1EXSiteToDCSysvolPath

  **Description**            Client sends a v1 Sysvol referral request(EX) with SYSVOL directory to DC and expects positive response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Sysvol referral v1 REQ\_GET\_DFS\_REFERRAL\_EX message (RequestFileName is “\\contoso.com\\SYSVOL”, MaxReferralLevel is 1, SiteName flag is set) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and verify the response.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                SysvolReferralV1ToDCSysvolPath

  **Description**            Client sends v1 Sysvol referral request with SYSVOL directory to DC and expects positive response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Sysvol referral v1 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\contoso.com\\SYSVOL”, MaxReferralLevel is 1) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and verify the response.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                SysvolReferralV2ToDCNetlogonPath

  **Description**            Client sends a v2 Sysvol referral request with NETLOGON path to DC and expects positive response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Sysvol referral v2 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\contoso.com\\NETLOGON”, MaxReferralLevel is 2) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and verify the response.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                SysvolReferralV2EXToDCNetlogonPath

  **Description**            Client sends a v2 Sysvol referral request(EX) with NETLOGON directory to DC and expects positive response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Sysvol referral v2 REQ\_GET\_DFS\_REFERRAL\_EX message (RequestFileName is “\\contoso.com\\SYSVOL”, MaxReferralLevel is 1, SiteName flag is not set) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and verify the response.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

4.  ### Root\_referral\_to\_DC {.western}

    1.  #### Scenario {.western}

          ------------------------------- ----------------------------------------------------------
          **Description**                 Check if server handles Root referral request correctly.

          **Message Sequence**            Client establishes SMB2 connection to server.
                                          
                                          Client sends Root referral request to server.
                                          
                                          Check server responses correctly.
                                          
                                          Disconnect and logoff SMB2 connection.

          **Cluster Involved Scenario**   NO
          ------------------------------- ----------------------------------------------------------

    2.  #### Test Case {.western}

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_RootReferralV4ToDC

  **Description**            Client sends a v4 Root referral request to DC, and expects positive response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Root referral v4 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\contoso.com\\Root”, MaxReferralLevel is 4) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and RESP GET\_DFS\_REFERRAL message version is v4.
                             
                             ​4. Verify the response.
                             
                             ​5. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                RootReferralV1ToDC

  **Description**            Client sends a v1 Root referral request to DC and expects positive response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Root referral v1 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\contoso.com\\DomainBased”, MaxReferralLevel is 1) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and RESP GET\_DFS\_REFERRAL message version is v1.
                             
                             ​4. Verify the response.
                             
                             ​5. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                RootReferralV2EXToDC

  **Description**            Client sends a v2 Root referral request to DC and expects positive response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Root referral v2 REQ\_GET\_DFS\_REFERRAL\_EX message (RequestFileName is “\\contoso.com\\DomainBased”, MaxReferralLevel is 2, SiteName Flag is not set) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and RESP GET\_DFS\_REFERRAL message version is v2.
                             
                             ​4. Verify the response.
                             
                             ​5. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                RootReferralV3EXSiteToDC

  **Description**            Client sends a v3 Root referral request to DC and expects positive response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Root referral v3 REQ\_GET\_DFS\_REFERRAL\_EX message (RequestFileName is “\\contoso.com\\DomainBased”, MaxReferralLevel is 3, SiteName flag is set) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and RESP GET\_DFS\_REFERRAL message version is v3.
                             
                             ​4. Verify the response.
                             
                             ​5. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                InvalidRootReferralToDC

  **Description**            Client sends an invalid v4 Root referral request to DC and expects negative response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Root referral v4 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\contoso.com\\Invalid”, MaxReferralLevel is 4) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_NO\_SUCH\_FILE.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------

\
\

5.  ### Link\_referral\_to\_DC {.western}

    1.  #### Scenario {.western}

          ------------------------------- ----------------------------------------------------------
          **Description**                 Check if server handles Link referral request correctly.

          **Message Sequence**            Client establishes SMB2 connection to server.
                                          
                                          Client sends Link referral request to server.
                                          
                                          Check server responses correctly.
                                          
                                          Disconnect and logoff SMB2 connection.

          **Cluster Involved Scenario**   NO
          ------------------------------- ----------------------------------------------------------

    2.  #### Test Case {.western}

  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                LinkReferralV4ToDC

  **Description**            Client sends a v4 Link referral request to DC, and expects positive response or STATUS\_NOT\_FOUND depends on if the DC is hosting DFS server.

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Link referral v4 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\contoso.com\\DomainBased\\DFSLink”, MaxReferralLevel is 4) to DC.
                             
                             ​3. If DC is hosting DFS server, then client expects STATUS == STATUS\_SUCCESS and RESP GET\_DFS\_REFERRAL message version is v4. Otherwise, client expects STATUS\_NOT\_FOUND from DC.
                             
                             ​4. Verify the response if any.
                             
                             ​5. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                LinkReferralV1ToDC

  **Description**            Client sends a v1 Link referral request to DC, and expects positive response or STATUS\_NOT\_FOUND depends on if the DC is hosting DFS server.

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Link referral v1 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\contoso.com\\DomainBased\\DFSLink”, MaxReferralLevel is 1) to DC.
                             
                             ​3. If DC is hosting DFS server, then client expects STATUS == STATUS\_SUCCESS and RESP GET\_DFS\_REFERRAL message version is v1. Otherwise, client expects STATUS\_NOT\_FOUND from DC.
                             
                             ​4. Verify the response.
                             
                             ​5. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                LinkReferralV2EXToDC

  **Description**            Client sends a v2 Link referral request to DC, and expects positive response or STATUS\_NOT\_FOUND depends on if the DC is hosting DFS server.

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Link referral v2 REQ\_GET\_DFS\_REFERRAL\_EX message (RequestFileName is “\\contoso.com\\DomainBased\\DFSLink”, MaxReferralLevel is 2, SiteName flag is not set) to DC.
                             
                             ​3. If DC is hosting DFS server, then client expects STATUS == STATUS\_SUCCESS and RESP GET\_DFS\_REFERRAL message version is v2. Otherwise, client expects STATUS\_NOT\_FOUND from DC.
                             
                             ​4. Verify the response.
                             
                             ​5. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                LinkReferralV3EXSiteToDC

  **Description**            Client sends a v3 Link referral request to DC, and expects positive response or STATUS\_NOT\_FOUND depends on if the DC is hosting DFS server.

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Link referral v3 REQ\_GET\_DFS\_REFERRAL\_EX message (RequestFileName is “\\contoso.com\\DomainBased\\DFSLink”, MaxReferralLevel is 3, SiteName flag is set) to DC.
                             
                             ​3. If DC is hosting DFS server, then client expects STATUS == STATUS\_SUCCESS and RESP GET\_DFS\_REFERRAL message version is v3. Otherwise, client expects STATUS\_NOT\_FOUND from DC.
                             
                             ​4. Verify the response.
                             
                             ​5. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                InvalidDomainNameLinkReferralToDC

  **Description**            Client sends a v2 Link referral request with invalid Domain name to DC, expect negative response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Link referral v2 REQ\_GET\_DFS\_REFERRAL message with invalid domain name (RequestFileName is “\\Invalid\\DomainBased\\DFSLink”, MaxReferralLevel is 2) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_NOT\_FOUND.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                InvalidLinkNameLinkReferralToDC

  **Description**            Client sends a v3 Link referral request with invalid link name to DC, expect negative response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Link referral v3 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\contoso.com\\DomainBased\\Invalid”, MaxReferralLevel is 3) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_NOT\_FOUND.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                InvalidNamespaceLinkReferralToDC

  **Description**            Client sends a v4 Link referral request to DC with invalid namespace, expect negative response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DC server.
                             
                             ​2. Client sends a Link referral v4 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\contoso.com\\Invalid\\DFSLink”, MaxReferralLevel is 4) to DC.
                             
                             ​3. Client expects STATUS == STATUS\_NOT\_FOUND.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

6.  ### Root\_and\_Link\_referral\_to\_DFSServer {.western}

    1.  #### Scenario {.western}

          ------------------------------- -------------------------------------------------------------------
          **Description**                 Check if server handles root and link referral request correctly.

          **Message Sequence**            Client establishes SMB2 connection to server.
                                          
                                          Client sends root and link referral request to server.
                                          
                                          Check server responses correctly.
                                          
                                          Disconnect and logoff SMB2 connection.

          **Cluster Involved Scenario**   NO
          ------------------------------- -------------------------------------------------------------------

    2.  #### Test Case {.western}

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_RootAndLinkReferralStandaloneV4ToDFSServer

  **Description**            Client sends a DFS root referral request v4 to DFS Server first, and then link referral request v4.

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DFS server.
                             
                             ​2. Client sends a Root referral v4 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\node01\\Standalone\\”, MaxReferralLevel is 4) to DFS server.
                             
                             ​5. Client expects STATUS = STATUS\_SUCCESS and returns the same path.
                             
                             ​6. Client sends a Link referral v4 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\node01\\Standalone\\DFSLink”, MaxReferralLevel is 4) to DFS server.
                             
                             ​7. Client expects STATUS == STATUS\_SUCCESS and verifies response.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                BVT\_RootAndLinkReferralDomainV4ToDFSServer

  **Description**            Client sends a DFS root referral request v4 to DFS Server first, and then link referral request v4.

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DFS server.
                             
                             ​2. Client sends a Root referral v4 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\contoso.com\\DomainBased\\”, MaxReferralLevel is 4) to DFS server.
                             
                             ​5. Client expects STATUS = STATUS\_SUCCESS and returns the same path.
                             
                             ​6. Client sends a Link referral v4 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\node01\\DomainBased\\DFSLink”, MaxReferralLevel is 4) to DFS server.
                             
                             ​7. Client expects STATUS == STATUS\_SUCCESS and verifies response.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                RootAndLinkReferralStandaloneV2ToDFSServer

  **Description**            Client sends a DFS root referral request v2 to DFS Server first, and then link referral request v2.

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DFS server.
                             
                             ​2. Client sends a Root referral v2 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\node01\\Standalone\\”, MaxReferralLevel is 2) to DFS server.
                             
                             ​5. Client expects STATUS = STATUS\_SUCCESS and returns the same path.
                             
                             ​6. Client sends a Link referral v2 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\node01\\Standalone\\DFSLink”, MaxReferralLevel is 2) to DFS server.
                             
                             ​7. Client expects STATUS == STATUS\_SUCCESS and verifies the response.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                RootAndLinkReferralEXStandaloneV1ToDFSServer

  **Description**            Client sends a DFS root referral request v1 first, and then link referral request v1.

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DFS server.
                             
                             ​2. Client sends a Root referral v1 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\node01\\Standalone\\”, MaxReferralLevel is 1) to DFS server.
                             
                             ​5. Client expects STATUS = STATUS\_SUCCESS and returns the same path.
                             
                             ​6. Client sends a Link referral v1 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\node01\\Standalone\\DFSLink”, MaxReferralLevel is 1) to DFS server.
                             
                             ​7. Client expects STATUS == STATUS\_SUCCESS and verifies the response.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                LinkReferralStandaloneToDFSServerReturnRootTarget

  **Description**            Client sends a DFS link referral request v3 to DFS Server first and expects root target returned.

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DFS server.
                             
                             ​2. Client sends a Link referral v3 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\node01\\Standalone\\Invalid”, MaxReferralLevel is 3) to DFS server.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and returns the root target (\\node01\\Standalone).
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                LinkReferralStandaloneToDFSServerReturnInterlink

  **Description**            Client sends a DFS link referral request v4 and expects interlink returned.

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DFS server.
                             
                             ​2. Client sends a Link referral v4 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\node01\\Standalone\\Interlink”, MaxReferralLevel is 4) to DFS server.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and returns interlink (\\node01\\SMBDfs\\SMBDfsShare).
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                LinkReferralDomainV1ToDFSServer

  **Description**            Client sends a DFS link referral request v1 to DFS Server and expects positive response.

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DFS server.
                             
                             ​2. Client sends a Link referral v1 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\contoso.com\\DomainBased\\DFSlink”, MaxReferralLevel is 1) to DFS server.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and verifies response.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                LinkReferralDomainToDFSServerReturnRootTarget

  **Description**            Client sends a DFS link referral request v4 and expects root target returned.

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DFS server.
                             
                             ​2. Client sends a Link referral v4 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\contoso.com\\DomainBased\\Invalid”, MaxReferralLevel is 1) to DFS server.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and verifies returned root target.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                LinkReferralDomainToDFSServerReturnInterlink

  **Description**            Client sends a DFS link referral request v4 to DFS Server and expects interlink returned.

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DFS server.
                             
                             ​2. Client sends a Link referral v4 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\contoso.com\\DomainBased\\Interlink”, MaxReferralLevel is 4) to DFS server.
                             
                             ​3. Client expects STATUS == STATUS\_SUCCESS and returns interlink (\\node01\\SMBDfs\\SMBDfsShare).
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                InvalidRootReferralStandaloneToDFSServer

  **Description**            Client sends a v4 invalid Root referral request to DFS server and expects negative response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DFS server.
                             
                             ​2. Client sends a Root referral v4 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\node01\\Invalid”, MaxReferralLevel is 4) to DFS server.
                             
                             ​3. Client expects STATUS == STATUS\_NOT\_FOUND.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                InvalidRootReferralDomainToDFSServer

  **Description**            Client sends a v4 invalid Root referral request to DFS server and expects negative response

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DFS server.
                             
                             ​2. Client sends a Root referral v4 REQ\_GET\_DFS\_REFERRAL message (RequestFileName is “\\contoso.com\\Invalid”, MaxReferralLevel is 4) to DFS server.
                             
                             ​3. Client expects STATUS == STATUS\_NOT\_FOUND for non-windows platform and STATUS\_DFS\_UNAVAILABLE for windows platform.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------

\
\

7.  ### Path\_Normalization\_to\_DFSServer {.western}

    1.  #### Scenario {.western}

          ------------------------------- ---------------------------------------------------------------
          **Description**                 Check if server handles path normalization request correctly.

          **Message Sequence**            Client establishes SMB2 connection to server.
                                          
                                          Client sends path normalization request to server.
                                          
                                          Check server responses correctly.
                                          
                                          Disconnect and logoff SMB2 connection.

          **Cluster Involved Scenario**   NO
          ------------------------------- ---------------------------------------------------------------

    2.  #### Test Case {.western}

  -------------------------- -----------------------------------------------------------------------------------------------------------------------------
  **Test ID**                NormalizePathWithDFSLink

  **Description**            Client sends SMB2 create request to open a file in a DFS path with DFS Link, verify if server normalize the path correctly.

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DFS server.
                             
                             ​2. Client sends a SMB2 CREATE message with DFS path containing DFSLink to DFS server.
                             
                             ​3. Client expects STATUS = STATUS\_PATH\_NOT\_COVERED.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- -----------------------------------------------------------------------------------------------------------------------------

\
\

  -------------------------- --------------------------------------------------------------------------------------------------------------------------------
  **Test ID**                NormalizePathWithoutDFSlink

  **Description**            Client sends SMB2 create request to open a file in a DFS path without DFS Link, verify if server normalize the path correctly.

  **Prerequisites**          Common prerequisites

  **Test Execution Steps**   ​1. Client establishes an SMB connection between client and DFS server.
                             
                             ​2. Client sends a SMB2 CREATE with DFS path but not containing DFSLink to DFS server.
                             
                             ​3. Client expects STATUS = STATUS\_SUCCESS.
                             
                             ​4. Disconnect and logoff.

  **Cleanup**                N/A
  -------------------------- --------------------------------------------------------------------------------------------------------------------------------

\
\

